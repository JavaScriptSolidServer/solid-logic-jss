{"version":3,"file":"solid-logic.esm.min.js","mappings":"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","sources":["webpack://solid-logic-jss/./node_modules/solid-namespace/index.js","webpack://solid-logic-jss/webpack/bootstrap","webpack://solid-logic-jss/./src/util/debug.ts","webpack://solid-logic-jss/webpack/runtime/compat get default export","webpack://solid-logic-jss/webpack/runtime/define property getters","webpack://solid-logic-jss/webpack/runtime/global","webpack://solid-logic-jss/webpack/runtime/hasOwnProperty shorthand","webpack://solid-logic-jss/./node_modules/solid-oidc/node_modules/jose/dist/browser/runtime/webcrypto.js","webpack://solid-logic-jss/./node_modules/solid-oidc/node_modules/jose/dist/browser/lib/invalid_key_input.js","webpack://solid-logic-jss/./node_modules/solid-oidc/node_modules/jose/dist/browser/lib/buffer_utils.js","webpack://solid-logic-jss/./node_modules/solid-oidc/node_modules/jose/dist/browser/runtime/base64url.js","webpack://solid-logic-jss/./node_modules/solid-oidc/node_modules/jose/dist/browser/runtime/is_key_like.js","webpack://solid-logic-jss/./node_modules/solid-oidc/node_modules/jose/dist/browser/runtime/key_to_jwk.js","webpack://solid-logic-jss/./node_modules/solid-oidc/node_modules/jose/dist/browser/key/export.js","webpack://solid-logic-jss/./node_modules/solid-oidc/node_modules/jose/dist/browser/util/errors.js","webpack://solid-logic-jss/./node_modules/solid-oidc/node_modules/jose/dist/browser/runtime/subtle_dsa.js","webpack://solid-logic-jss/./node_modules/solid-oidc/node_modules/jose/dist/browser/runtime/check_key_length.js","webpack://solid-logic-jss/./node_modules/solid-oidc/node_modules/jose/dist/browser/lib/crypto_key.js","webpack://solid-logic-jss/./node_modules/solid-oidc/node_modules/jose/dist/browser/lib/is_object.js","webpack://solid-logic-jss/./node_modules/solid-oidc/node_modules/jose/dist/browser/lib/is_jwk.js","webpack://solid-logic-jss/./node_modules/solid-oidc/node_modules/jose/dist/browser/runtime/jwk_to_key.js","webpack://solid-logic-jss/./node_modules/solid-oidc/node_modules/jose/dist/browser/runtime/normalize_key.js","webpack://solid-logic-jss/./node_modules/solid-oidc/node_modules/jose/dist/browser/runtime/get_sign_verify_key.js","webpack://solid-logic-jss/./node_modules/solid-oidc/node_modules/jose/dist/browser/runtime/sign.js","webpack://solid-logic-jss/./node_modules/solid-oidc/node_modules/jose/dist/browser/lib/is_disjoint.js","webpack://solid-logic-jss/./node_modules/solid-oidc/node_modules/jose/dist/browser/lib/check_key_type.js","webpack://solid-logic-jss/./node_modules/solid-oidc/node_modules/jose/dist/browser/lib/validate_crit.js","webpack://solid-logic-jss/./node_modules/solid-oidc/node_modules/jose/dist/browser/jws/flattened/sign.js","webpack://solid-logic-jss/./node_modules/solid-oidc/node_modules/jose/dist/browser/jws/compact/sign.js","webpack://solid-logic-jss/./node_modules/solid-oidc/node_modules/jose/dist/browser/lib/epoch.js","webpack://solid-logic-jss/./node_modules/solid-oidc/node_modules/jose/dist/browser/lib/secs.js","webpack://solid-logic-jss/./node_modules/solid-oidc/node_modules/jose/dist/browser/jwt/produce.js","webpack://solid-logic-jss/./node_modules/solid-oidc/node_modules/jose/dist/browser/jwt/sign.js","webpack://solid-logic-jss/./node_modules/solid-oidc/node_modules/jose/dist/browser/runtime/fetch_jwks.js","webpack://solid-logic-jss/./node_modules/solid-oidc/node_modules/jose/dist/browser/key/import.js","webpack://solid-logic-jss/./node_modules/solid-oidc/node_modules/jose/dist/browser/jwks/local.js","webpack://solid-logic-jss/./node_modules/solid-oidc/node_modules/jose/dist/browser/jwks/remote.js","webpack://solid-logic-jss/./node_modules/solid-oidc/node_modules/jose/dist/browser/runtime/verify.js","webpack://solid-logic-jss/./node_modules/solid-oidc/node_modules/jose/dist/browser/lib/validate_algorithms.js","webpack://solid-logic-jss/./node_modules/solid-oidc/node_modules/jose/dist/browser/jws/compact/verify.js","webpack://solid-logic-jss/./node_modules/solid-oidc/node_modules/jose/dist/browser/jws/flattened/verify.js","webpack://solid-logic-jss/./node_modules/solid-oidc/node_modules/jose/dist/browser/lib/jwt_claims_set.js","webpack://solid-logic-jss/./node_modules/solid-oidc/node_modules/jose/dist/browser/runtime/digest.js","webpack://solid-logic-jss/./node_modules/solid-oidc/node_modules/jose/dist/browser/jwk/thumbprint.js","webpack://solid-logic-jss/./node_modules/solid-oidc/node_modules/jose/dist/browser/runtime/generate.js","webpack://solid-logic-jss/./node_modules/solid-oidc/node_modules/jose/dist/browser/key/generate_key_pair.js","webpack://solid-logic-jss/./node_modules/solid-oidc/node_modules/jose/dist/browser/util/base64url.js","webpack://solid-logic-jss/./node_modules/solid-oidc/solid-oidc.js","webpack://solid-logic-jss/./node_modules/solid-oidc/node_modules/jose/dist/browser/jwt/verify.js","webpack://solid-logic-jss/./node_modules/solid-oidc/node_modules/jose/dist/browser/util/decode_jwt.js","webpack://solid-logic-jss/./src/authSession/solidOidcAdapter.ts","webpack://solid-logic-jss/./src/authSession/authSession.ts","webpack://solid-logic-jss/external module \"rdflib\"","webpack://solid-logic-jss/./src/util/ns.ts","webpack://solid-logic-jss/./src/acl/aclLogic.ts","webpack://solid-logic-jss/./src/authn/authUtil.ts","webpack://solid-logic-jss/./src/authn/SolidAuthnLogic.ts","webpack://solid-logic-jss/./src/util/utils.ts","webpack://solid-logic-jss/./src/chat/chatLogic.ts","webpack://solid-logic-jss/./src/inbox/inboxLogic.ts","webpack://solid-logic-jss/./src/logic/CustomError.ts","webpack://solid-logic-jss/./src/profile/profileLogic.ts","webpack://solid-logic-jss/./src/typeIndex/typeIndexLogic.ts","webpack://solid-logic-jss/./src/logic/solidLogic.ts","webpack://solid-logic-jss/./src/util/containerLogic.ts","webpack://solid-logic-jss/./src/util/utilityLogic.ts","webpack://solid-logic-jss/./src/logic/solidLogicSingleton.ts","webpack://solid-logic-jss/./src/issuer/issuerLogic.ts","webpack://solid-logic-jss/./src/index.ts"],"sourcesContent":["/**\n * Provides a way to access commonly used namespaces\n *\n * Usage:\n *\n *   ```\n *   const $rdf = require('rdflib'); //or any other RDF/JS-compatible library\n *   const ns = require('solid-namespace')($rdf);\n *   const store = $rdf.graph();\n *\n *   let me = ...;\n *   let name = store.any(me, ns.vcard(fn)) || store.any(me, ns.foaf(name));\n *   ```\n * @module vocab\n */\nconst aliases = {\n  acl: 'http://www.w3.org/ns/auth/acl#',\n  arg: 'http://www.w3.org/ns/pim/arg#',\n  as: 'https://www.w3.org/ns/activitystreams#',\n  bookmark: 'http://www.w3.org/2002/01/bookmark#',\n  cal: 'http://www.w3.org/2002/12/cal/ical#',\n  cco: 'http://www.ontologyrepository.com/CommonCoreOntologies/',\n  cert: 'http://www.w3.org/ns/auth/cert#',\n  contact: 'http://www.w3.org/2000/10/swap/pim/contact#',\n  dc: 'http://purl.org/dc/elements/1.1/',\n  dct: 'http://purl.org/dc/terms/',\n  doap: 'http://usefulinc.com/ns/doap#',\n  foaf: 'http://xmlns.com/foaf/0.1/',\n  geo: 'http://www.w3.org/2003/01/geo/wgs84_pos#',\n  gpx: 'http://www.w3.org/ns/pim/gpx#',\n  gr: 'http://purl.org/goodrelations/v1#',\n  http: 'http://www.w3.org/2007/ont/http#',\n  httph: 'http://www.w3.org/2007/ont/httph#',\n  icalTZ: 'http://www.w3.org/2002/12/cal/icaltzd#', // Beware: not cal:\n  ldp: 'http://www.w3.org/ns/ldp#',\n  link: 'http://www.w3.org/2007/ont/link#',\n  log: 'http://www.w3.org/2000/10/swap/log#',\n  meeting: 'http://www.w3.org/ns/pim/meeting#',\n  mo: 'http://purl.org/ontology/mo/',\n  org: 'http://www.w3.org/ns/org#',\n  owl: 'http://www.w3.org/2002/07/owl#',\n  pad: 'http://www.w3.org/ns/pim/pad#',\n  patch: 'http://www.w3.org/ns/pim/patch#',\n  prov: 'http://www.w3.org/ns/prov#',\n  pto: 'http://www.productontology.org/id/',\n  qu: 'http://www.w3.org/2000/10/swap/pim/qif#',\n  trip: 'http://www.w3.org/ns/pim/trip#',\n  rdf: 'http://www.w3.org/1999/02/22-rdf-syntax-ns#',\n  rdfs: 'http://www.w3.org/2000/01/rdf-schema#',\n  rss: 'http://purl.org/rss/1.0/',\n  sched: 'http://www.w3.org/ns/pim/schedule#',\n  schema: 'http://schema.org/', // @@ beware confusion with documents no 303\n  sioc: 'http://rdfs.org/sioc/ns#',\n  skos: 'http://www.w3.org/2004/02/skos/core#',\n  solid: 'http://www.w3.org/ns/solid/terms#',\n  space: 'http://www.w3.org/ns/pim/space#',\n  stat: 'http://www.w3.org/ns/posix/stat#',\n  tab: 'http://www.w3.org/2007/ont/link#',\n  tabont: 'http://www.w3.org/2007/ont/link#',\n  ui: 'http://www.w3.org/ns/ui#',\n  vann: 'http://purl.org/vocab/vann/',\n  vcard: 'http://www.w3.org/2006/vcard/ns#',\n  wf: 'http://www.w3.org/2005/01/wf/flow#',\n  xsd: 'http://www.w3.org/2001/XMLSchema#',\n}\n\n/**\n * @param [rdflib] {RDF} Optional RDF Library (such as rdflib.js or rdf-ext) to inject\n */\nfunction vocab (rdf = { namedNode: u => u }) {\n  const namespaces = {}\n  for (const alias in aliases) {\n    const expansion = aliases[alias]\n    namespaces[alias] = function (localName = '') {\n      return rdf.namedNode(expansion + localName)\n    }\n  };\n\n  return namespaces\n};\n\nmodule.exports = vocab\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","\nexport function log(...args: any[]): void {\n  console.log(...args)\n}\n\nexport function warn(...args: any[]): void {\n  console.warn(...args)\n}\n\nexport function error(...args: any[]): void {\n  console.error(...args)\n}\n\nexport function trace(...args: any[]): void {\n  console.trace(...args)\n}\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","export default crypto;\nexport const isCryptoKey = (key) => key instanceof CryptoKey;\n","function message(msg, actual, ...types) {\n    types = types.filter(Boolean);\n    if (types.length > 2) {\n        const last = types.pop();\n        msg += `one of type ${types.join(', ')}, or ${last}.`;\n    }\n    else if (types.length === 2) {\n        msg += `one of type ${types[0]} or ${types[1]}.`;\n    }\n    else {\n        msg += `of type ${types[0]}.`;\n    }\n    if (actual == null) {\n        msg += ` Received ${actual}`;\n    }\n    else if (typeof actual === 'function' && actual.name) {\n        msg += ` Received function ${actual.name}`;\n    }\n    else if (typeof actual === 'object' && actual != null) {\n        if (actual.constructor?.name) {\n            msg += ` Received an instance of ${actual.constructor.name}`;\n        }\n    }\n    return msg;\n}\nexport default (actual, ...types) => {\n    return message('Key must be ', actual, ...types);\n};\nexport function withAlg(alg, actual, ...types) {\n    return message(`Key for the ${alg} algorithm must be `, actual, ...types);\n}\n","import digest from '../runtime/digest.js';\nexport const encoder = new TextEncoder();\nexport const decoder = new TextDecoder();\nconst MAX_INT32 = 2 ** 32;\nexport function concat(...buffers) {\n    const size = buffers.reduce((acc, { length }) => acc + length, 0);\n    const buf = new Uint8Array(size);\n    let i = 0;\n    for (const buffer of buffers) {\n        buf.set(buffer, i);\n        i += buffer.length;\n    }\n    return buf;\n}\nexport function p2s(alg, p2sInput) {\n    return concat(encoder.encode(alg), new Uint8Array([0]), p2sInput);\n}\nfunction writeUInt32BE(buf, value, offset) {\n    if (value < 0 || value >= MAX_INT32) {\n        throw new RangeError(`value must be >= 0 and <= ${MAX_INT32 - 1}. Received ${value}`);\n    }\n    buf.set([value >>> 24, value >>> 16, value >>> 8, value & 0xff], offset);\n}\nexport function uint64be(value) {\n    const high = Math.floor(value / MAX_INT32);\n    const low = value % MAX_INT32;\n    const buf = new Uint8Array(8);\n    writeUInt32BE(buf, high, 0);\n    writeUInt32BE(buf, low, 4);\n    return buf;\n}\nexport function uint32be(value) {\n    const buf = new Uint8Array(4);\n    writeUInt32BE(buf, value);\n    return buf;\n}\nexport function lengthAndInput(input) {\n    return concat(uint32be(input.length), input);\n}\nexport async function concatKdf(secret, bits, value) {\n    const iterations = Math.ceil((bits >> 3) / 32);\n    const res = new Uint8Array(iterations * 32);\n    for (let iter = 0; iter < iterations; iter++) {\n        const buf = new Uint8Array(4 + secret.length + value.length);\n        buf.set(uint32be(iter + 1));\n        buf.set(secret, 4);\n        buf.set(value, 4 + secret.length);\n        res.set(await digest('sha256', buf), iter * 32);\n    }\n    return res.slice(0, bits >> 3);\n}\n","import { encoder, decoder } from '../lib/buffer_utils.js';\nexport const encodeBase64 = (input) => {\n    let unencoded = input;\n    if (typeof unencoded === 'string') {\n        unencoded = encoder.encode(unencoded);\n    }\n    const CHUNK_SIZE = 0x8000;\n    const arr = [];\n    for (let i = 0; i < unencoded.length; i += CHUNK_SIZE) {\n        arr.push(String.fromCharCode.apply(null, unencoded.subarray(i, i + CHUNK_SIZE)));\n    }\n    return btoa(arr.join(''));\n};\nexport const encode = (input) => {\n    return encodeBase64(input).replace(/=/g, '').replace(/\\+/g, '-').replace(/\\//g, '_');\n};\nexport const decodeBase64 = (encoded) => {\n    const binary = atob(encoded);\n    const bytes = new Uint8Array(binary.length);\n    for (let i = 0; i < binary.length; i++) {\n        bytes[i] = binary.charCodeAt(i);\n    }\n    return bytes;\n};\nexport const decode = (input) => {\n    let encoded = input;\n    if (encoded instanceof Uint8Array) {\n        encoded = decoder.decode(encoded);\n    }\n    encoded = encoded.replace(/-/g, '+').replace(/_/g, '/').replace(/\\s/g, '');\n    try {\n        return decodeBase64(encoded);\n    }\n    catch {\n        throw new TypeError('The input to be decoded is not correctly encoded.');\n    }\n};\n","import { isCryptoKey } from './webcrypto.js';\nexport default (key) => {\n    if (isCryptoKey(key)) {\n        return true;\n    }\n    return key?.[Symbol.toStringTag] === 'KeyObject';\n};\nexport const types = ['CryptoKey'];\n","import crypto, { isCryptoKey } from './webcrypto.js';\nimport invalidKeyInput from '../lib/invalid_key_input.js';\nimport { encode as base64url } from './base64url.js';\nimport { types } from './is_key_like.js';\nconst keyToJWK = async (key) => {\n    if (key instanceof Uint8Array) {\n        return {\n            kty: 'oct',\n            k: base64url(key),\n        };\n    }\n    if (!isCryptoKey(key)) {\n        throw new TypeError(invalidKeyInput(key, ...types, 'Uint8Array'));\n    }\n    if (!key.extractable) {\n        throw new TypeError('non-extractable CryptoKey cannot be exported as a JWK');\n    }\n    const { ext, key_ops, alg, use, ...jwk } = await crypto.subtle.exportKey('jwk', key);\n    return jwk;\n};\nexport default keyToJWK;\n","import { toSPKI as exportPublic } from '../runtime/asn1.js';\nimport { toPKCS8 as exportPrivate } from '../runtime/asn1.js';\nimport keyToJWK from '../runtime/key_to_jwk.js';\nexport async function exportSPKI(key) {\n    return exportPublic(key);\n}\nexport async function exportPKCS8(key) {\n    return exportPrivate(key);\n}\nexport async function exportJWK(key) {\n    return keyToJWK(key);\n}\n","export class JOSEError extends Error {\n    constructor(message, options) {\n        super(message, options);\n        this.code = 'ERR_JOSE_GENERIC';\n        this.name = this.constructor.name;\n        Error.captureStackTrace?.(this, this.constructor);\n    }\n}\nJOSEError.code = 'ERR_JOSE_GENERIC';\nexport class JWTClaimValidationFailed extends JOSEError {\n    constructor(message, payload, claim = 'unspecified', reason = 'unspecified') {\n        super(message, { cause: { claim, reason, payload } });\n        this.code = 'ERR_JWT_CLAIM_VALIDATION_FAILED';\n        this.claim = claim;\n        this.reason = reason;\n        this.payload = payload;\n    }\n}\nJWTClaimValidationFailed.code = 'ERR_JWT_CLAIM_VALIDATION_FAILED';\nexport class JWTExpired extends JOSEError {\n    constructor(message, payload, claim = 'unspecified', reason = 'unspecified') {\n        super(message, { cause: { claim, reason, payload } });\n        this.code = 'ERR_JWT_EXPIRED';\n        this.claim = claim;\n        this.reason = reason;\n        this.payload = payload;\n    }\n}\nJWTExpired.code = 'ERR_JWT_EXPIRED';\nexport class JOSEAlgNotAllowed extends JOSEError {\n    constructor() {\n        super(...arguments);\n        this.code = 'ERR_JOSE_ALG_NOT_ALLOWED';\n    }\n}\nJOSEAlgNotAllowed.code = 'ERR_JOSE_ALG_NOT_ALLOWED';\nexport class JOSENotSupported extends JOSEError {\n    constructor() {\n        super(...arguments);\n        this.code = 'ERR_JOSE_NOT_SUPPORTED';\n    }\n}\nJOSENotSupported.code = 'ERR_JOSE_NOT_SUPPORTED';\nexport class JWEDecryptionFailed extends JOSEError {\n    constructor(message = 'decryption operation failed', options) {\n        super(message, options);\n        this.code = 'ERR_JWE_DECRYPTION_FAILED';\n    }\n}\nJWEDecryptionFailed.code = 'ERR_JWE_DECRYPTION_FAILED';\nexport class JWEInvalid extends JOSEError {\n    constructor() {\n        super(...arguments);\n        this.code = 'ERR_JWE_INVALID';\n    }\n}\nJWEInvalid.code = 'ERR_JWE_INVALID';\nexport class JWSInvalid extends JOSEError {\n    constructor() {\n        super(...arguments);\n        this.code = 'ERR_JWS_INVALID';\n    }\n}\nJWSInvalid.code = 'ERR_JWS_INVALID';\nexport class JWTInvalid extends JOSEError {\n    constructor() {\n        super(...arguments);\n        this.code = 'ERR_JWT_INVALID';\n    }\n}\nJWTInvalid.code = 'ERR_JWT_INVALID';\nexport class JWKInvalid extends JOSEError {\n    constructor() {\n        super(...arguments);\n        this.code = 'ERR_JWK_INVALID';\n    }\n}\nJWKInvalid.code = 'ERR_JWK_INVALID';\nexport class JWKSInvalid extends JOSEError {\n    constructor() {\n        super(...arguments);\n        this.code = 'ERR_JWKS_INVALID';\n    }\n}\nJWKSInvalid.code = 'ERR_JWKS_INVALID';\nexport class JWKSNoMatchingKey extends JOSEError {\n    constructor(message = 'no applicable key found in the JSON Web Key Set', options) {\n        super(message, options);\n        this.code = 'ERR_JWKS_NO_MATCHING_KEY';\n    }\n}\nJWKSNoMatchingKey.code = 'ERR_JWKS_NO_MATCHING_KEY';\nexport class JWKSMultipleMatchingKeys extends JOSEError {\n    constructor(message = 'multiple matching keys found in the JSON Web Key Set', options) {\n        super(message, options);\n        this.code = 'ERR_JWKS_MULTIPLE_MATCHING_KEYS';\n    }\n}\nSymbol.asyncIterator;\nJWKSMultipleMatchingKeys.code = 'ERR_JWKS_MULTIPLE_MATCHING_KEYS';\nexport class JWKSTimeout extends JOSEError {\n    constructor(message = 'request timed out', options) {\n        super(message, options);\n        this.code = 'ERR_JWKS_TIMEOUT';\n    }\n}\nJWKSTimeout.code = 'ERR_JWKS_TIMEOUT';\nexport class JWSSignatureVerificationFailed extends JOSEError {\n    constructor(message = 'signature verification failed', options) {\n        super(message, options);\n        this.code = 'ERR_JWS_SIGNATURE_VERIFICATION_FAILED';\n    }\n}\nJWSSignatureVerificationFailed.code = 'ERR_JWS_SIGNATURE_VERIFICATION_FAILED';\n","import { JOSENotSupported } from '../util/errors.js';\nexport default function subtleDsa(alg, algorithm) {\n    const hash = `SHA-${alg.slice(-3)}`;\n    switch (alg) {\n        case 'HS256':\n        case 'HS384':\n        case 'HS512':\n            return { hash, name: 'HMAC' };\n        case 'PS256':\n        case 'PS384':\n        case 'PS512':\n            return { hash, name: 'RSA-PSS', saltLength: alg.slice(-3) >> 3 };\n        case 'RS256':\n        case 'RS384':\n        case 'RS512':\n            return { hash, name: 'RSASSA-PKCS1-v1_5' };\n        case 'ES256':\n        case 'ES384':\n        case 'ES512':\n            return { hash, name: 'ECDSA', namedCurve: algorithm.namedCurve };\n        case 'Ed25519':\n            return { name: 'Ed25519' };\n        case 'EdDSA':\n            return { name: algorithm.name };\n        default:\n            throw new JOSENotSupported(`alg ${alg} is not supported either by JOSE or your javascript runtime`);\n    }\n}\n","export default (alg, key) => {\n    if (alg.startsWith('RS') || alg.startsWith('PS')) {\n        const { modulusLength } = key.algorithm;\n        if (typeof modulusLength !== 'number' || modulusLength < 2048) {\n            throw new TypeError(`${alg} requires key modulusLength to be 2048 bits or larger`);\n        }\n    }\n};\n","function unusable(name, prop = 'algorithm.name') {\n    return new TypeError(`CryptoKey does not support this operation, its ${prop} must be ${name}`);\n}\nfunction isAlgorithm(algorithm, name) {\n    return algorithm.name === name;\n}\nfunction getHashLength(hash) {\n    return parseInt(hash.name.slice(4), 10);\n}\nfunction getNamedCurve(alg) {\n    switch (alg) {\n        case 'ES256':\n            return 'P-256';\n        case 'ES384':\n            return 'P-384';\n        case 'ES512':\n            return 'P-521';\n        default:\n            throw new Error('unreachable');\n    }\n}\nfunction checkUsage(key, usages) {\n    if (usages.length && !usages.some((expected) => key.usages.includes(expected))) {\n        let msg = 'CryptoKey does not support this operation, its usages must include ';\n        if (usages.length > 2) {\n            const last = usages.pop();\n            msg += `one of ${usages.join(', ')}, or ${last}.`;\n        }\n        else if (usages.length === 2) {\n            msg += `one of ${usages[0]} or ${usages[1]}.`;\n        }\n        else {\n            msg += `${usages[0]}.`;\n        }\n        throw new TypeError(msg);\n    }\n}\nexport function checkSigCryptoKey(key, alg, ...usages) {\n    switch (alg) {\n        case 'HS256':\n        case 'HS384':\n        case 'HS512': {\n            if (!isAlgorithm(key.algorithm, 'HMAC'))\n                throw unusable('HMAC');\n            const expected = parseInt(alg.slice(2), 10);\n            const actual = getHashLength(key.algorithm.hash);\n            if (actual !== expected)\n                throw unusable(`SHA-${expected}`, 'algorithm.hash');\n            break;\n        }\n        case 'RS256':\n        case 'RS384':\n        case 'RS512': {\n            if (!isAlgorithm(key.algorithm, 'RSASSA-PKCS1-v1_5'))\n                throw unusable('RSASSA-PKCS1-v1_5');\n            const expected = parseInt(alg.slice(2), 10);\n            const actual = getHashLength(key.algorithm.hash);\n            if (actual !== expected)\n                throw unusable(`SHA-${expected}`, 'algorithm.hash');\n            break;\n        }\n        case 'PS256':\n        case 'PS384':\n        case 'PS512': {\n            if (!isAlgorithm(key.algorithm, 'RSA-PSS'))\n                throw unusable('RSA-PSS');\n            const expected = parseInt(alg.slice(2), 10);\n            const actual = getHashLength(key.algorithm.hash);\n            if (actual !== expected)\n                throw unusable(`SHA-${expected}`, 'algorithm.hash');\n            break;\n        }\n        case 'EdDSA': {\n            if (key.algorithm.name !== 'Ed25519' && key.algorithm.name !== 'Ed448') {\n                throw unusable('Ed25519 or Ed448');\n            }\n            break;\n        }\n        case 'Ed25519': {\n            if (!isAlgorithm(key.algorithm, 'Ed25519'))\n                throw unusable('Ed25519');\n            break;\n        }\n        case 'ES256':\n        case 'ES384':\n        case 'ES512': {\n            if (!isAlgorithm(key.algorithm, 'ECDSA'))\n                throw unusable('ECDSA');\n            const expected = getNamedCurve(alg);\n            const actual = key.algorithm.namedCurve;\n            if (actual !== expected)\n                throw unusable(expected, 'algorithm.namedCurve');\n            break;\n        }\n        default:\n            throw new TypeError('CryptoKey does not support this operation');\n    }\n    checkUsage(key, usages);\n}\nexport function checkEncCryptoKey(key, alg, ...usages) {\n    switch (alg) {\n        case 'A128GCM':\n        case 'A192GCM':\n        case 'A256GCM': {\n            if (!isAlgorithm(key.algorithm, 'AES-GCM'))\n                throw unusable('AES-GCM');\n            const expected = parseInt(alg.slice(1, 4), 10);\n            const actual = key.algorithm.length;\n            if (actual !== expected)\n                throw unusable(expected, 'algorithm.length');\n            break;\n        }\n        case 'A128KW':\n        case 'A192KW':\n        case 'A256KW': {\n            if (!isAlgorithm(key.algorithm, 'AES-KW'))\n                throw unusable('AES-KW');\n            const expected = parseInt(alg.slice(1, 4), 10);\n            const actual = key.algorithm.length;\n            if (actual !== expected)\n                throw unusable(expected, 'algorithm.length');\n            break;\n        }\n        case 'ECDH': {\n            switch (key.algorithm.name) {\n                case 'ECDH':\n                case 'X25519':\n                case 'X448':\n                    break;\n                default:\n                    throw unusable('ECDH, X25519, or X448');\n            }\n            break;\n        }\n        case 'PBES2-HS256+A128KW':\n        case 'PBES2-HS384+A192KW':\n        case 'PBES2-HS512+A256KW':\n            if (!isAlgorithm(key.algorithm, 'PBKDF2'))\n                throw unusable('PBKDF2');\n            break;\n        case 'RSA-OAEP':\n        case 'RSA-OAEP-256':\n        case 'RSA-OAEP-384':\n        case 'RSA-OAEP-512': {\n            if (!isAlgorithm(key.algorithm, 'RSA-OAEP'))\n                throw unusable('RSA-OAEP');\n            const expected = parseInt(alg.slice(9), 10) || 1;\n            const actual = getHashLength(key.algorithm.hash);\n            if (actual !== expected)\n                throw unusable(`SHA-${expected}`, 'algorithm.hash');\n            break;\n        }\n        default:\n            throw new TypeError('CryptoKey does not support this operation');\n    }\n    checkUsage(key, usages);\n}\n","function isObjectLike(value) {\n    return typeof value === 'object' && value !== null;\n}\nexport default function isObject(input) {\n    if (!isObjectLike(input) || Object.prototype.toString.call(input) !== '[object Object]') {\n        return false;\n    }\n    if (Object.getPrototypeOf(input) === null) {\n        return true;\n    }\n    let proto = input;\n    while (Object.getPrototypeOf(proto) !== null) {\n        proto = Object.getPrototypeOf(proto);\n    }\n    return Object.getPrototypeOf(input) === proto;\n}\n","import isObject from './is_object.js';\nexport function isJWK(key) {\n    return isObject(key) && typeof key.kty === 'string';\n}\nexport function isPrivateJWK(key) {\n    return key.kty !== 'oct' && typeof key.d === 'string';\n}\nexport function isPublicJWK(key) {\n    return key.kty !== 'oct' && typeof key.d === 'undefined';\n}\nexport function isSecretJWK(key) {\n    return isJWK(key) && key.kty === 'oct' && typeof key.k === 'string';\n}\n","import crypto from './webcrypto.js';\nimport { JOSENotSupported } from '../util/errors.js';\nfunction subtleMapping(jwk) {\n    let algorithm;\n    let keyUsages;\n    switch (jwk.kty) {\n        case 'RSA': {\n            switch (jwk.alg) {\n                case 'PS256':\n                case 'PS384':\n                case 'PS512':\n                    algorithm = { name: 'RSA-PSS', hash: `SHA-${jwk.alg.slice(-3)}` };\n                    keyUsages = jwk.d ? ['sign'] : ['verify'];\n                    break;\n                case 'RS256':\n                case 'RS384':\n                case 'RS512':\n                    algorithm = { name: 'RSASSA-PKCS1-v1_5', hash: `SHA-${jwk.alg.slice(-3)}` };\n                    keyUsages = jwk.d ? ['sign'] : ['verify'];\n                    break;\n                case 'RSA-OAEP':\n                case 'RSA-OAEP-256':\n                case 'RSA-OAEP-384':\n                case 'RSA-OAEP-512':\n                    algorithm = {\n                        name: 'RSA-OAEP',\n                        hash: `SHA-${parseInt(jwk.alg.slice(-3), 10) || 1}`,\n                    };\n                    keyUsages = jwk.d ? ['decrypt', 'unwrapKey'] : ['encrypt', 'wrapKey'];\n                    break;\n                default:\n                    throw new JOSENotSupported('Invalid or unsupported JWK \"alg\" (Algorithm) Parameter value');\n            }\n            break;\n        }\n        case 'EC': {\n            switch (jwk.alg) {\n                case 'ES256':\n                    algorithm = { name: 'ECDSA', namedCurve: 'P-256' };\n                    keyUsages = jwk.d ? ['sign'] : ['verify'];\n                    break;\n                case 'ES384':\n                    algorithm = { name: 'ECDSA', namedCurve: 'P-384' };\n                    keyUsages = jwk.d ? ['sign'] : ['verify'];\n                    break;\n                case 'ES512':\n                    algorithm = { name: 'ECDSA', namedCurve: 'P-521' };\n                    keyUsages = jwk.d ? ['sign'] : ['verify'];\n                    break;\n                case 'ECDH-ES':\n                case 'ECDH-ES+A128KW':\n                case 'ECDH-ES+A192KW':\n                case 'ECDH-ES+A256KW':\n                    algorithm = { name: 'ECDH', namedCurve: jwk.crv };\n                    keyUsages = jwk.d ? ['deriveBits'] : [];\n                    break;\n                default:\n                    throw new JOSENotSupported('Invalid or unsupported JWK \"alg\" (Algorithm) Parameter value');\n            }\n            break;\n        }\n        case 'OKP': {\n            switch (jwk.alg) {\n                case 'Ed25519':\n                    algorithm = { name: 'Ed25519' };\n                    keyUsages = jwk.d ? ['sign'] : ['verify'];\n                    break;\n                case 'EdDSA':\n                    algorithm = { name: jwk.crv };\n                    keyUsages = jwk.d ? ['sign'] : ['verify'];\n                    break;\n                case 'ECDH-ES':\n                case 'ECDH-ES+A128KW':\n                case 'ECDH-ES+A192KW':\n                case 'ECDH-ES+A256KW':\n                    algorithm = { name: jwk.crv };\n                    keyUsages = jwk.d ? ['deriveBits'] : [];\n                    break;\n                default:\n                    throw new JOSENotSupported('Invalid or unsupported JWK \"alg\" (Algorithm) Parameter value');\n            }\n            break;\n        }\n        default:\n            throw new JOSENotSupported('Invalid or unsupported JWK \"kty\" (Key Type) Parameter value');\n    }\n    return { algorithm, keyUsages };\n}\nconst parse = async (jwk) => {\n    if (!jwk.alg) {\n        throw new TypeError('\"alg\" argument is required when \"jwk.alg\" is not present');\n    }\n    const { algorithm, keyUsages } = subtleMapping(jwk);\n    const rest = [\n        algorithm,\n        jwk.ext ?? false,\n        jwk.key_ops ?? keyUsages,\n    ];\n    const keyData = { ...jwk };\n    delete keyData.alg;\n    delete keyData.use;\n    return crypto.subtle.importKey('jwk', keyData, ...rest);\n};\nexport default parse;\n","import { isJWK } from '../lib/is_jwk.js';\nimport { decode } from './base64url.js';\nimport importJWK from './jwk_to_key.js';\nconst exportKeyValue = (k) => decode(k);\nlet privCache;\nlet pubCache;\nconst isKeyObject = (key) => {\n    return key?.[Symbol.toStringTag] === 'KeyObject';\n};\nconst importAndCache = async (cache, key, jwk, alg, freeze = false) => {\n    let cached = cache.get(key);\n    if (cached?.[alg]) {\n        return cached[alg];\n    }\n    const cryptoKey = await importJWK({ ...jwk, alg });\n    if (freeze)\n        Object.freeze(key);\n    if (!cached) {\n        cache.set(key, { [alg]: cryptoKey });\n    }\n    else {\n        cached[alg] = cryptoKey;\n    }\n    return cryptoKey;\n};\nconst normalizePublicKey = (key, alg) => {\n    if (isKeyObject(key)) {\n        let jwk = key.export({ format: 'jwk' });\n        delete jwk.d;\n        delete jwk.dp;\n        delete jwk.dq;\n        delete jwk.p;\n        delete jwk.q;\n        delete jwk.qi;\n        if (jwk.k) {\n            return exportKeyValue(jwk.k);\n        }\n        pubCache || (pubCache = new WeakMap());\n        return importAndCache(pubCache, key, jwk, alg);\n    }\n    if (isJWK(key)) {\n        if (key.k)\n            return decode(key.k);\n        pubCache || (pubCache = new WeakMap());\n        const cryptoKey = importAndCache(pubCache, key, key, alg, true);\n        return cryptoKey;\n    }\n    return key;\n};\nconst normalizePrivateKey = (key, alg) => {\n    if (isKeyObject(key)) {\n        let jwk = key.export({ format: 'jwk' });\n        if (jwk.k) {\n            return exportKeyValue(jwk.k);\n        }\n        privCache || (privCache = new WeakMap());\n        return importAndCache(privCache, key, jwk, alg);\n    }\n    if (isJWK(key)) {\n        if (key.k)\n            return decode(key.k);\n        privCache || (privCache = new WeakMap());\n        const cryptoKey = importAndCache(privCache, key, key, alg, true);\n        return cryptoKey;\n    }\n    return key;\n};\nexport default { normalizePublicKey, normalizePrivateKey };\n","import crypto, { isCryptoKey } from './webcrypto.js';\nimport { checkSigCryptoKey } from '../lib/crypto_key.js';\nimport invalidKeyInput from '../lib/invalid_key_input.js';\nimport { types } from './is_key_like.js';\nimport normalize from './normalize_key.js';\nexport default async function getCryptoKey(alg, key, usage) {\n    if (usage === 'sign') {\n        key = await normalize.normalizePrivateKey(key, alg);\n    }\n    if (usage === 'verify') {\n        key = await normalize.normalizePublicKey(key, alg);\n    }\n    if (isCryptoKey(key)) {\n        checkSigCryptoKey(key, alg, usage);\n        return key;\n    }\n    if (key instanceof Uint8Array) {\n        if (!alg.startsWith('HS')) {\n            throw new TypeError(invalidKeyInput(key, ...types));\n        }\n        return crypto.subtle.importKey('raw', key, { hash: `SHA-${alg.slice(-3)}`, name: 'HMAC' }, false, [usage]);\n    }\n    throw new TypeError(invalidKeyInput(key, ...types, 'Uint8Array', 'JSON Web Key'));\n}\n","import subtleAlgorithm from './subtle_dsa.js';\nimport crypto from './webcrypto.js';\nimport checkKeyLength from './check_key_length.js';\nimport getSignKey from './get_sign_verify_key.js';\nconst sign = async (alg, key, data) => {\n    const cryptoKey = await getSignKey(alg, key, 'sign');\n    checkKeyLength(alg, cryptoKey);\n    const signature = await crypto.subtle.sign(subtleAlgorithm(alg, cryptoKey.algorithm), cryptoKey, data);\n    return new Uint8Array(signature);\n};\nexport default sign;\n","const isDisjoint = (...headers) => {\n    const sources = headers.filter(Boolean);\n    if (sources.length === 0 || sources.length === 1) {\n        return true;\n    }\n    let acc;\n    for (const header of sources) {\n        const parameters = Object.keys(header);\n        if (!acc || acc.size === 0) {\n            acc = new Set(parameters);\n            continue;\n        }\n        for (const parameter of parameters) {\n            if (acc.has(parameter)) {\n                return false;\n            }\n            acc.add(parameter);\n        }\n    }\n    return true;\n};\nexport default isDisjoint;\n","import { withAlg as invalidKeyInput } from './invalid_key_input.js';\nimport isKeyLike, { types } from '../runtime/is_key_like.js';\nimport * as jwk from './is_jwk.js';\nconst tag = (key) => key?.[Symbol.toStringTag];\nconst jwkMatchesOp = (alg, key, usage) => {\n    if (key.use !== undefined && key.use !== 'sig') {\n        throw new TypeError('Invalid key for this operation, when present its use must be sig');\n    }\n    if (key.key_ops !== undefined && key.key_ops.includes?.(usage) !== true) {\n        throw new TypeError(`Invalid key for this operation, when present its key_ops must include ${usage}`);\n    }\n    if (key.alg !== undefined && key.alg !== alg) {\n        throw new TypeError(`Invalid key for this operation, when present its alg must be ${alg}`);\n    }\n    return true;\n};\nconst symmetricTypeCheck = (alg, key, usage, allowJwk) => {\n    if (key instanceof Uint8Array)\n        return;\n    if (allowJwk && jwk.isJWK(key)) {\n        if (jwk.isSecretJWK(key) && jwkMatchesOp(alg, key, usage))\n            return;\n        throw new TypeError(`JSON Web Key for symmetric algorithms must have JWK \"kty\" (Key Type) equal to \"oct\" and the JWK \"k\" (Key Value) present`);\n    }\n    if (!isKeyLike(key)) {\n        throw new TypeError(invalidKeyInput(alg, key, ...types, 'Uint8Array', allowJwk ? 'JSON Web Key' : null));\n    }\n    if (key.type !== 'secret') {\n        throw new TypeError(`${tag(key)} instances for symmetric algorithms must be of type \"secret\"`);\n    }\n};\nconst asymmetricTypeCheck = (alg, key, usage, allowJwk) => {\n    if (allowJwk && jwk.isJWK(key)) {\n        switch (usage) {\n            case 'sign':\n                if (jwk.isPrivateJWK(key) && jwkMatchesOp(alg, key, usage))\n                    return;\n                throw new TypeError(`JSON Web Key for this operation be a private JWK`);\n            case 'verify':\n                if (jwk.isPublicJWK(key) && jwkMatchesOp(alg, key, usage))\n                    return;\n                throw new TypeError(`JSON Web Key for this operation be a public JWK`);\n        }\n    }\n    if (!isKeyLike(key)) {\n        throw new TypeError(invalidKeyInput(alg, key, ...types, allowJwk ? 'JSON Web Key' : null));\n    }\n    if (key.type === 'secret') {\n        throw new TypeError(`${tag(key)} instances for asymmetric algorithms must not be of type \"secret\"`);\n    }\n    if (usage === 'sign' && key.type === 'public') {\n        throw new TypeError(`${tag(key)} instances for asymmetric algorithm signing must be of type \"private\"`);\n    }\n    if (usage === 'decrypt' && key.type === 'public') {\n        throw new TypeError(`${tag(key)} instances for asymmetric algorithm decryption must be of type \"private\"`);\n    }\n    if (key.algorithm && usage === 'verify' && key.type === 'private') {\n        throw new TypeError(`${tag(key)} instances for asymmetric algorithm verifying must be of type \"public\"`);\n    }\n    if (key.algorithm && usage === 'encrypt' && key.type === 'private') {\n        throw new TypeError(`${tag(key)} instances for asymmetric algorithm encryption must be of type \"public\"`);\n    }\n};\nfunction checkKeyType(allowJwk, alg, key, usage) {\n    const symmetric = alg.startsWith('HS') ||\n        alg === 'dir' ||\n        alg.startsWith('PBES2') ||\n        /^A\\d{3}(?:GCM)?KW$/.test(alg);\n    if (symmetric) {\n        symmetricTypeCheck(alg, key, usage, allowJwk);\n    }\n    else {\n        asymmetricTypeCheck(alg, key, usage, allowJwk);\n    }\n}\nexport default checkKeyType.bind(undefined, false);\nexport const checkKeyTypeWithJwk = checkKeyType.bind(undefined, true);\n","import { JOSENotSupported } from '../util/errors.js';\nfunction validateCrit(Err, recognizedDefault, recognizedOption, protectedHeader, joseHeader) {\n    if (joseHeader.crit !== undefined && protectedHeader?.crit === undefined) {\n        throw new Err('\"crit\" (Critical) Header Parameter MUST be integrity protected');\n    }\n    if (!protectedHeader || protectedHeader.crit === undefined) {\n        return new Set();\n    }\n    if (!Array.isArray(protectedHeader.crit) ||\n        protectedHeader.crit.length === 0 ||\n        protectedHeader.crit.some((input) => typeof input !== 'string' || input.length === 0)) {\n        throw new Err('\"crit\" (Critical) Header Parameter MUST be an array of non-empty strings when present');\n    }\n    let recognized;\n    if (recognizedOption !== undefined) {\n        recognized = new Map([...Object.entries(recognizedOption), ...recognizedDefault.entries()]);\n    }\n    else {\n        recognized = recognizedDefault;\n    }\n    for (const parameter of protectedHeader.crit) {\n        if (!recognized.has(parameter)) {\n            throw new JOSENotSupported(`Extension Header Parameter \"${parameter}\" is not recognized`);\n        }\n        if (joseHeader[parameter] === undefined) {\n            throw new Err(`Extension Header Parameter \"${parameter}\" is missing`);\n        }\n        if (recognized.get(parameter) && protectedHeader[parameter] === undefined) {\n            throw new Err(`Extension Header Parameter \"${parameter}\" MUST be integrity protected`);\n        }\n    }\n    return new Set(protectedHeader.crit);\n}\nexport default validateCrit;\n","import { encode as base64url } from '../../runtime/base64url.js';\nimport sign from '../../runtime/sign.js';\nimport isDisjoint from '../../lib/is_disjoint.js';\nimport { JWSInvalid } from '../../util/errors.js';\nimport { encoder, decoder, concat } from '../../lib/buffer_utils.js';\nimport { checkKeyTypeWithJwk } from '../../lib/check_key_type.js';\nimport validateCrit from '../../lib/validate_crit.js';\nexport class FlattenedSign {\n    constructor(payload) {\n        if (!(payload instanceof Uint8Array)) {\n            throw new TypeError('payload must be an instance of Uint8Array');\n        }\n        this._payload = payload;\n    }\n    setProtectedHeader(protectedHeader) {\n        if (this._protectedHeader) {\n            throw new TypeError('setProtectedHeader can only be called once');\n        }\n        this._protectedHeader = protectedHeader;\n        return this;\n    }\n    setUnprotectedHeader(unprotectedHeader) {\n        if (this._unprotectedHeader) {\n            throw new TypeError('setUnprotectedHeader can only be called once');\n        }\n        this._unprotectedHeader = unprotectedHeader;\n        return this;\n    }\n    async sign(key, options) {\n        if (!this._protectedHeader && !this._unprotectedHeader) {\n            throw new JWSInvalid('either setProtectedHeader or setUnprotectedHeader must be called before #sign()');\n        }\n        if (!isDisjoint(this._protectedHeader, this._unprotectedHeader)) {\n            throw new JWSInvalid('JWS Protected and JWS Unprotected Header Parameter names must be disjoint');\n        }\n        const joseHeader = {\n            ...this._protectedHeader,\n            ...this._unprotectedHeader,\n        };\n        const extensions = validateCrit(JWSInvalid, new Map([['b64', true]]), options?.crit, this._protectedHeader, joseHeader);\n        let b64 = true;\n        if (extensions.has('b64')) {\n            b64 = this._protectedHeader.b64;\n            if (typeof b64 !== 'boolean') {\n                throw new JWSInvalid('The \"b64\" (base64url-encode payload) Header Parameter must be a boolean');\n            }\n        }\n        const { alg } = joseHeader;\n        if (typeof alg !== 'string' || !alg) {\n            throw new JWSInvalid('JWS \"alg\" (Algorithm) Header Parameter missing or invalid');\n        }\n        checkKeyTypeWithJwk(alg, key, 'sign');\n        let payload = this._payload;\n        if (b64) {\n            payload = encoder.encode(base64url(payload));\n        }\n        let protectedHeader;\n        if (this._protectedHeader) {\n            protectedHeader = encoder.encode(base64url(JSON.stringify(this._protectedHeader)));\n        }\n        else {\n            protectedHeader = encoder.encode('');\n        }\n        const data = concat(protectedHeader, encoder.encode('.'), payload);\n        const signature = await sign(alg, key, data);\n        const jws = {\n            signature: base64url(signature),\n            payload: '',\n        };\n        if (b64) {\n            jws.payload = decoder.decode(payload);\n        }\n        if (this._unprotectedHeader) {\n            jws.header = this._unprotectedHeader;\n        }\n        if (this._protectedHeader) {\n            jws.protected = decoder.decode(protectedHeader);\n        }\n        return jws;\n    }\n}\n","import { FlattenedSign } from '../flattened/sign.js';\nexport class CompactSign {\n    constructor(payload) {\n        this._flattened = new FlattenedSign(payload);\n    }\n    setProtectedHeader(protectedHeader) {\n        this._flattened.setProtectedHeader(protectedHeader);\n        return this;\n    }\n    async sign(key, options) {\n        const jws = await this._flattened.sign(key, options);\n        if (jws.payload === undefined) {\n            throw new TypeError('use the flattened module for creating JWS with b64: false');\n        }\n        return `${jws.protected}.${jws.payload}.${jws.signature}`;\n    }\n}\n","export default (date) => Math.floor(date.getTime() / 1000);\n","const minute = 60;\nconst hour = minute * 60;\nconst day = hour * 24;\nconst week = day * 7;\nconst year = day * 365.25;\nconst REGEX = /^(\\+|\\-)? ?(\\d+|\\d+\\.\\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)(?: (ago|from now))?$/i;\nexport default (str) => {\n    const matched = REGEX.exec(str);\n    if (!matched || (matched[4] && matched[1])) {\n        throw new TypeError('Invalid time period format');\n    }\n    const value = parseFloat(matched[2]);\n    const unit = matched[3].toLowerCase();\n    let numericDate;\n    switch (unit) {\n        case 'sec':\n        case 'secs':\n        case 'second':\n        case 'seconds':\n        case 's':\n            numericDate = Math.round(value);\n            break;\n        case 'minute':\n        case 'minutes':\n        case 'min':\n        case 'mins':\n        case 'm':\n            numericDate = Math.round(value * minute);\n            break;\n        case 'hour':\n        case 'hours':\n        case 'hr':\n        case 'hrs':\n        case 'h':\n            numericDate = Math.round(value * hour);\n            break;\n        case 'day':\n        case 'days':\n        case 'd':\n            numericDate = Math.round(value * day);\n            break;\n        case 'week':\n        case 'weeks':\n        case 'w':\n            numericDate = Math.round(value * week);\n            break;\n        default:\n            numericDate = Math.round(value * year);\n            break;\n    }\n    if (matched[1] === '-' || matched[4] === 'ago') {\n        return -numericDate;\n    }\n    return numericDate;\n};\n","import epoch from '../lib/epoch.js';\nimport isObject from '../lib/is_object.js';\nimport secs from '../lib/secs.js';\nfunction validateInput(label, input) {\n    if (!Number.isFinite(input)) {\n        throw new TypeError(`Invalid ${label} input`);\n    }\n    return input;\n}\nexport class ProduceJWT {\n    constructor(payload = {}) {\n        if (!isObject(payload)) {\n            throw new TypeError('JWT Claims Set MUST be an object');\n        }\n        this._payload = payload;\n    }\n    setIssuer(issuer) {\n        this._payload = { ...this._payload, iss: issuer };\n        return this;\n    }\n    setSubject(subject) {\n        this._payload = { ...this._payload, sub: subject };\n        return this;\n    }\n    setAudience(audience) {\n        this._payload = { ...this._payload, aud: audience };\n        return this;\n    }\n    setJti(jwtId) {\n        this._payload = { ...this._payload, jti: jwtId };\n        return this;\n    }\n    setNotBefore(input) {\n        if (typeof input === 'number') {\n            this._payload = { ...this._payload, nbf: validateInput('setNotBefore', input) };\n        }\n        else if (input instanceof Date) {\n            this._payload = { ...this._payload, nbf: validateInput('setNotBefore', epoch(input)) };\n        }\n        else {\n            this._payload = { ...this._payload, nbf: epoch(new Date()) + secs(input) };\n        }\n        return this;\n    }\n    setExpirationTime(input) {\n        if (typeof input === 'number') {\n            this._payload = { ...this._payload, exp: validateInput('setExpirationTime', input) };\n        }\n        else if (input instanceof Date) {\n            this._payload = { ...this._payload, exp: validateInput('setExpirationTime', epoch(input)) };\n        }\n        else {\n            this._payload = { ...this._payload, exp: epoch(new Date()) + secs(input) };\n        }\n        return this;\n    }\n    setIssuedAt(input) {\n        if (typeof input === 'undefined') {\n            this._payload = { ...this._payload, iat: epoch(new Date()) };\n        }\n        else if (input instanceof Date) {\n            this._payload = { ...this._payload, iat: validateInput('setIssuedAt', epoch(input)) };\n        }\n        else if (typeof input === 'string') {\n            this._payload = {\n                ...this._payload,\n                iat: validateInput('setIssuedAt', epoch(new Date()) + secs(input)),\n            };\n        }\n        else {\n            this._payload = { ...this._payload, iat: validateInput('setIssuedAt', input) };\n        }\n        return this;\n    }\n}\n","import { CompactSign } from '../jws/compact/sign.js';\nimport { JWTInvalid } from '../util/errors.js';\nimport { encoder } from '../lib/buffer_utils.js';\nimport { ProduceJWT } from './produce.js';\nexport class SignJWT extends ProduceJWT {\n    setProtectedHeader(protectedHeader) {\n        this._protectedHeader = protectedHeader;\n        return this;\n    }\n    async sign(key, options) {\n        const sig = new CompactSign(encoder.encode(JSON.stringify(this._payload)));\n        sig.setProtectedHeader(this._protectedHeader);\n        if (Array.isArray(this._protectedHeader?.crit) &&\n            this._protectedHeader.crit.includes('b64') &&\n            this._protectedHeader.b64 === false) {\n            throw new JWTInvalid('JWTs MUST NOT use unencoded payload');\n        }\n        return sig.sign(key, options);\n    }\n}\n","import { JOSEError, JWKSTimeout } from '../util/errors.js';\nconst fetchJwks = async (url, timeout, options) => {\n    let controller;\n    let id;\n    let timedOut = false;\n    if (typeof AbortController === 'function') {\n        controller = new AbortController();\n        id = setTimeout(() => {\n            timedOut = true;\n            controller.abort();\n        }, timeout);\n    }\n    const response = await fetch(url.href, {\n        signal: controller ? controller.signal : undefined,\n        redirect: 'manual',\n        headers: options.headers,\n    }).catch((err) => {\n        if (timedOut)\n            throw new JWKSTimeout();\n        throw err;\n    });\n    if (id !== undefined)\n        clearTimeout(id);\n    if (response.status !== 200) {\n        throw new JOSEError('Expected 200 OK from the JSON Web Key Set HTTP response');\n    }\n    try {\n        return await response.json();\n    }\n    catch {\n        throw new JOSEError('Failed to parse the JSON Web Key Set HTTP response as JSON');\n    }\n};\nexport default fetchJwks;\n","import { decode as decodeBase64URL } from '../runtime/base64url.js';\nimport { fromSPKI, fromPKCS8, fromX509 } from '../runtime/asn1.js';\nimport asKeyObject from '../runtime/jwk_to_key.js';\nimport { JOSENotSupported } from '../util/errors.js';\nimport isObject from '../lib/is_object.js';\nexport async function importSPKI(spki, alg, options) {\n    if (typeof spki !== 'string' || spki.indexOf('-----BEGIN PUBLIC KEY-----') !== 0) {\n        throw new TypeError('\"spki\" must be SPKI formatted string');\n    }\n    return fromSPKI(spki, alg, options);\n}\nexport async function importX509(x509, alg, options) {\n    if (typeof x509 !== 'string' || x509.indexOf('-----BEGIN CERTIFICATE-----') !== 0) {\n        throw new TypeError('\"x509\" must be X.509 formatted string');\n    }\n    return fromX509(x509, alg, options);\n}\nexport async function importPKCS8(pkcs8, alg, options) {\n    if (typeof pkcs8 !== 'string' || pkcs8.indexOf('-----BEGIN PRIVATE KEY-----') !== 0) {\n        throw new TypeError('\"pkcs8\" must be PKCS#8 formatted string');\n    }\n    return fromPKCS8(pkcs8, alg, options);\n}\nexport async function importJWK(jwk, alg) {\n    if (!isObject(jwk)) {\n        throw new TypeError('JWK must be an object');\n    }\n    alg || (alg = jwk.alg);\n    switch (jwk.kty) {\n        case 'oct':\n            if (typeof jwk.k !== 'string' || !jwk.k) {\n                throw new TypeError('missing \"k\" (Key Value) Parameter value');\n            }\n            return decodeBase64URL(jwk.k);\n        case 'RSA':\n            if ('oth' in jwk && jwk.oth !== undefined) {\n                throw new JOSENotSupported('RSA JWK \"oth\" (Other Primes Info) Parameter value is not supported');\n            }\n        case 'EC':\n        case 'OKP':\n            return asKeyObject({ ...jwk, alg });\n        default:\n            throw new JOSENotSupported('Unsupported \"kty\" (Key Type) Parameter value');\n    }\n}\n","import { importJWK } from '../key/import.js';\nimport { JWKSInvalid, JOSENotSupported, JWKSNoMatchingKey, JWKSMultipleMatchingKeys, } from '../util/errors.js';\nimport isObject from '../lib/is_object.js';\nfunction getKtyFromAlg(alg) {\n    switch (typeof alg === 'string' && alg.slice(0, 2)) {\n        case 'RS':\n        case 'PS':\n            return 'RSA';\n        case 'ES':\n            return 'EC';\n        case 'Ed':\n            return 'OKP';\n        default:\n            throw new JOSENotSupported('Unsupported \"alg\" value for a JSON Web Key Set');\n    }\n}\nfunction isJWKSLike(jwks) {\n    return (jwks &&\n        typeof jwks === 'object' &&\n        Array.isArray(jwks.keys) &&\n        jwks.keys.every(isJWKLike));\n}\nfunction isJWKLike(key) {\n    return isObject(key);\n}\nfunction clone(obj) {\n    if (typeof structuredClone === 'function') {\n        return structuredClone(obj);\n    }\n    return JSON.parse(JSON.stringify(obj));\n}\nclass LocalJWKSet {\n    constructor(jwks) {\n        this._cached = new WeakMap();\n        if (!isJWKSLike(jwks)) {\n            throw new JWKSInvalid('JSON Web Key Set malformed');\n        }\n        this._jwks = clone(jwks);\n    }\n    async getKey(protectedHeader, token) {\n        const { alg, kid } = { ...protectedHeader, ...token?.header };\n        const kty = getKtyFromAlg(alg);\n        const candidates = this._jwks.keys.filter((jwk) => {\n            let candidate = kty === jwk.kty;\n            if (candidate && typeof kid === 'string') {\n                candidate = kid === jwk.kid;\n            }\n            if (candidate && typeof jwk.alg === 'string') {\n                candidate = alg === jwk.alg;\n            }\n            if (candidate && typeof jwk.use === 'string') {\n                candidate = jwk.use === 'sig';\n            }\n            if (candidate && Array.isArray(jwk.key_ops)) {\n                candidate = jwk.key_ops.includes('verify');\n            }\n            if (candidate) {\n                switch (alg) {\n                    case 'ES256':\n                        candidate = jwk.crv === 'P-256';\n                        break;\n                    case 'ES256K':\n                        candidate = jwk.crv === 'secp256k1';\n                        break;\n                    case 'ES384':\n                        candidate = jwk.crv === 'P-384';\n                        break;\n                    case 'ES512':\n                        candidate = jwk.crv === 'P-521';\n                        break;\n                    case 'Ed25519':\n                        candidate = jwk.crv === 'Ed25519';\n                        break;\n                    case 'EdDSA':\n                        candidate = jwk.crv === 'Ed25519' || jwk.crv === 'Ed448';\n                        break;\n                }\n            }\n            return candidate;\n        });\n        const { 0: jwk, length } = candidates;\n        if (length === 0) {\n            throw new JWKSNoMatchingKey();\n        }\n        if (length !== 1) {\n            const error = new JWKSMultipleMatchingKeys();\n            const { _cached } = this;\n            error[Symbol.asyncIterator] = async function* () {\n                for (const jwk of candidates) {\n                    try {\n                        yield await importWithAlgCache(_cached, jwk, alg);\n                    }\n                    catch { }\n                }\n            };\n            throw error;\n        }\n        return importWithAlgCache(this._cached, jwk, alg);\n    }\n}\nasync function importWithAlgCache(cache, jwk, alg) {\n    const cached = cache.get(jwk) || cache.set(jwk, {}).get(jwk);\n    if (cached[alg] === undefined) {\n        const key = await importJWK({ ...jwk, ext: true }, alg);\n        if (key instanceof Uint8Array || key.type !== 'public') {\n            throw new JWKSInvalid('JSON Web Key Set members must be public keys');\n        }\n        cached[alg] = key;\n    }\n    return cached[alg];\n}\nexport function createLocalJWKSet(jwks) {\n    const set = new LocalJWKSet(jwks);\n    const localJWKSet = async (protectedHeader, token) => set.getKey(protectedHeader, token);\n    Object.defineProperties(localJWKSet, {\n        jwks: {\n            value: () => clone(set._jwks),\n            enumerable: true,\n            configurable: false,\n            writable: false,\n        },\n    });\n    return localJWKSet;\n}\n","import fetchJwks from '../runtime/fetch_jwks.js';\nimport { JWKSNoMatchingKey } from '../util/errors.js';\nimport { createLocalJWKSet } from './local.js';\nimport isObject from '../lib/is_object.js';\nfunction isCloudflareWorkers() {\n    return (typeof WebSocketPair !== 'undefined' ||\n        (typeof navigator !== 'undefined' && navigator.userAgent === 'Cloudflare-Workers') ||\n        (typeof EdgeRuntime !== 'undefined' && EdgeRuntime === 'vercel'));\n}\nlet USER_AGENT;\nif (typeof navigator === 'undefined' || !navigator.userAgent?.startsWith?.('Mozilla/5.0 ')) {\n    const NAME = 'jose';\n    const VERSION = 'v5.10.0';\n    USER_AGENT = `${NAME}/${VERSION}`;\n}\nexport const jwksCache = Symbol();\nfunction isFreshJwksCache(input, cacheMaxAge) {\n    if (typeof input !== 'object' || input === null) {\n        return false;\n    }\n    if (!('uat' in input) || typeof input.uat !== 'number' || Date.now() - input.uat >= cacheMaxAge) {\n        return false;\n    }\n    if (!('jwks' in input) ||\n        !isObject(input.jwks) ||\n        !Array.isArray(input.jwks.keys) ||\n        !Array.prototype.every.call(input.jwks.keys, isObject)) {\n        return false;\n    }\n    return true;\n}\nclass RemoteJWKSet {\n    constructor(url, options) {\n        if (!(url instanceof URL)) {\n            throw new TypeError('url must be an instance of URL');\n        }\n        this._url = new URL(url.href);\n        this._options = { agent: options?.agent, headers: options?.headers };\n        this._timeoutDuration =\n            typeof options?.timeoutDuration === 'number' ? options?.timeoutDuration : 5000;\n        this._cooldownDuration =\n            typeof options?.cooldownDuration === 'number' ? options?.cooldownDuration : 30000;\n        this._cacheMaxAge = typeof options?.cacheMaxAge === 'number' ? options?.cacheMaxAge : 600000;\n        if (options?.[jwksCache] !== undefined) {\n            this._cache = options?.[jwksCache];\n            if (isFreshJwksCache(options?.[jwksCache], this._cacheMaxAge)) {\n                this._jwksTimestamp = this._cache.uat;\n                this._local = createLocalJWKSet(this._cache.jwks);\n            }\n        }\n    }\n    coolingDown() {\n        return typeof this._jwksTimestamp === 'number'\n            ? Date.now() < this._jwksTimestamp + this._cooldownDuration\n            : false;\n    }\n    fresh() {\n        return typeof this._jwksTimestamp === 'number'\n            ? Date.now() < this._jwksTimestamp + this._cacheMaxAge\n            : false;\n    }\n    async getKey(protectedHeader, token) {\n        if (!this._local || !this.fresh()) {\n            await this.reload();\n        }\n        try {\n            return await this._local(protectedHeader, token);\n        }\n        catch (err) {\n            if (err instanceof JWKSNoMatchingKey) {\n                if (this.coolingDown() === false) {\n                    await this.reload();\n                    return this._local(protectedHeader, token);\n                }\n            }\n            throw err;\n        }\n    }\n    async reload() {\n        if (this._pendingFetch && isCloudflareWorkers()) {\n            this._pendingFetch = undefined;\n        }\n        const headers = new Headers(this._options.headers);\n        if (USER_AGENT && !headers.has('User-Agent')) {\n            headers.set('User-Agent', USER_AGENT);\n            this._options.headers = Object.fromEntries(headers.entries());\n        }\n        this._pendingFetch || (this._pendingFetch = fetchJwks(this._url, this._timeoutDuration, this._options)\n            .then((json) => {\n            this._local = createLocalJWKSet(json);\n            if (this._cache) {\n                this._cache.uat = Date.now();\n                this._cache.jwks = json;\n            }\n            this._jwksTimestamp = Date.now();\n            this._pendingFetch = undefined;\n        })\n            .catch((err) => {\n            this._pendingFetch = undefined;\n            throw err;\n        }));\n        await this._pendingFetch;\n    }\n}\nexport function createRemoteJWKSet(url, options) {\n    const set = new RemoteJWKSet(url, options);\n    const remoteJWKSet = async (protectedHeader, token) => set.getKey(protectedHeader, token);\n    Object.defineProperties(remoteJWKSet, {\n        coolingDown: {\n            get: () => set.coolingDown(),\n            enumerable: true,\n            configurable: false,\n        },\n        fresh: {\n            get: () => set.fresh(),\n            enumerable: true,\n            configurable: false,\n        },\n        reload: {\n            value: () => set.reload(),\n            enumerable: true,\n            configurable: false,\n            writable: false,\n        },\n        reloading: {\n            get: () => !!set._pendingFetch,\n            enumerable: true,\n            configurable: false,\n        },\n        jwks: {\n            value: () => set._local?.jwks(),\n            enumerable: true,\n            configurable: false,\n            writable: false,\n        },\n    });\n    return remoteJWKSet;\n}\nexport const experimental_jwksCache = jwksCache;\n","import subtleAlgorithm from './subtle_dsa.js';\nimport crypto from './webcrypto.js';\nimport checkKeyLength from './check_key_length.js';\nimport getVerifyKey from './get_sign_verify_key.js';\nconst verify = async (alg, key, signature, data) => {\n    const cryptoKey = await getVerifyKey(alg, key, 'verify');\n    checkKeyLength(alg, cryptoKey);\n    const algorithm = subtleAlgorithm(alg, cryptoKey.algorithm);\n    try {\n        return await crypto.subtle.verify(algorithm, cryptoKey, signature, data);\n    }\n    catch {\n        return false;\n    }\n};\nexport default verify;\n","const validateAlgorithms = (option, algorithms) => {\n    if (algorithms !== undefined &&\n        (!Array.isArray(algorithms) || algorithms.some((s) => typeof s !== 'string'))) {\n        throw new TypeError(`\"${option}\" option must be an array of strings`);\n    }\n    if (!algorithms) {\n        return undefined;\n    }\n    return new Set(algorithms);\n};\nexport default validateAlgorithms;\n","import { flattenedVerify } from '../flattened/verify.js';\nimport { JWSInvalid } from '../../util/errors.js';\nimport { decoder } from '../../lib/buffer_utils.js';\nexport async function compactVerify(jws, key, options) {\n    if (jws instanceof Uint8Array) {\n        jws = decoder.decode(jws);\n    }\n    if (typeof jws !== 'string') {\n        throw new JWSInvalid('Compact JWS must be a string or Uint8Array');\n    }\n    const { 0: protectedHeader, 1: payload, 2: signature, length } = jws.split('.');\n    if (length !== 3) {\n        throw new JWSInvalid('Invalid Compact JWS');\n    }\n    const verified = await flattenedVerify({ payload, protected: protectedHeader, signature }, key, options);\n    const result = { payload: verified.payload, protectedHeader: verified.protectedHeader };\n    if (typeof key === 'function') {\n        return { ...result, key: verified.key };\n    }\n    return result;\n}\n","import { decode as base64url } from '../../runtime/base64url.js';\nimport verify from '../../runtime/verify.js';\nimport { JOSEAlgNotAllowed, JWSInvalid, JWSSignatureVerificationFailed } from '../../util/errors.js';\nimport { concat, encoder, decoder } from '../../lib/buffer_utils.js';\nimport isDisjoint from '../../lib/is_disjoint.js';\nimport isObject from '../../lib/is_object.js';\nimport { checkKeyTypeWithJwk } from '../../lib/check_key_type.js';\nimport validateCrit from '../../lib/validate_crit.js';\nimport validateAlgorithms from '../../lib/validate_algorithms.js';\nimport { isJWK } from '../../lib/is_jwk.js';\nimport { importJWK } from '../../key/import.js';\nexport async function flattenedVerify(jws, key, options) {\n    if (!isObject(jws)) {\n        throw new JWSInvalid('Flattened JWS must be an object');\n    }\n    if (jws.protected === undefined && jws.header === undefined) {\n        throw new JWSInvalid('Flattened JWS must have either of the \"protected\" or \"header\" members');\n    }\n    if (jws.protected !== undefined && typeof jws.protected !== 'string') {\n        throw new JWSInvalid('JWS Protected Header incorrect type');\n    }\n    if (jws.payload === undefined) {\n        throw new JWSInvalid('JWS Payload missing');\n    }\n    if (typeof jws.signature !== 'string') {\n        throw new JWSInvalid('JWS Signature missing or incorrect type');\n    }\n    if (jws.header !== undefined && !isObject(jws.header)) {\n        throw new JWSInvalid('JWS Unprotected Header incorrect type');\n    }\n    let parsedProt = {};\n    if (jws.protected) {\n        try {\n            const protectedHeader = base64url(jws.protected);\n            parsedProt = JSON.parse(decoder.decode(protectedHeader));\n        }\n        catch {\n            throw new JWSInvalid('JWS Protected Header is invalid');\n        }\n    }\n    if (!isDisjoint(parsedProt, jws.header)) {\n        throw new JWSInvalid('JWS Protected and JWS Unprotected Header Parameter names must be disjoint');\n    }\n    const joseHeader = {\n        ...parsedProt,\n        ...jws.header,\n    };\n    const extensions = validateCrit(JWSInvalid, new Map([['b64', true]]), options?.crit, parsedProt, joseHeader);\n    let b64 = true;\n    if (extensions.has('b64')) {\n        b64 = parsedProt.b64;\n        if (typeof b64 !== 'boolean') {\n            throw new JWSInvalid('The \"b64\" (base64url-encode payload) Header Parameter must be a boolean');\n        }\n    }\n    const { alg } = joseHeader;\n    if (typeof alg !== 'string' || !alg) {\n        throw new JWSInvalid('JWS \"alg\" (Algorithm) Header Parameter missing or invalid');\n    }\n    const algorithms = options && validateAlgorithms('algorithms', options.algorithms);\n    if (algorithms && !algorithms.has(alg)) {\n        throw new JOSEAlgNotAllowed('\"alg\" (Algorithm) Header Parameter value not allowed');\n    }\n    if (b64) {\n        if (typeof jws.payload !== 'string') {\n            throw new JWSInvalid('JWS Payload must be a string');\n        }\n    }\n    else if (typeof jws.payload !== 'string' && !(jws.payload instanceof Uint8Array)) {\n        throw new JWSInvalid('JWS Payload must be a string or an Uint8Array instance');\n    }\n    let resolvedKey = false;\n    if (typeof key === 'function') {\n        key = await key(parsedProt, jws);\n        resolvedKey = true;\n        checkKeyTypeWithJwk(alg, key, 'verify');\n        if (isJWK(key)) {\n            key = await importJWK(key, alg);\n        }\n    }\n    else {\n        checkKeyTypeWithJwk(alg, key, 'verify');\n    }\n    const data = concat(encoder.encode(jws.protected ?? ''), encoder.encode('.'), typeof jws.payload === 'string' ? encoder.encode(jws.payload) : jws.payload);\n    let signature;\n    try {\n        signature = base64url(jws.signature);\n    }\n    catch {\n        throw new JWSInvalid('Failed to base64url decode the signature');\n    }\n    const verified = await verify(alg, key, signature, data);\n    if (!verified) {\n        throw new JWSSignatureVerificationFailed();\n    }\n    let payload;\n    if (b64) {\n        try {\n            payload = base64url(jws.payload);\n        }\n        catch {\n            throw new JWSInvalid('Failed to base64url decode the payload');\n        }\n    }\n    else if (typeof jws.payload === 'string') {\n        payload = encoder.encode(jws.payload);\n    }\n    else {\n        payload = jws.payload;\n    }\n    const result = { payload };\n    if (jws.protected !== undefined) {\n        result.protectedHeader = parsedProt;\n    }\n    if (jws.header !== undefined) {\n        result.unprotectedHeader = jws.header;\n    }\n    if (resolvedKey) {\n        return { ...result, key };\n    }\n    return result;\n}\n","import { JWTClaimValidationFailed, JWTExpired, JWTInvalid } from '../util/errors.js';\nimport { decoder } from './buffer_utils.js';\nimport epoch from './epoch.js';\nimport secs from './secs.js';\nimport isObject from './is_object.js';\nconst normalizeTyp = (value) => value.toLowerCase().replace(/^application\\//, '');\nconst checkAudiencePresence = (audPayload, audOption) => {\n    if (typeof audPayload === 'string') {\n        return audOption.includes(audPayload);\n    }\n    if (Array.isArray(audPayload)) {\n        return audOption.some(Set.prototype.has.bind(new Set(audPayload)));\n    }\n    return false;\n};\nexport default (protectedHeader, encodedPayload, options = {}) => {\n    let payload;\n    try {\n        payload = JSON.parse(decoder.decode(encodedPayload));\n    }\n    catch {\n    }\n    if (!isObject(payload)) {\n        throw new JWTInvalid('JWT Claims Set must be a top-level JSON object');\n    }\n    const { typ } = options;\n    if (typ &&\n        (typeof protectedHeader.typ !== 'string' ||\n            normalizeTyp(protectedHeader.typ) !== normalizeTyp(typ))) {\n        throw new JWTClaimValidationFailed('unexpected \"typ\" JWT header value', payload, 'typ', 'check_failed');\n    }\n    const { requiredClaims = [], issuer, subject, audience, maxTokenAge } = options;\n    const presenceCheck = [...requiredClaims];\n    if (maxTokenAge !== undefined)\n        presenceCheck.push('iat');\n    if (audience !== undefined)\n        presenceCheck.push('aud');\n    if (subject !== undefined)\n        presenceCheck.push('sub');\n    if (issuer !== undefined)\n        presenceCheck.push('iss');\n    for (const claim of new Set(presenceCheck.reverse())) {\n        if (!(claim in payload)) {\n            throw new JWTClaimValidationFailed(`missing required \"${claim}\" claim`, payload, claim, 'missing');\n        }\n    }\n    if (issuer &&\n        !(Array.isArray(issuer) ? issuer : [issuer]).includes(payload.iss)) {\n        throw new JWTClaimValidationFailed('unexpected \"iss\" claim value', payload, 'iss', 'check_failed');\n    }\n    if (subject && payload.sub !== subject) {\n        throw new JWTClaimValidationFailed('unexpected \"sub\" claim value', payload, 'sub', 'check_failed');\n    }\n    if (audience &&\n        !checkAudiencePresence(payload.aud, typeof audience === 'string' ? [audience] : audience)) {\n        throw new JWTClaimValidationFailed('unexpected \"aud\" claim value', payload, 'aud', 'check_failed');\n    }\n    let tolerance;\n    switch (typeof options.clockTolerance) {\n        case 'string':\n            tolerance = secs(options.clockTolerance);\n            break;\n        case 'number':\n            tolerance = options.clockTolerance;\n            break;\n        case 'undefined':\n            tolerance = 0;\n            break;\n        default:\n            throw new TypeError('Invalid clockTolerance option type');\n    }\n    const { currentDate } = options;\n    const now = epoch(currentDate || new Date());\n    if ((payload.iat !== undefined || maxTokenAge) && typeof payload.iat !== 'number') {\n        throw new JWTClaimValidationFailed('\"iat\" claim must be a number', payload, 'iat', 'invalid');\n    }\n    if (payload.nbf !== undefined) {\n        if (typeof payload.nbf !== 'number') {\n            throw new JWTClaimValidationFailed('\"nbf\" claim must be a number', payload, 'nbf', 'invalid');\n        }\n        if (payload.nbf > now + tolerance) {\n            throw new JWTClaimValidationFailed('\"nbf\" claim timestamp check failed', payload, 'nbf', 'check_failed');\n        }\n    }\n    if (payload.exp !== undefined) {\n        if (typeof payload.exp !== 'number') {\n            throw new JWTClaimValidationFailed('\"exp\" claim must be a number', payload, 'exp', 'invalid');\n        }\n        if (payload.exp <= now - tolerance) {\n            throw new JWTExpired('\"exp\" claim timestamp check failed', payload, 'exp', 'check_failed');\n        }\n    }\n    if (maxTokenAge) {\n        const age = now - payload.iat;\n        const max = typeof maxTokenAge === 'number' ? maxTokenAge : secs(maxTokenAge);\n        if (age - tolerance > max) {\n            throw new JWTExpired('\"iat\" claim timestamp check failed (too far in the past)', payload, 'iat', 'check_failed');\n        }\n        if (age < 0 - tolerance) {\n            throw new JWTClaimValidationFailed('\"iat\" claim timestamp check failed (it should be in the past)', payload, 'iat', 'check_failed');\n        }\n    }\n    return payload;\n};\n","import crypto from './webcrypto.js';\nconst digest = async (algorithm, data) => {\n    const subtleDigest = `SHA-${algorithm.slice(-3)}`;\n    return new Uint8Array(await crypto.subtle.digest(subtleDigest, data));\n};\nexport default digest;\n","import digest from '../runtime/digest.js';\nimport { encode as base64url } from '../runtime/base64url.js';\nimport { JOSENotSupported, JWKInvalid } from '../util/errors.js';\nimport { encoder } from '../lib/buffer_utils.js';\nimport isObject from '../lib/is_object.js';\nconst check = (value, description) => {\n    if (typeof value !== 'string' || !value) {\n        throw new JWKInvalid(`${description} missing or invalid`);\n    }\n};\nexport async function calculateJwkThumbprint(jwk, digestAlgorithm) {\n    if (!isObject(jwk)) {\n        throw new TypeError('JWK must be an object');\n    }\n    digestAlgorithm ?? (digestAlgorithm = 'sha256');\n    if (digestAlgorithm !== 'sha256' &&\n        digestAlgorithm !== 'sha384' &&\n        digestAlgorithm !== 'sha512') {\n        throw new TypeError('digestAlgorithm must one of \"sha256\", \"sha384\", or \"sha512\"');\n    }\n    let components;\n    switch (jwk.kty) {\n        case 'EC':\n            check(jwk.crv, '\"crv\" (Curve) Parameter');\n            check(jwk.x, '\"x\" (X Coordinate) Parameter');\n            check(jwk.y, '\"y\" (Y Coordinate) Parameter');\n            components = { crv: jwk.crv, kty: jwk.kty, x: jwk.x, y: jwk.y };\n            break;\n        case 'OKP':\n            check(jwk.crv, '\"crv\" (Subtype of Key Pair) Parameter');\n            check(jwk.x, '\"x\" (Public Key) Parameter');\n            components = { crv: jwk.crv, kty: jwk.kty, x: jwk.x };\n            break;\n        case 'RSA':\n            check(jwk.e, '\"e\" (Exponent) Parameter');\n            check(jwk.n, '\"n\" (Modulus) Parameter');\n            components = { e: jwk.e, kty: jwk.kty, n: jwk.n };\n            break;\n        case 'oct':\n            check(jwk.k, '\"k\" (Key Value) Parameter');\n            components = { k: jwk.k, kty: jwk.kty };\n            break;\n        default:\n            throw new JOSENotSupported('\"kty\" (Key Type) Parameter missing or unsupported');\n    }\n    const data = encoder.encode(JSON.stringify(components));\n    return base64url(await digest(digestAlgorithm, data));\n}\nexport async function calculateJwkThumbprintUri(jwk, digestAlgorithm) {\n    digestAlgorithm ?? (digestAlgorithm = 'sha256');\n    const thumbprint = await calculateJwkThumbprint(jwk, digestAlgorithm);\n    return `urn:ietf:params:oauth:jwk-thumbprint:sha-${digestAlgorithm.slice(-3)}:${thumbprint}`;\n}\n","import crypto from './webcrypto.js';\nimport { JOSENotSupported } from '../util/errors.js';\nimport random from './random.js';\nexport async function generateSecret(alg, options) {\n    let length;\n    let algorithm;\n    let keyUsages;\n    switch (alg) {\n        case 'HS256':\n        case 'HS384':\n        case 'HS512':\n            length = parseInt(alg.slice(-3), 10);\n            algorithm = { name: 'HMAC', hash: `SHA-${length}`, length };\n            keyUsages = ['sign', 'verify'];\n            break;\n        case 'A128CBC-HS256':\n        case 'A192CBC-HS384':\n        case 'A256CBC-HS512':\n            length = parseInt(alg.slice(-3), 10);\n            return random(new Uint8Array(length >> 3));\n        case 'A128KW':\n        case 'A192KW':\n        case 'A256KW':\n            length = parseInt(alg.slice(1, 4), 10);\n            algorithm = { name: 'AES-KW', length };\n            keyUsages = ['wrapKey', 'unwrapKey'];\n            break;\n        case 'A128GCMKW':\n        case 'A192GCMKW':\n        case 'A256GCMKW':\n        case 'A128GCM':\n        case 'A192GCM':\n        case 'A256GCM':\n            length = parseInt(alg.slice(1, 4), 10);\n            algorithm = { name: 'AES-GCM', length };\n            keyUsages = ['encrypt', 'decrypt'];\n            break;\n        default:\n            throw new JOSENotSupported('Invalid or unsupported JWK \"alg\" (Algorithm) Parameter value');\n    }\n    return crypto.subtle.generateKey(algorithm, options?.extractable ?? false, keyUsages);\n}\nfunction getModulusLengthOption(options) {\n    const modulusLength = options?.modulusLength ?? 2048;\n    if (typeof modulusLength !== 'number' || modulusLength < 2048) {\n        throw new JOSENotSupported('Invalid or unsupported modulusLength option provided, 2048 bits or larger keys must be used');\n    }\n    return modulusLength;\n}\nexport async function generateKeyPair(alg, options) {\n    let algorithm;\n    let keyUsages;\n    switch (alg) {\n        case 'PS256':\n        case 'PS384':\n        case 'PS512':\n            algorithm = {\n                name: 'RSA-PSS',\n                hash: `SHA-${alg.slice(-3)}`,\n                publicExponent: new Uint8Array([0x01, 0x00, 0x01]),\n                modulusLength: getModulusLengthOption(options),\n            };\n            keyUsages = ['sign', 'verify'];\n            break;\n        case 'RS256':\n        case 'RS384':\n        case 'RS512':\n            algorithm = {\n                name: 'RSASSA-PKCS1-v1_5',\n                hash: `SHA-${alg.slice(-3)}`,\n                publicExponent: new Uint8Array([0x01, 0x00, 0x01]),\n                modulusLength: getModulusLengthOption(options),\n            };\n            keyUsages = ['sign', 'verify'];\n            break;\n        case 'RSA-OAEP':\n        case 'RSA-OAEP-256':\n        case 'RSA-OAEP-384':\n        case 'RSA-OAEP-512':\n            algorithm = {\n                name: 'RSA-OAEP',\n                hash: `SHA-${parseInt(alg.slice(-3), 10) || 1}`,\n                publicExponent: new Uint8Array([0x01, 0x00, 0x01]),\n                modulusLength: getModulusLengthOption(options),\n            };\n            keyUsages = ['decrypt', 'unwrapKey', 'encrypt', 'wrapKey'];\n            break;\n        case 'ES256':\n            algorithm = { name: 'ECDSA', namedCurve: 'P-256' };\n            keyUsages = ['sign', 'verify'];\n            break;\n        case 'ES384':\n            algorithm = { name: 'ECDSA', namedCurve: 'P-384' };\n            keyUsages = ['sign', 'verify'];\n            break;\n        case 'ES512':\n            algorithm = { name: 'ECDSA', namedCurve: 'P-521' };\n            keyUsages = ['sign', 'verify'];\n            break;\n        case 'Ed25519':\n            algorithm = { name: 'Ed25519' };\n            keyUsages = ['sign', 'verify'];\n            break;\n        case 'EdDSA': {\n            keyUsages = ['sign', 'verify'];\n            const crv = options?.crv ?? 'Ed25519';\n            switch (crv) {\n                case 'Ed25519':\n                case 'Ed448':\n                    algorithm = { name: crv };\n                    break;\n                default:\n                    throw new JOSENotSupported('Invalid or unsupported crv option provided');\n            }\n            break;\n        }\n        case 'ECDH-ES':\n        case 'ECDH-ES+A128KW':\n        case 'ECDH-ES+A192KW':\n        case 'ECDH-ES+A256KW': {\n            keyUsages = ['deriveKey', 'deriveBits'];\n            const crv = options?.crv ?? 'P-256';\n            switch (crv) {\n                case 'P-256':\n                case 'P-384':\n                case 'P-521': {\n                    algorithm = { name: 'ECDH', namedCurve: crv };\n                    break;\n                }\n                case 'X25519':\n                case 'X448':\n                    algorithm = { name: crv };\n                    break;\n                default:\n                    throw new JOSENotSupported('Invalid or unsupported crv option provided, supported values are P-256, P-384, P-521, X25519, and X448');\n            }\n            break;\n        }\n        default:\n            throw new JOSENotSupported('Invalid or unsupported JWK \"alg\" (Algorithm) Parameter value');\n    }\n    return crypto.subtle.generateKey(algorithm, options?.extractable ?? false, keyUsages);\n}\n","import { generateKeyPair as generate } from '../runtime/generate.js';\nexport async function generateKeyPair(alg, options) {\n    return generate(alg, options);\n}\n","import * as base64url from '../runtime/base64url.js';\nexport const encode = base64url.encode;\nexport const decode = base64url.decode;\n","/**\n * solid-oidc.js - Minimal Solid-OIDC client for browsers\n *\n * A zero-build, single-file Solid-OIDC authentication library.\n *\n * @license MIT\n * @author JavaScriptSolidServer\n * @see https://github.com/JavaScriptSolidServer/solid-oidc\n *\n * Based on solid-oidc-client-browser by uvdsl (Christoph Braun)\n * @see https://github.com/uvdsl/solid-oidc-client-browser\n *\n * Implements:\n * - RFC 6749 - OAuth 2.0\n * - RFC 7636 - PKCE\n * - RFC 9207 - OAuth 2.0 Authorization Server Issuer Identification\n * - RFC 9449 - DPoP (Demonstration of Proof-of-Possession)\n * - Solid-OIDC Specification\n */\n\nimport {\n  SignJWT,\n  generateKeyPair,\n  decodeJwt,\n  exportJWK,\n  createRemoteJWKSet,\n  jwtVerify,\n  calculateJwkThumbprint\n} from 'jose'\n\n// ============================================================================\n// Session Events\n// ============================================================================\n\nexport const SessionEvents = {\n  STATE_CHANGE: 'sessionStateChange',\n  EXPIRATION_WARNING: 'sessionExpirationWarning',\n  EXPIRATION: 'sessionExpiration'\n}\n\n// ============================================================================\n// Session Database Interface (IndexedDB Implementation)\n// ============================================================================\n\nexport class SessionDatabase {\n  constructor(dbName = 'solid-oidc', storeName = 'session', dbVersion = 1) {\n    this.dbName = dbName\n    this.storeName = storeName\n    this.dbVersion = dbVersion\n    this.db = null\n  }\n\n  async init() {\n    return new Promise((resolve, reject) => {\n      const request = indexedDB.open(this.dbName, this.dbVersion)\n      request.onerror = () => reject(new Error(`Database error: ${request.error}`))\n      request.onsuccess = () => {\n        this.db = request.result\n        resolve(this)\n      }\n      request.onupgradeneeded = (event) => {\n        const db = event.target.result\n        if (!db.objectStoreNames.contains(this.storeName)) {\n          db.createObjectStore(this.storeName)\n        }\n      }\n    })\n  }\n\n  async setItem(id, value) {\n    if (!this.db) await this.init()\n    return new Promise((resolve, reject) => {\n      const tx = this.db.transaction(this.storeName, 'readwrite')\n      tx.oncomplete = () => resolve()\n      tx.onerror = () => reject(new Error(`Transaction error: ${tx.error}`))\n      tx.objectStore(this.storeName).put(value, id)\n    })\n  }\n\n  async getItem(id) {\n    if (!this.db) await this.init()\n    return new Promise((resolve, reject) => {\n      const tx = this.db.transaction(this.storeName, 'readonly')\n      tx.onerror = () => reject(new Error(`Transaction error: ${tx.error}`))\n      const request = tx.objectStore(this.storeName).get(id)\n      request.onsuccess = () => resolve(request.result || null)\n    })\n  }\n\n  async deleteItem(id) {\n    if (!this.db) await this.init()\n    return new Promise((resolve, reject) => {\n      const tx = this.db.transaction(this.storeName, 'readwrite')\n      tx.oncomplete = () => resolve()\n      tx.onerror = () => reject(new Error(`Transaction error: ${tx.error}`))\n      tx.objectStore(this.storeName).delete(id)\n    })\n  }\n\n  async clear() {\n    if (!this.db) await this.init()\n    return new Promise((resolve, reject) => {\n      const tx = this.db.transaction(this.storeName, 'readwrite')\n      tx.oncomplete = () => resolve()\n      tx.onerror = () => reject(new Error(`Transaction error: ${tx.error}`))\n      tx.objectStore(this.storeName).clear()\n    })\n  }\n\n  close() {\n    if (this.db) {\n      this.db.close()\n      this.db = null\n    }\n  }\n}\n\n// ============================================================================\n// PKCE Helper (RFC 7636)\n// ============================================================================\n\nasync function generatePKCE() {\n  const verifier = crypto.randomUUID() + '-' + crypto.randomUUID()\n  const digest = new Uint8Array(\n    await crypto.subtle.digest('SHA-256', new TextEncoder().encode(verifier))\n  )\n  const challenge = btoa(String.fromCharCode(...digest))\n    .replace(/\\+/g, '-')\n    .replace(/\\//g, '_')\n    .replace(/=+$/, '')\n  return { verifier, challenge }\n}\n\n// ============================================================================\n// DPoP Helper (RFC 9449)\n// ============================================================================\n\nasync function createDPoPToken(keyPair, htu, htm, ath = null) {\n  const publicJwk = await exportJWK(keyPair.publicKey)\n  const payload = { htu, htm }\n  if (ath) payload.ath = ath\n\n  return new SignJWT(payload)\n    .setIssuedAt()\n    .setJti(crypto.randomUUID())\n    .setProtectedHeader({ alg: 'ES256', typ: 'dpop+jwt', jwk: publicJwk })\n    .sign(keyPair.privateKey)\n}\n\nasync function computeAth(accessToken) {\n  const data = new TextEncoder().encode(accessToken)\n  const hashBuffer = await crypto.subtle.digest('SHA-256', data)\n  const hashArray = Array.from(new Uint8Array(hashBuffer))\n  return btoa(String.fromCharCode(...hashArray))\n    .replace(/\\+/g, '-')\n    .replace(/\\//g, '_')\n    .replace(/=+$/, '')\n}\n\n// ============================================================================\n// OIDC Discovery\n// ============================================================================\n\nasync function discoverOIDC(idp) {\n  const origin = new URL(idp).origin\n  const response = await fetch(`${origin}/.well-known/openid-configuration`)\n  if (!response.ok) throw new Error(`OIDC discovery failed: ${response.status}`)\n  return response.json()\n}\n\n// ============================================================================\n// Dynamic Client Registration\n// ============================================================================\n\nasync function registerClient(registrationEndpoint, redirectUris) {\n  const response = await fetch(registrationEndpoint, {\n    method: 'POST',\n    headers: { 'Content-Type': 'application/json' },\n    body: JSON.stringify({\n      application_type: 'web',\n      redirect_uris: redirectUris,\n      token_endpoint_auth_method: 'none',\n      grant_types: ['authorization_code', 'refresh_token'],\n      response_types: ['code'],\n      scope: 'openid offline_access webid'\n    })\n  })\n  if (!response.ok) throw new Error(`Client registration failed: ${response.status}`)\n  return response.json()\n}\n\n// ============================================================================\n// Token Request\n// ============================================================================\n\nasync function requestTokens(tokenEndpoint, params, keyPair) {\n  const dpop = await createDPoPToken(keyPair, tokenEndpoint, 'POST')\n  const response = await fetch(tokenEndpoint, {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/x-www-form-urlencoded',\n      'DPoP': dpop\n    },\n    body: new URLSearchParams(params)\n  })\n  if (!response.ok) throw new Error(`Token request failed: ${response.status}`)\n  return response.json()\n}\n\n// ============================================================================\n// Token Validation\n// ============================================================================\n\nasync function validateAccessToken(accessToken, jwksUri, issuer, clientId, keyPair) {\n  const jwks = createRemoteJWKSet(new URL(jwksUri))\n  const { payload } = await jwtVerify(accessToken, jwks, {\n    issuer,\n    audience: 'solid'\n  })\n\n  // Verify DPoP binding\n  const thumbprint = await calculateJwkThumbprint(await exportJWK(keyPair.publicKey))\n  if (payload.cnf?.jkt !== thumbprint) {\n    throw new Error('DPoP thumbprint mismatch')\n  }\n\n  // Verify client_id\n  if (payload.client_id !== clientId) {\n    throw new Error('client_id mismatch')\n  }\n\n  return payload\n}\n\n// ============================================================================\n// Refresh Token Grant\n// ============================================================================\n\nasync function refreshTokens(database) {\n  await database.init()\n\n  const [refreshToken, tokenEndpoint, clientId, keyPair] = await Promise.all([\n    database.getItem('refresh_token'),\n    database.getItem('token_endpoint'),\n    database.getItem('client_id'),\n    database.getItem('dpop_keypair')\n  ])\n\n  if (!refreshToken || !tokenEndpoint || !clientId || !keyPair) {\n    throw new Error('Missing refresh data')\n  }\n\n  const tokens = await requestTokens(tokenEndpoint, {\n    grant_type: 'refresh_token',\n    refresh_token: refreshToken,\n    client_id: clientId\n  }, keyPair)\n\n  // Persist new refresh token if provided\n  if (tokens.refresh_token) {\n    await database.setItem('refresh_token', tokens.refresh_token)\n  }\n\n  database.close()\n  return { ...tokens, dpop_key_pair: keyPair }\n}\n\n// ============================================================================\n// Main Session Class\n// ============================================================================\n\nexport class Session extends EventTarget {\n  constructor(options = {}) {\n    super()\n    this.clientId = options.clientId || null\n    this.database = options.database || new SessionDatabase()\n    this.onStateChange = options.onStateChange || null\n    this.onExpirationWarning = options.onExpirationWarning || null\n    this.onExpiration = options.onExpiration || null\n\n    // Internal state\n    this._isActive = false\n    this._webId = null\n    this._exp = null\n    this._ath = null\n    this._tokens = null\n    this._idpDetails = null\n    this._refreshPromise = null\n\n    // Set up event listeners\n    if (this.onStateChange) {\n      this.addEventListener(SessionEvents.STATE_CHANGE, this.onStateChange)\n    }\n    if (this.onExpirationWarning) {\n      this.addEventListener(SessionEvents.EXPIRATION_WARNING, this.onExpirationWarning)\n    }\n    if (this.onExpiration) {\n      this.addEventListener(SessionEvents.EXPIRATION, this.onExpiration)\n    }\n  }\n\n  // ==========================================================================\n  // Public API\n  // ==========================================================================\n\n  get isActive() { return this._isActive }\n  get webId() { return this._webId }\n\n  isExpired() {\n    if (!this._exp) return true\n    return Math.floor(Date.now() / 1000) >= this._exp\n  }\n\n  getExpiresIn() {\n    if (!this._exp) return -1\n    return this._exp - Math.floor(Date.now() / 1000)\n  }\n\n  /**\n   * Redirect user to identity provider for login\n   */\n  async login(idp, redirectUri) {\n    // Sanitize redirect URI (RFC 6749 Section 3.1.2)\n    const redirectUrl = new URL(redirectUri)\n    const sanitizedRedirect = redirectUrl.origin + redirectUrl.pathname + redirectUrl.search\n\n    // OIDC Discovery\n    const config = await discoverOIDC(idp)\n\n    // RFC 9207: Verify issuer\n    const issuer = config.issuer\n    const trimSlash = (s) => s.endsWith('/') ? s.slice(0, -1) : s\n    if (trimSlash(idp) !== trimSlash(issuer)) {\n      throw new Error(`Issuer mismatch: ${issuer} !== ${idp}`)\n    }\n\n    // Store IDP details\n    sessionStorage.setItem('solid_oidc_idp', issuer)\n    sessionStorage.setItem('solid_oidc_token_endpoint', config.token_endpoint)\n    sessionStorage.setItem('solid_oidc_jwks_uri', config.jwks_uri)\n\n    // Get or register client_id\n    let clientId = this.clientId\n    if (!clientId) {\n      const registration = await registerClient(config.registration_endpoint, [sanitizedRedirect])\n      clientId = registration.client_id\n      sessionStorage.setItem('solid_oidc_client_id', clientId)\n    }\n\n    // PKCE (RFC 7636)\n    const pkce = await generatePKCE()\n    sessionStorage.setItem('solid_oidc_pkce_verifier', pkce.verifier)\n\n    // CSRF token\n    const csrfToken = crypto.randomUUID()\n    sessionStorage.setItem('solid_oidc_csrf', csrfToken)\n\n    // Build authorization URL\n    const authUrl = new URL(config.authorization_endpoint)\n    authUrl.searchParams.set('response_type', 'code')\n    authUrl.searchParams.set('redirect_uri', sanitizedRedirect)\n    authUrl.searchParams.set('scope', 'openid offline_access webid')\n    authUrl.searchParams.set('client_id', clientId)\n    authUrl.searchParams.set('code_challenge_method', 'S256')\n    authUrl.searchParams.set('code_challenge', pkce.challenge)\n    authUrl.searchParams.set('state', csrfToken)\n    authUrl.searchParams.set('prompt', 'consent')\n\n    // Redirect to IDP\n    window.location.href = authUrl.toString()\n  }\n\n  /**\n   * Handle redirect from identity provider after login\n   */\n  async handleRedirectFromLogin() {\n    const url = new URL(window.location.href)\n    const code = url.searchParams.get('code')\n\n    // No code = not a redirect, nothing to do\n    if (!code) return\n\n    // RFC 9207: Verify issuer\n    const idp = sessionStorage.getItem('solid_oidc_idp')\n    const iss = url.searchParams.get('iss')\n    if (!idp || iss !== idp) {\n      throw new Error(`Issuer mismatch: ${iss} !== ${idp}`)\n    }\n\n    // RFC 6749: Verify CSRF token\n    const csrf = sessionStorage.getItem('solid_oidc_csrf')\n    if (url.searchParams.get('state') !== csrf) {\n      throw new Error('CSRF token mismatch')\n    }\n\n    // Clean URL\n    url.searchParams.delete('code')\n    url.searchParams.delete('iss')\n    url.searchParams.delete('state')\n    window.history.replaceState({}, document.title, url.toString())\n\n    // Get stored values\n    const pkceVerifier = sessionStorage.getItem('solid_oidc_pkce_verifier')\n    const tokenEndpoint = sessionStorage.getItem('solid_oidc_token_endpoint')\n    const jwksUri = sessionStorage.getItem('solid_oidc_jwks_uri')\n    const clientId = this.clientId || sessionStorage.getItem('solid_oidc_client_id')\n\n    if (!pkceVerifier || !tokenEndpoint || !clientId) {\n      throw new Error('Missing session data')\n    }\n\n    // Generate DPoP key pair\n    const keyPair = await generateKeyPair('ES256')\n\n    // Exchange code for tokens\n    const tokens = await requestTokens(tokenEndpoint, {\n      grant_type: 'authorization_code',\n      code,\n      code_verifier: pkceVerifier,\n      redirect_uri: url.origin + url.pathname,\n      client_id: clientId\n    }, keyPair)\n\n    // Validate access token\n    await validateAccessToken(tokens.access_token, jwksUri, idp, clientId, keyPair)\n\n    // Store IDP details\n    this._idpDetails = { idp, jwksUri, tokenEndpoint }\n\n    // Persist for refresh\n    await this.database.init()\n    await Promise.all([\n      this.database.setItem('idp', idp),\n      this.database.setItem('jwks_uri', jwksUri),\n      this.database.setItem('token_endpoint', tokenEndpoint),\n      this.database.setItem('client_id', clientId),\n      this.database.setItem('dpop_keypair', keyPair),\n      this.database.setItem('refresh_token', tokens.refresh_token)\n    ])\n    this.database.close()\n\n    // Clean session storage\n    sessionStorage.removeItem('solid_oidc_idp')\n    sessionStorage.removeItem('solid_oidc_token_endpoint')\n    sessionStorage.removeItem('solid_oidc_jwks_uri')\n    sessionStorage.removeItem('solid_oidc_client_id')\n    sessionStorage.removeItem('solid_oidc_pkce_verifier')\n    sessionStorage.removeItem('solid_oidc_csrf')\n\n    // Update session state\n    await this._setTokens({ ...tokens, dpop_key_pair: keyPair })\n    this._dispatchStateChange()\n  }\n\n  /**\n   * Restore session using stored refresh token\n   */\n  async restore() {\n    if (this._refreshPromise) return this._refreshPromise\n\n    this._refreshPromise = (async () => {\n      try {\n        const tokens = await refreshTokens(this.database)\n        await this._setTokens(tokens)\n        this._dispatchStateChange()\n      } catch (error) {\n        if (this._isActive) {\n          if (!this.isExpired()) {\n            this._dispatchExpirationWarning()\n          } else {\n            this._dispatchExpiration()\n          }\n        }\n        throw error\n      } finally {\n        this._refreshPromise = null\n      }\n    })()\n\n    return this._refreshPromise\n  }\n\n  /**\n   * Log out and clear all session data\n   */\n  async logout() {\n    this._isActive = false\n    this._webId = null\n    this._exp = null\n    this._ath = null\n    this._tokens = null\n    this._idpDetails = null\n\n    await this.database.init()\n    await this.database.clear()\n    this.database.close()\n\n    this._dispatchStateChange()\n  }\n\n  /**\n   * Make authenticated fetch request with DPoP\n   */\n  async authFetch(input, init = {}) {\n    // No session = regular fetch\n    if (!this._isActive) {\n      return fetch(input, init)\n    }\n\n    // Refresh if expired\n    if (this.isExpired()) {\n      await this.restore()\n    }\n\n    // Parse request\n    let url, method, headers\n    if (input instanceof Request) {\n      url = new URL(input.url)\n      method = init.method || input.method || 'GET'\n      headers = new Headers(input.headers)\n    } else {\n      url = new URL(input.toString())\n      method = init.method || 'GET'\n      headers = init.headers ? new Headers(init.headers) : new Headers()\n    }\n\n    // Create DPoP proof\n    const dpop = await createDPoPToken(\n      this._tokens.dpop_key_pair,\n      `${url.origin}${url.pathname}`,\n      method.toUpperCase(),\n      this._ath\n    )\n\n    // Set auth headers\n    headers.set('DPoP', dpop)\n    headers.set('Authorization', `DPoP ${this._tokens.access_token}`)\n\n    // Make request\n    if (input instanceof Request) {\n      return fetch(new Request(input, { ...init, headers }))\n    }\n    return fetch(url, { ...init, headers })\n  }\n\n  // ==========================================================================\n  // Internal Methods\n  // ==========================================================================\n\n  async _setTokens(tokens) {\n    this._tokens = tokens\n\n    const decoded = decodeJwt(tokens.access_token)\n    if (!decoded.webid) throw new Error('Missing webid claim')\n    if (!decoded.exp) throw new Error('Missing exp claim')\n\n    this._ath = await computeAth(tokens.access_token)\n    this._webId = decoded.webid\n    this._exp = decoded.exp\n    this._isActive = true\n  }\n\n  _dispatchStateChange() {\n    this.dispatchEvent(new CustomEvent(SessionEvents.STATE_CHANGE, {\n      detail: { isActive: this._isActive, webId: this._webId }\n    }))\n  }\n\n  _dispatchExpirationWarning() {\n    this.dispatchEvent(new CustomEvent(SessionEvents.EXPIRATION_WARNING, {\n      detail: { expires_in: this.getExpiresIn() }\n    }))\n  }\n\n  _dispatchExpiration() {\n    this.dispatchEvent(new CustomEvent(SessionEvents.EXPIRATION))\n  }\n}\n\n// ============================================================================\n// Default Export\n// ============================================================================\n\nexport default Session\n","import { compactVerify } from '../jws/compact/verify.js';\nimport jwtPayload from '../lib/jwt_claims_set.js';\nimport { JWTInvalid } from '../util/errors.js';\nexport async function jwtVerify(jwt, key, options) {\n    const verified = await compactVerify(jwt, key, options);\n    if (verified.protectedHeader.crit?.includes('b64') && verified.protectedHeader.b64 === false) {\n        throw new JWTInvalid('JWTs MUST NOT use unencoded payload');\n    }\n    const payload = jwtPayload(verified.protectedHeader, verified.payload, options);\n    const result = { payload, protectedHeader: verified.protectedHeader };\n    if (typeof key === 'function') {\n        return { ...result, key: verified.key };\n    }\n    return result;\n}\n","import { decode as base64url } from './base64url.js';\nimport { decoder } from '../lib/buffer_utils.js';\nimport isObject from '../lib/is_object.js';\nimport { JWTInvalid } from './errors.js';\nexport function decodeJwt(jwt) {\n    if (typeof jwt !== 'string')\n        throw new JWTInvalid('JWTs must use Compact JWS serialization, JWT must be a string');\n    const { 1: payload, length } = jwt.split('.');\n    if (length === 5)\n        throw new JWTInvalid('Only JWTs using Compact JWS serialization can be decoded');\n    if (length !== 3)\n        throw new JWTInvalid('Invalid JWT');\n    if (!payload)\n        throw new JWTInvalid('JWTs must contain a payload');\n    let decoded;\n    try {\n        decoded = base64url(payload);\n    }\n    catch {\n        throw new JWTInvalid('Failed to base64url decode the payload');\n    }\n    let result;\n    try {\n        result = JSON.parse(decoder.decode(decoded));\n    }\n    catch {\n        throw new JWTInvalid('Failed to parse the decoded payload as JSON');\n    }\n    if (!isObject(result))\n        throw new JWTInvalid('Invalid JWT Claims Set');\n    return result;\n}\n","/**\n * Adapter to make solid-oidc compatible with @inrupt/solid-client-authn-browser API\n *\n * This provides a drop-in replacement for the Inrupt Session class using the minimal\n * solid-oidc library from JavaScriptSolidServer.\n *\n * @see https://github.com/JavaScriptSolidServer/solid-oidc\n */\n\nimport {\n  Session as SolidOidcSession,\n  SessionDatabase\n} from 'solid-oidc'\n\n/**\n * Event names compatible with @inrupt/solid-client-authn-browser\n */\nexport const EVENTS = {\n  SESSION_RESTORED: 'sessionRestore',\n  LOGIN: 'login',\n  LOGOUT: 'logout',\n  SESSION_EXPIRED: 'sessionExpired',\n  ERROR: 'error'\n} as const\n\n/**\n * Callback type for event listeners\n */\ntype EventCallback = (...args: any[]) => void\n\n/**\n * Simple event emitter for compatibility with Inrupt's session.events API\n */\nclass EventEmitter {\n  private listeners: Map<string, Set<EventCallback>> = new Map()\n\n  on(event: string, callback: EventCallback): void {\n    if (!this.listeners.has(event)) {\n      this.listeners.set(event, new Set())\n    }\n    this.listeners.get(event)!.add(callback)\n  }\n\n  off(event: string, callback: EventCallback): void {\n    this.listeners.get(event)?.delete(callback)\n  }\n\n  emit(event: string, ...args: unknown[]): void {\n    this.listeners.get(event)?.forEach(cb => cb(...args))\n  }\n}\n\n/**\n * Session info interface compatible with Inrupt\n */\nexport interface SessionInfo {\n  isLoggedIn: boolean\n  webId?: string\n  sessionId?: string\n  expirationDate?: number\n}\n\n/**\n * Options for handleIncomingRedirect\n */\nexport interface HandleRedirectOptions {\n  restorePreviousSession?: boolean\n  url?: string\n}\n\n/**\n * Options for login\n */\nexport interface LoginOptions {\n  oidcIssuer: string\n  redirectUrl: string\n  clientId?: string\n  clientName?: string\n  tokenType?: string\n}\n\n/**\n * Session class that wraps solid-oidc to provide @inrupt/solid-client-authn-browser compatible API\n */\nexport class Session {\n  private _session: SolidOidcSession\n  private _events: EventEmitter\n  private _sessionId: string\n\n  constructor(options?: { clientId?: string }) {\n    this._session = new SolidOidcSession({\n      clientId: options?.clientId,\n      database: new SessionDatabase(),\n      onStateChange: (event) => {\n        const detail = (event as CustomEvent).detail\n        if (detail?.isActive) {\n          this._events.emit(EVENTS.LOGIN)\n          this._events.emit(EVENTS.SESSION_RESTORED, window.location.href)\n        } else {\n          this._events.emit(EVENTS.LOGOUT)\n        }\n      },\n      onExpiration: () => {\n        this._events.emit(EVENTS.SESSION_EXPIRED)\n      }\n    })\n    this._events = new EventEmitter()\n    this._sessionId = crypto.randomUUID()\n  }\n\n  /**\n   * Event emitter for session events\n   */\n  get events(): EventEmitter {\n    return this._events\n  }\n\n  /**\n   * Session information\n   */\n  get info(): SessionInfo {\n    return {\n      isLoggedIn: this._session.isActive,\n      webId: this._session.webId ?? undefined,\n      sessionId: this._sessionId,\n      expirationDate: this._session.isActive\n        ? Date.now() + (this._session.getExpiresIn() * 1000)\n        : undefined\n    }\n  }\n\n  /**\n   * Handle incoming redirect from identity provider\n   */\n  async handleIncomingRedirect(options?: HandleRedirectOptions | string): Promise<SessionInfo | undefined> {\n    // Handle string URL (legacy API)\n    const opts: HandleRedirectOptions = typeof options === 'string'\n      ? { url: options }\n      : options ?? {}\n\n    try {\n      // First handle any redirect from login\n      await this._session.handleRedirectFromLogin()\n\n      // If not logged in and restorePreviousSession is true, try to restore\n      if (!this._session.isActive && opts.restorePreviousSession !== false) {\n        try {\n          await this._session.restore()\n        } catch {\n          // No session to restore, that's okay\n        }\n      }\n\n      return this.info\n    } catch (error) {\n      this._events.emit(EVENTS.ERROR, error)\n      return undefined\n    }\n  }\n\n  /**\n   * Initiate login flow\n   */\n  async login(options: LoginOptions): Promise<void> {\n    const redirectUrl = options.redirectUrl || window.location.href\n    await this._session.login(options.oidcIssuer, redirectUrl)\n  }\n\n  /**\n   * Log out and clear session\n   */\n  async logout(): Promise<void> {\n    await this._session.logout()\n  }\n\n  /**\n   * Make authenticated fetch request\n   */\n  async fetch(url: RequestInfo | URL, init?: RequestInit): Promise<Response> {\n    return this._session.authFetch(url as string, init)\n  }\n}\n\nexport default Session\n","import { Session } from './solidOidcAdapter'\n\nexport const authSession = new Session()\n","const __WEBPACK_NAMESPACE_OBJECT__ = __WEBPACK_EXTERNAL_MODULE_rdflib__;","// Namespaces we commonly use and have common prefixes for around Solid\nimport solidNamespace from 'solid-namespace' // Delegate to this which takes RDFlib as param.\nimport * as $rdf from 'rdflib'\n\nexport const ns = solidNamespace($rdf)","import { graph, NamedNode, Namespace, serialize, sym } from 'rdflib'\nimport { AclLogic } from '../types'\nimport { ns as namespace } from '../util/ns'\n\n\nexport const ACL_LINK = sym(\n    'http://www.iana.org/assignments/link-relations/acl'\n)\n\nexport function createAclLogic(store): AclLogic {\n\n    const ns = namespace\n    \n    async function findAclDocUrl(url: NamedNode) {\n        await store.fetcher.load(url)\n        const docNode = store.any(url, ACL_LINK)\n        if (!docNode) {\n            throw new Error(`No ACL link discovered for ${url}`)\n        }\n        return docNode.value\n    }\n    /**\n     * Simple Access Control\n     *\n     * This function sets up a simple default ACL for a resource, with\n     * RWC for the owner, and a specified access (default none) for the public.\n     * In all cases owner has read write control.\n     * Parameter lists modes allowed to public\n     *\n     * @param options\n     * @param options.public eg ['Read', 'Write']\n     *\n     * @returns Resolves with aclDoc uri on successful write\n     */\n    function setACLUserPublic ( \n    docURI: string,\n    me: NamedNode,\n    options: {\n        defaultForNew?: boolean,\n        public?: []\n    }\n    ): Promise<NamedNode> {\n    const aclDoc = store.any(\n        store.sym(docURI),\n        ACL_LINK\n    )\n\n    return Promise.resolve()\n        .then(() => {\n        if (aclDoc) {\n            return aclDoc as NamedNode\n        }\n\n        return fetchACLRel(docURI).catch(err => {\n            throw new Error(`Error fetching rel=ACL header for ${docURI}: ${err}`)\n        })\n        })\n        .then(aclDoc => {\n        const aclText = genACLText(docURI, me, aclDoc.uri, options)\n        if (!store.fetcher) {\n            throw new Error('Cannot PUT this, store has no fetcher')\n        }\n        return store.fetcher\n            .webOperation('PUT', aclDoc.uri, {\n            data: aclText,\n            contentType: 'text/turtle'\n            })\n            .then(result => {\n            if (!result.ok) {\n                throw new Error('Error writing ACL text: ' + result.error)\n            }\n\n            return aclDoc\n            })\n        })\n    }\n\n    /**\n     * @param docURI\n     * @returns\n     */\n    function fetchACLRel (docURI: string): Promise<NamedNode> {\n        const fetcher = store.fetcher\n        if (!fetcher) {\n            throw new Error('Cannot fetch ACL rel, store has no fetcher')\n        }\n\n        return fetcher.load(docURI).then(result => {\n            if (!result.ok) {\n                throw new Error('fetchACLRel: While loading:' + (result as any).error)\n            }\n\n            const aclDoc = store.any(\n            store.sym(docURI),\n            ACL_LINK\n            )\n\n            if (!aclDoc) {\n            throw new Error('fetchACLRel: No Link rel=ACL header for ' + docURI)\n            }\n\n            return aclDoc as NamedNode\n        })\n    }\n\n    /**\n     * @param docURI\n     * @param me\n     * @param aclURI\n     * @param options\n     *\n     * @returns Serialized ACL\n     */\n    function genACLText (\n    docURI: string,\n    me: NamedNode,\n    aclURI: string,\n    options: {\n            defaultForNew?: boolean,\n            public?: []\n        } = {}\n    ): string | undefined {\n        const optPublic = options.public || []\n        const g = graph()\n        const auth = Namespace('http://www.w3.org/ns/auth/acl#')\n        let a = g.sym(`${aclURI}#a1`)\n        const acl = g.sym(aclURI)\n        const doc = g.sym(docURI)\n        g.add(a, ns.rdf('type'), auth('Authorization'), acl)\n        g.add(a, auth('accessTo'), doc, acl)\n        if (options.defaultForNew) {\n            g.add(a, auth('default'), doc, acl)\n        }\n        g.add(a, auth('agent'), me, acl)\n        g.add(a, auth('mode'), auth('Read'), acl)\n        g.add(a, auth('mode'), auth('Write'), acl)\n        g.add(a, auth('mode'), auth('Control'), acl)\n\n        if (optPublic.length) {\n            a = g.sym(`${aclURI}#a2`)\n            g.add(a, ns.rdf('type'), auth('Authorization'), acl)\n            g.add(a, auth('accessTo'), doc, acl)\n            g.add(a, auth('agentClass'), ns.foaf('Agent'), acl)\n            for (let p = 0; p < optPublic.length; p++) {\n            g.add(a, auth('mode'), auth(optPublic[p]), acl) // Like 'Read' etc\n            }\n        }\n        return serialize(acl, g, aclURI)\n    }\n    return {\n        findAclDocUrl,\n        setACLUserPublic,\n        genACLText\n    }\n}","import { NamedNode, sym } from 'rdflib'\nimport * as debug from '../util/debug'\n\n/**\n * find a user or app's context as set in window.SolidAppContext\n * this is a const, not a function, because we have problems to jest mock it otherwise\n * see: https://github.com/facebook/jest/issues/936#issuecomment-545080082 for more\n * @return {any} - an appContext object\n */\nexport const appContext = ():any => {\n    let { SolidAppContext }: any = window\n    SolidAppContext ||= {}\n    SolidAppContext.viewingNoAuthPage = false\n    if (SolidAppContext.noAuth && window.document) {\n        const currentPage = window.document.location.href\n        if (currentPage.startsWith(SolidAppContext.noAuth)) {\n        SolidAppContext.viewingNoAuthPage = true\n        const params = new URLSearchParams(window.document.location.search)\n        if (params) {\n            let viewedPage = SolidAppContext.viewedPage = params.get('uri') || null\n            if (viewedPage) {\n            viewedPage = decodeURI(viewedPage)\n            if (!viewedPage.startsWith(SolidAppContext.noAuth)) {\n                const ary = viewedPage.split(/\\//)\n                SolidAppContext.idp = ary[0] + '//' + ary[2]\n                SolidAppContext.viewingNoAuthPage = false\n            }\n            }\n        }\n        }\n    }\n    return SolidAppContext\n}\n\n/**\n * Returns `sym($SolidTestEnvironment.username)` if\n * `$SolidTestEnvironment.username` is defined as a global\n * or \n * returns testID defined in the HTML page\n * @returns {NamedNode|null}\n */\nexport function offlineTestID (): NamedNode | null {\n    const { $SolidTestEnvironment }: any = window\n    if (\n      typeof $SolidTestEnvironment !== 'undefined' &&\n      $SolidTestEnvironment.username\n    ) {\n      // Test setup\n      debug.log('Assuming the user is ' + $SolidTestEnvironment.username)\n      return sym($SolidTestEnvironment.username)\n    }\n    // hack that makes SolidOS work in offline mode by adding the webId directly in html\n    // example usage: https://github.com/solidos/mashlib/blob/29b8b53c46bf02e0e219f0bacd51b0e9951001dd/test/contact/local.html#L37\n    if (\n      typeof document !== 'undefined' &&\n      document.location &&\n      ('' + document.location).slice(0, 16) === 'http://localhost'\n    ) {\n      const div = document.getElementById('appTarget')\n      if (!div) return null\n      const id = div.getAttribute('testID')\n      if (!id) return null\n      debug.log('Assuming user is ' + id)\n      return sym(id)\n    }\n    return null\n}\n","import { namedNode, NamedNode, sym } from 'rdflib'\nimport { appContext, offlineTestID } from './authUtil'\nimport * as debug from '../util/debug'\nimport { EVENTS, Session } from '../authSession/solidOidcAdapter'\nimport { AuthenticationContext, AuthnLogic } from '../types'\n\nexport class SolidAuthnLogic implements AuthnLogic {\n  private session: Session\n\n  constructor(solidAuthSession: Session) {\n    this.session = solidAuthSession\n  }\n\n  // we created authSession getter because we want to access it as authn.authSession externally\n  get authSession():Session { return this.session }\n\n  currentUser(): NamedNode | null {\n    const app = appContext()\n    if (app.viewingNoAuthPage) {\n      return sym(app.webId)\n    }\n    if (this && this.session && this.session.info && this.session.info.webId && this.session.info.isLoggedIn) {\n      return sym(this.session.info.webId)\n    }\n    return offlineTestID() // null unless testing\n  }\n\n  /**\n   * Retrieves currently logged in webId from either\n   * defaultTestUser or SolidAuth\n   * Also activates a session after login\n   * @param [setUserCallback] Optional callback\n   * @returns Resolves with webId uri, if no callback provided\n   */\n  async checkUser<T> (\n    setUserCallback?: (me: NamedNode | null) => T\n  ): Promise<NamedNode | T | null> {\n    // Save hash for \"restorePreviousSession\"\n    const preLoginRedirectHash = new URL(window.location.href).hash\n    if (preLoginRedirectHash) {\n      window.localStorage.setItem('preLoginRedirectHash', preLoginRedirectHash)\n    }\n    this.session.events.on(EVENTS.SESSION_RESTORED, (url) => {\n      debug.log(`Session restored to ${url}`)\n      if (document.location.toString() !== url) history.replaceState(null, '', url as string)\n    })\n\n    /**\n     * Handle a successful authentication redirect\n     */\n    const redirectUrl = new URL(window.location.href)\n    redirectUrl.hash = ''\n    await this.session\n      .handleIncomingRedirect({\n        restorePreviousSession: true,\n        url: redirectUrl.href\n      })\n\n    // Check to see if a hash was stored in local storage\n    const postLoginRedirectHash = window.localStorage.getItem('preLoginRedirectHash')\n    if (postLoginRedirectHash) {\n      const curUrl = new URL(window.location.href)\n      if (curUrl.hash !== postLoginRedirectHash) {\n        if (history.pushState) {\n          // debug.log('Setting window.location.has using pushState')\n          history.pushState(null, document.title, postLoginRedirectHash)\n        } else {\n          // debug.warn('Setting window.location.has using location.hash')\n          location.hash = postLoginRedirectHash\n        }\n        curUrl.hash = postLoginRedirectHash\n      }\n      // See https://stackoverflow.com/questions/3870057/how-can-i-update-window-location-hash-without-jumping-the-document\n      // window.location.href = curUrl.toString()// @@ See https://developer.mozilla.org/en-US/docs/Web/API/Window/location\n      window.localStorage.setItem('preLoginRedirectHash', '')\n    }\n\n    // Check to see if already logged in / have the WebID\n    let me = offlineTestID()\n    if (me) {\n      return Promise.resolve(setUserCallback ? setUserCallback(me) : me)\n    }\n\n    const webId = this.webIdFromSession(this.session.info)\n    if (webId) {\n      me = this.saveUser(webId)\n    }\n\n    if (me) {\n      debug.log(`(Logged in as ${me} by authentication)`)\n    }\n\n    return Promise.resolve(setUserCallback ? setUserCallback(me) : me)\n  }\n\n  /**\n   * Saves `webId` in `context.me`\n   * @param webId\n   * @param context\n   *\n   * @returns Returns the WebID, after setting it\n   */\n  saveUser (\n    webId: NamedNode | string | null,\n    context?: AuthenticationContext\n  ): NamedNode | null {\n    let webIdUri: string\n    if (webId) {\n      webIdUri = (typeof webId === 'string') ? webId : webId.uri\n      const me = namedNode(webIdUri)\n      if (context) {\n        context.me = me\n      }\n      return me\n    }\n    return null\n  }\n\n  /**\n   * @returns {Promise<string|null>} Resolves with WebID URI or null\n   */\n  webIdFromSession (session?: { webId?: string, isLoggedIn: boolean }): string | null {\n    const webId = session?.webId && session.isLoggedIn ? session.webId : null\n    return webId\n  }\n\n}\n","import { NamedNode, sym } from 'rdflib'\n\nexport function newThing(doc: NamedNode): NamedNode {\n    return sym(doc.uri + '#' + 'id' + ('' + Date.now()))\n}\n\nexport function uniqueNodes (arr: NamedNode[]): NamedNode[] {\n    const uris = arr.map(x => x.uri)\n    const set = new Set(uris)\n    const uris2 = Array.from(set)\n    const arr2 = uris2.map(u => new NamedNode(u))\n    return arr2 // Array.from(new Set(arr.map(x => x.uri))).map(u => sym(u))\n}\n\nexport function getArchiveUrl(baseUrl: string, date: Date) {\n    const year = date.getUTCFullYear()\n    const month = ('0' + (date.getUTCMonth()+1)).slice(-2)\n    const day = ('0' + (date.getUTCDate())).slice(-2)\n    const parts = baseUrl.split('/')\n    const filename = parts[parts.length -1 ]\n    return new URL(`./archive/${year}/${month}/${day}/${filename}`, baseUrl).toString()\n}\n\nexport function differentOrigin(doc): boolean {\n    if (!doc) {\n        return true\n    }\n    return (\n        `${window.location.origin}/` !== new URL(doc.value).origin\n    )\n}\n\nexport function suggestPreferencesFile (me:NamedNode) {\n    const stripped = me.uri.replace('/profile/', '/').replace('/public/', '/')\n    // const stripped = me.uri.replace(\\/[p|P]rofile/\\g, '/').replace(\\/[p|P]ublic/\\g, '/')\n    const folderURI = stripped.split('/').slice(0,-1).join('/') + '/Settings/'\n    const fileURI = folderURI + 'Preferences.ttl'\n    return sym(fileURI)\n}\n\nexport function determineChatContainer(\n    invitee: NamedNode,\n    podRoot: NamedNode\n): NamedNode {\n    // Create chat\n    // See https://gitter.im/solid/chat-app?at=5f3c800f855be416a23ae74a\n    const chatContainerStr = new URL(\n        `IndividualChats/${new URL(invitee.value).host}/`,\n        podRoot.value\n    ).toString()\n    return new NamedNode(chatContainerStr)\n}\n","import { NamedNode, Node, st, term } from 'rdflib'\nimport { ChatLogic, CreatedPaneOptions, NewPaneOptions, Chat } from '../types'\nimport { ns as namespace } from '../util/ns'\nimport { determineChatContainer, newThing } from '../util/utils'\n\nconst CHAT_LOCATION_IN_CONTAINER = 'index.ttl#this'\n\nexport function createChatLogic(store, profileLogic): ChatLogic {\n    const ns = namespace\n\n    async function setAcl(\n        chatContainer: NamedNode,\n        me: NamedNode,\n        invitee: NamedNode\n    ): Promise<void> {\n        // Some servers don't present a Link http response header\n        // if the container doesn't exist yet, so refetch the container\n        // now that it has been created:\n        await store.fetcher.load(chatContainer)\n\n        // FIXME: check the Why value on this quad:\n        const chatAclDoc = store.any(\n            chatContainer,\n            new NamedNode('http://www.iana.org/assignments/link-relations/acl')\n        )\n        if (!chatAclDoc) {\n            throw new Error('Chat ACL doc not found!')\n        }\n\n        const aclBody = `\n            @prefix acl: <http://www.w3.org/ns/auth/acl#>.\n            <#owner>\n            a acl:Authorization;\n            acl:agent <${me.value}>;\n            acl:accessTo <.>;\n            acl:default <.>;\n            acl:mode\n                acl:Read, acl:Write, acl:Control.\n            <#invitee>\n            a acl:Authorization;\n            acl:agent <${invitee.value}>;\n            acl:accessTo <.>;\n            acl:default <.>;\n            acl:mode\n                acl:Read, acl:Append.\n            `\n        await store.fetcher.webOperation('PUT', chatAclDoc.value, {\n            data: aclBody,\n            contentType: 'text/turtle',\n        })\n    }\n\n    async function addToPrivateTypeIndex(chatThing, me) {\n        // Add to private type index\n        const privateTypeIndex = store.any(\n            me,\n            ns.solid('privateTypeIndex')\n        ) as NamedNode | null\n        if (!privateTypeIndex) {\n            throw new Error('Private type index not found!')\n        }\n        await store.fetcher.load(privateTypeIndex)\n        const reg = newThing(privateTypeIndex)\n        const ins = [\n            st(\n                reg,\n                ns.rdf('type'),\n                ns.solid('TypeRegistration'),\n                privateTypeIndex.doc()\n            ),\n            st(\n                reg,\n                ns.solid('forClass'),\n                ns.meeting('LongChat'),\n                privateTypeIndex.doc()\n            ),\n            st(reg, ns.solid('instance'), chatThing, privateTypeIndex.doc()),\n        ]\n        await new Promise((resolve, reject) => {\n            store.updater.update([], ins, function (_uri, ok, errm) {\n                if (!ok) {\n                    reject(new Error(errm))\n                } else {\n                    resolve(null)\n                }\n            })\n        })\n    }\n\n    async function findChat(invitee: NamedNode): Promise<Chat> {\n        const me = await profileLogic.loadMe()\n        const podRoot = await profileLogic.getPodRoot(me)\n        const chatContainer = determineChatContainer(invitee, podRoot)\n        let exists = true\n        try {\n            await store.fetcher.load(\n                new NamedNode(chatContainer.value + 'index.ttl#this')\n            )\n        } catch (e) {\n            exists = false\n        }\n        return { me, chatContainer, exists }\n    }\n\n    async function createChatThing(\n        chatContainer: NamedNode,\n        me: NamedNode\n    ): Promise<NamedNode> {\n        const created = await mintNew({\n            me,\n            newBase: chatContainer.value,\n        })\n        return created.newInstance\n    }\n\n    function mintNew(newPaneOptions: NewPaneOptions): Promise<CreatedPaneOptions> {\n        const kb = store\n        const updater = kb.updater\n        if (newPaneOptions.me && !newPaneOptions.me.uri) {\n            throw new Error('chat mintNew:  Invalid userid ' + newPaneOptions.me)\n        }\n\n        const newInstance = (newPaneOptions.newInstance =\n            newPaneOptions.newInstance ||\n            kb.sym(newPaneOptions.newBase + CHAT_LOCATION_IN_CONTAINER))\n        const newChatDoc = newInstance.doc()\n\n        kb.add(\n            newInstance,\n            ns.rdf('type'),\n            ns.meeting('LongChat'),\n            newChatDoc\n        )\n        kb.add(newInstance, ns.dc('title'), 'Chat channel', newChatDoc)\n        kb.add(\n            newInstance,\n            ns.dc('created'),\n            term<Node>(new Date(Date.now())),\n            newChatDoc\n        )\n        if (newPaneOptions.me) {\n            kb.add(newInstance, ns.dc('author'), newPaneOptions.me, newChatDoc)\n        }\n\n        return new Promise(function (resolve, reject) {\n            updater?.put(\n                newChatDoc,\n                kb.statementsMatching(undefined, undefined, undefined, newChatDoc),\n                'text/turtle',\n                function (uri2, ok, message) {\n                    if (ok) {\n                        resolve({\n                            ...newPaneOptions,\n                            newInstance,\n                        })\n                    } else {\n                        reject(\n                            new Error(\n                                'FAILED to save new chat channel at: ' + uri2 + ' : ' + message\n                            )\n                        )\n                    }\n                }\n            )\n        })\n    }\n\n    /**\n     * Find (and optionally create) an individual chat between the current user and the given invitee\n     * @param invitee - The person to chat with\n     * @param createIfMissing - Whether the chat should be created, if missing\n     * @returns null if missing, or a node referring to an already existing chat, or the newly created chat\n     */\n    async function getChat(\n        invitee: NamedNode,\n        createIfMissing = true\n    ): Promise<NamedNode | null> {\n        const { me, chatContainer, exists } = await findChat(invitee)\n        if (exists) {\n            return new NamedNode(chatContainer.value + CHAT_LOCATION_IN_CONTAINER)\n        }\n\n        if (createIfMissing) {\n            const chatThing = await createChatThing(chatContainer, me)\n            await sendInvite(invitee, chatThing)\n            await setAcl(chatContainer, me, invitee)\n            await addToPrivateTypeIndex(chatThing, me)\n            return chatThing\n        }\n        return null\n    }\n\n    async function sendInvite(invitee: NamedNode, chatThing: NamedNode) {\n        await store.fetcher.load(invitee.doc())\n        const inviteeInbox = store.any(\n            invitee,\n            ns.ldp('inbox'),\n            undefined,\n            invitee.doc()\n        )\n        if (!inviteeInbox) {\n            throw new Error(`Invitee inbox not found! ${invitee.value}`)\n        }\n        const inviteBody = `\n        <> a <http://www.w3.org/ns/pim/meeting#LongChatInvite> ;\n        ${ns.rdf('seeAlso')} <${chatThing.value}> .\n        `\n\n        const inviteResponse = await store.fetcher?.webOperation(\n            'POST',\n            inviteeInbox.value,\n            {\n                data: inviteBody,\n                contentType: 'text/turtle',\n            }\n        )\n        const locationStr = inviteResponse?.headers.get('location')\n        if (!locationStr) {\n            throw new Error(`Invite sending returned a ${inviteResponse?.status}`)\n        }\n    }\n    return {\n        setAcl, addToPrivateTypeIndex, findChat, createChatThing, getChat, sendInvite, mintNew\n    }\n}\n","import { NamedNode } from 'rdflib'\nimport { InboxLogic } from '../types'\nimport { getArchiveUrl } from '../util/utils'\n\nexport function createInboxLogic(store, profileLogic, utilityLogic, containerLogic, aclLogic): InboxLogic {\n\n    async function createInboxFor(peerWebId: string, nick: string) {\n      const myWebId: NamedNode = await profileLogic.loadMe()\n      const podRoot: NamedNode = await profileLogic.getPodRoot(myWebId)\n      const ourInbox = `${podRoot.value}p2p-inboxes/${encodeURIComponent(nick)}/`\n      await containerLogic.createContainer(ourInbox)\n      // const aclDocUrl = await aclLogic.findAclDocUrl(ourInbox);\n      await utilityLogic.setSinglePeerAccess({\n        ownerWebId: myWebId.value,\n        peerWebId,\n        accessToModes: 'acl:Append',\n        target: ourInbox\n      })\n      return ourInbox\n  }\n\n  async function getNewMessages(\n      user?: NamedNode\n    ): Promise<NamedNode[]> {\n      if (!user) {\n        user = await profileLogic.loadMe()\n      }\n      const inbox = await profileLogic.getMainInbox(user)\n      const urls = await containerLogic.getContainerMembers(inbox)\n      return urls.filter(url => !containerLogic.isContainer(url))\n  }\n\n  async function markAsRead(url: string, date: Date) {\n    const downloaded = await store.fetcher._fetch(url)\n    if (downloaded.status !== 200) {\n      throw new Error(`Not OK! ${url}`)\n    }\n    const archiveUrl = getArchiveUrl(url, date)\n    const options = {\n      method: 'PUT',\n      body: await downloaded.text(),\n      headers: [\n        ['Content-Type', downloaded.headers.get('Content-Type') || 'application/octet-stream']\n      ]\n    }\n    const uploaded = await store.fetcher._fetch(archiveUrl, options)\n    if (uploaded.status.toString()[0] === '2') {\n      await store.fetcher._fetch(url, {\n        method: 'DELETE'\n      })\n    }\n  }\n  return {\n    createInboxFor,\n    getNewMessages,\n    markAsRead\n  }\n}\n","class CustomError extends Error {\n    constructor(message?: string) {\n        super(message)\n        // see: typescriptlang.org/docs/handbook/release-notes/typescript-2-2.html\n        Object.setPrototypeOf(this, new.target.prototype) // restore prototype chain\n        this.name = new.target.name // stack traces display correctly now\n    }\n}\n\nexport class UnauthorizedError extends CustomError {}\n\nexport class CrossOriginForbiddenError extends CustomError {}\n\nexport class SameOriginForbiddenError extends CustomError {}\n\nexport class NotFoundError extends CustomError {}\n\nexport class NotEditableError extends CustomError { }\n\nexport class WebOperationError extends CustomError {}\n\nexport class FetchError extends CustomError {\n    status: number\n\n    constructor(status: number, message?: string) {\n        super(message)\n        this.status = status\n    }\n}","import { NamedNode } from 'rdflib'\nimport { CrossOriginForbiddenError, FetchError, NotEditableError, SameOriginForbiddenError, UnauthorizedError, WebOperationError } from '../logic/CustomError'\nimport * as debug from '../util/debug'\nimport { ns as namespace } from '../util/ns'\nimport { differentOrigin, suggestPreferencesFile } from '../util/utils'\nimport { ProfileLogic } from '../types'\n\nexport function createProfileLogic(store, authn, utilityLogic): ProfileLogic {\n    const ns = namespace\n\n    /**\n     * loads the preference without throwing errors - if it can create it it does so.\n     * remark: it still throws error if it cannot load profile.\n     * @param user\n     * @returns undefined if preferenceFile cannot be returned or NamedNode if it can find it or create it\n     */\n    async function silencedLoadPreferences(user: NamedNode): Promise <NamedNode | undefined> {\n        try {\n            return await loadPreferences(user)\n        } catch (err) {\n            return undefined\n        }\n    }\n\n    /**\n     * loads the preference without returning different errors if it cannot create or load it.\n     * remark: it also throws error if it cannot load profile.\n     * @param user\n     * @returns undefined if preferenceFile cannot be an Error or NamedNode if it can find it or create it\n     */\n    async function loadPreferences (user: NamedNode): Promise <NamedNode> {\n        await loadProfile(user)\n\n        const possiblePreferencesFile = suggestPreferencesFile(user)\n        let preferencesFile\n        try {\n            preferencesFile = await utilityLogic.followOrCreateLink(user, ns.space('preferencesFile') as NamedNode, possiblePreferencesFile, user.doc())\n        } catch (err) {\n            const message = `User ${user} has no pointer in profile to preferences file.`\n            debug.warn(message)\n            // we are listing the possible errors\n            if (err instanceof NotEditableError) { throw err }\n            if (err instanceof WebOperationError) { throw err }\n            if (err instanceof UnauthorizedError) { throw err }\n            if (err instanceof CrossOriginForbiddenError) { throw err }\n            if (err instanceof SameOriginForbiddenError) { throw err }\n            if (err instanceof FetchError) { throw err }\n            throw err\n        }\n\n        try {\n            await store.fetcher.load(preferencesFile as NamedNode)\n        } catch (err) { // Maybe a permission problem or origin problem\n            const msg = `Unable to load preference of user ${user}: ${err}`\n            debug.warn(msg)\n            if (err.response.status === 401) {\n                throw new UnauthorizedError()\n            }\n            if (err.response.status === 403) {\n                if (differentOrigin(preferencesFile)) {\n                throw new CrossOriginForbiddenError()\n                }\n                throw new SameOriginForbiddenError()\n            }\n            /*if (err.response.status === 404) {\n                throw new NotFoundError();\n            }*/\n            throw new Error(msg)\n        }\n        return preferencesFile as NamedNode\n    }\n\n    async function loadProfile (user: NamedNode):Promise <NamedNode> {\n        if (!user) {\n            throw new Error('loadProfile: no user given.')\n        }\n        try {\n            await store.fetcher.load(user.doc())\n        } catch (err) {\n            throw new Error(`Unable to load profile of user ${user}: ${err}`)\n        }\n        return user.doc()\n    }\n\n    async function loadMe(): Promise<NamedNode> {\n        const me = authn.currentUser()\n        if (me === null) {\n            throw new Error('Current user not found! Not logged in?')\n        }\n        await store.fetcher.load(me.doc())\n        return me\n    }\n\n    function getPodRoot(user: NamedNode): NamedNode {\n        const podRoot = findStorage(user)\n        if (!podRoot) {\n            throw new Error('User pod root not found!')\n        }\n        return podRoot as NamedNode\n    }\n\n    async function getMainInbox(user: NamedNode): Promise<NamedNode> {\n        await store.fetcher.load(user)\n        const mainInbox = store.any(user, ns.ldp('inbox'), undefined, user.doc())\n        if (!mainInbox) {\n            throw new Error('User main inbox not found!')\n        }\n        return mainInbox as NamedNode\n    }\n\n    function findStorage(me: NamedNode) {\n        return store.any(me, ns.space('storage'), undefined, me.doc())\n    }\n\n    return {\n        loadMe,\n        getPodRoot,\n        getMainInbox,\n        findStorage,\n        loadPreferences,\n        loadProfile,\n        silencedLoadPreferences\n    }\n}\n","import { NamedNode, st, sym } from 'rdflib'\nimport { ScopedApp, TypeIndexLogic, TypeIndexScope } from '../types'\nimport * as debug from '../util/debug'\nimport { ns as namespace } from '../util/ns'\nimport { newThing } from '../util/utils'\n\nexport function createTypeIndexLogic(store, authn, profileLogic, utilityLogic): TypeIndexLogic {\n    const ns = namespace\n\n    function getRegistrations(instance, theClass) {\n        return store\n            .each(undefined, ns.solid('instance'), instance)\n            .filter((r) => {\n                return store.holds(r, ns.solid('forClass'), theClass)\n            })\n    }\n\n    async function loadTypeIndexesFor(user: NamedNode): Promise<Array<TypeIndexScope>> {\n        if (!user) throw new Error('loadTypeIndexesFor: No user given')\n        const profile = await profileLogic.loadProfile(user)\n\n        const suggestion = suggestPublicTypeIndex(user)\n        let publicTypeIndex\n        try {\n            publicTypeIndex = await utilityLogic.followOrCreateLink(user, ns.solid('publicTypeIndex') as NamedNode, suggestion, profile)\n        } catch (err) {\n            const message = `User ${user} has no pointer in profile to publicTypeIndex file.`\n            debug.warn(message)\n        }\n        const publicScopes = publicTypeIndex ? [{ label: 'public', index: publicTypeIndex as NamedNode, agent: user }] : []\n\n        let preferencesFile\n        try {\n            preferencesFile = await profileLogic.silencedLoadPreferences(user)\n        } catch (err) {\n            preferencesFile = null\n        }\n\n        let privateScopes\n        if (preferencesFile) { // watch out - can be in either as spec was not clear.  Legacy is profile.\n            // If there is a legacy one linked from the profile, use that.\n            // Otherwiae use or make one linked from Preferences\n            const suggestedPrivateTypeIndex = suggestPrivateTypeIndex(preferencesFile)\n            let privateTypeIndex\n            try {\n                privateTypeIndex = store.any(user, ns.solid('privateTypeIndex'), undefined, profile) ||\n                    await utilityLogic.followOrCreateLink(user, ns.solid('privateTypeIndex') as NamedNode, suggestedPrivateTypeIndex, preferencesFile)\n                } catch (err) {\n                const message = `User ${user} has no pointer in preference file to privateTypeIndex file.`\n                debug.warn(message)\n            }\n            privateScopes = privateTypeIndex ? [{ label: 'private', index: privateTypeIndex as NamedNode, agent: user }] : []\n        } else {\n            privateScopes = []\n        }\n        const scopes = publicScopes.concat(privateScopes)\n        if (scopes.length === 0) return scopes\n        const files = scopes.map(scope => scope.index)\n        try {\n            await store.fetcher.load(files)\n        } catch (err) {\n            debug.warn('Problems loading type index: ', err)\n        }\n        return scopes\n    }\n\n    async function loadCommunityTypeIndexes(user: NamedNode): Promise<TypeIndexScope[][]> {\n        let preferencesFile\n        try {\n            preferencesFile = await profileLogic.silencedLoadPreferences(user)\n        } catch (err) {\n            const message = `User ${user} has no pointer in profile to preferences file.`\n            debug.warn(message)\n        }\n        if (preferencesFile) { // For now, pick up communities as simple links from the preferences file.\n            const communities = store.each(user, ns.solid('community'), undefined, preferencesFile as NamedNode).concat(\n                store.each(user, ns.solid('community'), undefined, user.doc() as NamedNode)\n            )\n            let result = []\n            for (const org of communities) {\n                result = result.concat(await loadTypeIndexesFor(org as NamedNode) as any)\n            }\n            return result\n        }\n        return [] // No communities\n    }\n\n    async function loadAllTypeIndexes(user: NamedNode) {\n        return (await loadTypeIndexesFor(user)).concat((await loadCommunityTypeIndexes(user)).flat())\n    }\n\n    async function getScopedAppInstances(klass: NamedNode, user: NamedNode): Promise<ScopedApp[]> {\n        const scopes = await loadAllTypeIndexes(user)\n        let scopedApps = []\n        for (const scope of scopes) {\n            const scopedApps0 = await getScopedAppsFromIndex(scope, klass) as any\n            scopedApps = scopedApps.concat(scopedApps0)\n        }\n        return scopedApps\n    }\n\n    // This is the function signature which used to be in solid-ui/logic\n    // Recommended to use getScopedAppInstances instead as it provides more information.\n    //\n    async function getAppInstances(klass: NamedNode): Promise<NamedNode[]> {\n        const user = authn.currentUser()\n        if (!user) throw new Error('getAppInstances: Must be logged in to find apps.')\n        const scopedAppInstances = await getScopedAppInstances(klass, user)\n        return scopedAppInstances.map(scoped => scoped.instance)\n    }\n\n    function suggestPublicTypeIndex(me: NamedNode) {\n        return sym(me.doc().dir()?.uri + 'publicTypeIndex.ttl')\n    }\n    // Note this one is based off the pref file not the profile\n\n    function suggestPrivateTypeIndex(preferencesFile: NamedNode) {\n        return sym(preferencesFile.doc().dir()?.uri + 'privateTypeIndex.ttl')\n    }\n\n    /*\n    * Register a new app in a type index\n    * used in chat in bookmark.js (solid-ui)\n    * Returns the registration object if successful else null\n    */\n    async function registerInTypeIndex(\n        instance: NamedNode,\n        index: NamedNode,\n        theClass: NamedNode,\n        // agent: NamedNode\n    ): Promise<NamedNode | null> {\n        const registration = newThing(index)\n        const ins = [\n            // See https://github.com/solid/solid/blob/main/proposals/data-discovery.md\n            st(registration, ns.rdf('type'), ns.solid('TypeRegistration'), index),\n            st(registration, ns.solid('forClass'), theClass, index),\n            st(registration, ns.solid('instance'), instance, index)\n        ]\n        try {\n            await store.updater.update([], ins)\n        } catch (err) {\n            const msg = `Unable to register ${instance} in index ${index}: ${err}`\n            console.warn(msg)\n            return null\n        }\n        return registration\n    }\n\n    async function deleteTypeIndexRegistration(item) {\n        const reg = store.the(null, ns.solid('instance'), item.instance, item.scope.index) as NamedNode\n        if (!reg) throw new Error(`deleteTypeIndexRegistration: No registration found for ${item.instance}`)\n        const statements = store.statementsMatching(reg, null, null, item.scope.index)\n        await store.updater.update(statements, [])\n    }\n\n    async function getScopedAppsFromIndex(scope: TypeIndexScope, theClass: NamedNode | null): Promise<ScopedApp[]> {\n        const index = scope.index\n        const results: ScopedApp[] = []\n        const registrations = store.statementsMatching(null, ns.solid('instance'), null, index)\n            .concat(store.statementsMatching(null, ns.solid('instanceContainer'), null, index))\n            .map(st => st.subject)\n        for (const reg of registrations) {\n          const klass = store.any(reg, ns.solid('forClass'), null, index)\n          if (!theClass || klass.sameTerm(theClass)) {\n            const instances = store.each(reg, ns.solid('instance'), null, index)\n            for (const instance of instances) {\n              results.push({ instance, type: klass, scope })\n            }\n            const containers = store.each(reg, ns.solid('instanceContainer'), null, index)\n            for (const instance of containers) {\n                await store.fetcher.load(instance)\n                results.push({ instance: sym(instance.value), type: klass,  scope })\n            }\n          }\n        }\n        return results\n    }\n\n    return {\n        registerInTypeIndex,\n        getRegistrations,\n        loadTypeIndexesFor,\n        loadCommunityTypeIndexes,\n        loadAllTypeIndexes,\n        getScopedAppInstances,\n        getAppInstances,\n        suggestPublicTypeIndex,\n        suggestPrivateTypeIndex,\n        deleteTypeIndexRegistration,\n        getScopedAppsFromIndex\n    }\n}\n","import { Session } from '../authSession/solidOidcAdapter'\nimport * as rdf from 'rdflib'\nimport { LiveStore, NamedNode, Statement } from 'rdflib'\nimport { createAclLogic } from '../acl/aclLogic'\nimport { SolidAuthnLogic } from '../authn/SolidAuthnLogic'\nimport { createChatLogic } from '../chat/chatLogic'\nimport { createInboxLogic } from '../inbox/inboxLogic'\nimport { createProfileLogic } from '../profile/profileLogic'\nimport { createTypeIndexLogic } from '../typeIndex/typeIndexLogic'\nimport { createContainerLogic } from '../util/containerLogic'\nimport { createUtilityLogic } from '../util/utilityLogic'\nimport { AuthnLogic, SolidLogic } from '../types'\nimport * as debug from '../util/debug'\n/*\n** It is important to distinquish `fetch`, a function provided by the browser\n** and `Fetcher`, a helper object for the rdflib Store which turns it\n** into a `ConnectedStore` or a `LiveStore`.  A Fetcher object is\n** available at store.fetcher, and `fetch` function at `store.fetcher._fetch`,\n*/\nexport function createSolidLogic(specialFetch: { fetch: (url: any, requestInit: any) => any }, session: Session): SolidLogic {\n\n    debug.log('SolidLogic: Unique instance created.  There should only be one of these.')\n    const store: LiveStore = rdf.graph() as LiveStore\n    rdf.fetcher(store, {fetch: specialFetch.fetch}) // Attach a web I/O module, store.fetcher\n    store.updater = new rdf.UpdateManager(store) // Add real-time live updates store.updater\n    store.features = [] // disable automatic node merging on store load\n\n    const authn: AuthnLogic = new SolidAuthnLogic(session)\n    \n    const acl = createAclLogic(store)\n    const containerLogic = createContainerLogic(store)\n    const utilityLogic = createUtilityLogic(store, acl, containerLogic)\n    const profile = createProfileLogic(store, authn, utilityLogic)\n    const chat = createChatLogic(store, profile)\n    const inbox = createInboxLogic(store, profile, utilityLogic, containerLogic, acl)\n    const typeIndex = createTypeIndexLogic(store, authn, profile, utilityLogic)\n    debug.log('SolidAuthnLogic initialized')\n\n    function load(doc: NamedNode | NamedNode[] | string) {\n        return store.fetcher.load(doc)\n    }\n\n    // @@@@ use the one in rdflib.js when it is available and delete this\n    function updatePromise(\n        del: Array<Statement>,\n        ins: Array<Statement> = []\n    ): Promise<void> {\n        return new Promise((resolve, reject) => {\n        store.updater.update(del, ins, function (_uri, ok, errorBody) {\n            if (!ok) {\n            reject(new Error(errorBody))\n            } else {\n            resolve()\n            }\n        }) // callback\n        }) // promise\n    }\n\n    function clearStore() {\n        store.statements.slice().forEach(store.remove.bind(store))\n    }\n\n    return {\n        store,\n        authn,\n        acl,\n        inbox,\n        chat,\n        profile,\n        typeIndex,\n        load,\n        updatePromise,\n        clearStore\n    }\n}\n","import { NamedNode, Statement, sym } from 'rdflib'\n\n/**\n * Container-related class\n */\nexport function createContainerLogic(store) {\n\n    function getContainerElements(containerNode: NamedNode): NamedNode[] {\n        return store\n            .statementsMatching(\n                containerNode,\n                sym('http://www.w3.org/ns/ldp#contains'),\n                undefined\n            )\n            .map((st: Statement) => st.object as NamedNode)\n    }\n\n    function isContainer(url: NamedNode) {\n        const nodeToString = url.value\n        return nodeToString.charAt(nodeToString.length - 1) === '/'\n    }\n\n    async function createContainer(url: string) {\n        const stringToNode = sym(url)\n        if (!isContainer(stringToNode)) {\n            throw new Error(`Not a container URL ${url}`)\n        }\n        // Copied from https://github.com/solidos/solid-crud-tests/blob/v3.1.0/test/surface/create-container.test.ts#L56-L64\n        const result = await store.fetcher._fetch(url, {\n            method: 'PUT',\n            headers: {\n                'Content-Type': 'text/turtle',\n                'If-None-Match': '*',\n                Link: '<http://www.w3.org/ns/ldp#BasicContainer>; rel=\"type\"', // See https://github.com/solidos/node-solid-server/issues/1465\n            },\n            body: ' ', // work around https://github.com/michielbdejong/community-server/issues/4#issuecomment-776222863\n        })\n        if (result.status.toString()[0] !== '2') {\n            throw new Error(`Not OK: got ${result.status} response while creating container at ${url}`)\n        }\n    }\n\n    async function getContainerMembers(containerUrl: NamedNode): Promise<NamedNode[]> {\n        await store.fetcher.load(containerUrl)\n        return getContainerElements(containerUrl)\n    }\n    return {\n        isContainer,\n        createContainer,\n        getContainerElements,\n        getContainerMembers\n    }\n}","import { NamedNode, st, sym } from 'rdflib'\nimport { CrossOriginForbiddenError, FetchError, NotEditableError, SameOriginForbiddenError, UnauthorizedError, WebOperationError } from '../logic/CustomError'\nimport * as debug from '../util/debug'\nimport { differentOrigin } from './utils'\n\nexport function createUtilityLogic(store, aclLogic, containerLogic) {\n\n  async function recursiveDelete(containerNode: NamedNode) {\n      try {\n        if (containerLogic.isContainer(containerNode)) {\n          const aclDocUrl = await aclLogic.findAclDocUrl(containerNode)\n          await store.fetcher._fetch(aclDocUrl, { method: 'DELETE' })\n          const containerMembers = await containerLogic.getContainerMembers(containerNode)\n          await Promise.all(\n            containerMembers.map((url) => recursiveDelete(url))\n          )\n        }\n        const nodeToStringHere = containerNode.value\n        return store.fetcher._fetch(nodeToStringHere, { method: 'DELETE' })\n      } catch (e) {\n        debug.log(`Please manually remove ${containerNode.value} from your system.`, e)\n      }\n  }\n\n  /**\n   * Create a resource if it really does not exist\n   * Be absolutely sure something does not exist before creating a new empty file\n   * as otherwise existing could  be deleted.\n   * @param doc {NamedNode} - The resource\n   */\n  async function loadOrCreateIfNotExists(doc: NamedNode) {\n    let response\n    try {\n      response = await store.fetcher.load(doc)\n    } catch (err) {\n      if (err.response.status === 404) {\n        try {\n          await store.fetcher.webOperation('PUT', doc, { data: '', contentType: 'text/turtle' })\n        } catch (err) {\n          const msg = 'createIfNotExists: PUT FAILED: ' + doc + ': ' + err\n          throw new WebOperationError(msg)\n        }\n        await store.fetcher.load(doc)\n      } else {\n        if (err.response.status === 401) {\n          throw new UnauthorizedError()\n        }\n        if (err.response.status === 403) {\n          if (differentOrigin(doc)) {\n            throw new CrossOriginForbiddenError()\n          }\n          throw new SameOriginForbiddenError()\n        }\n        const msg = 'createIfNotExists doc load error NOT 404:  ' + doc + ': ' + err\n        throw new FetchError(err.status, err.message + msg)\n      }\n    }\n    return response\n  }\n\n  /* Follow link from this doc to another thing, or else make a new link\n  **\n  ** @returns existing object, or creates it if non existent\n  */\n  async function followOrCreateLink(subject: NamedNode, predicate: NamedNode,\n    object: NamedNode, doc: NamedNode\n  ): Promise<NamedNode | null> {\n    await store.fetcher.load(doc)\n    const result = store.any(subject, predicate, null, doc)\n\n    if (result) return result as NamedNode\n    if (!store.updater.editable(doc)) {\n      const msg = `followOrCreateLink: cannot edit ${doc.value}`\n      debug.warn(msg)\n      throw new NotEditableError(msg)\n    }\n    try {\n      await store.updater.update([], [st(subject, predicate, object, doc)])\n    } catch (err) {\n      const msg = `followOrCreateLink: Error making link in ${doc} to ${object}: ${err}`\n      debug.warn(msg)\n      throw new WebOperationError(err)\n    }\n\n    try {\n      await loadOrCreateIfNotExists(object)\n      // store.fetcher.webOperation('PUT', object, { data: '', contentType: 'text/turtle'})\n    } catch (err) {\n      debug.warn(`followOrCreateLink: Error loading or saving new linked document: ${object}: ${err}`)\n      throw err\n    }\n    return object\n  }\n\n  // Copied from https://github.com/solidos/web-access-control-tests/blob/v3.0.0/test/surface/delete.test.ts#L5\n  async function setSinglePeerAccess(options: {\n    ownerWebId: string,\n    peerWebId: string,\n    accessToModes?: string,\n    defaultModes?: string,\n    target: string\n  }) {\n    let str = [\n      '@prefix acl: <http://www.w3.org/ns/auth/acl#>.',\n      '',\n      `<#alice> a acl:Authorization;\\n  acl:agent <${options.ownerWebId}>;`,\n      `  acl:accessTo <${options.target}>;`,\n      `  acl:default <${options.target}>;`,\n      '  acl:mode acl:Read, acl:Write, acl:Control.',\n      ''\n    ].join('\\n')\n    if (options.accessToModes) {\n      str += [\n        '<#bobAccessTo> a acl:Authorization;',\n        `  acl:agent <${options.peerWebId}>;`,\n        `  acl:accessTo <${options.target}>;`,\n        `  acl:mode ${options.accessToModes}.`,\n        ''\n      ].join('\\n')\n    }\n    if (options.defaultModes) {\n      str += [\n        '<#bobDefault> a acl:Authorization;',\n        `  acl:agent <${options.peerWebId}>;`,\n        `  acl:default <${options.target}>;`,\n        `  acl:mode ${options.defaultModes}.`,\n        ''\n      ].join('\\n')\n    }\n    const aclDocUrl = await aclLogic.findAclDocUrl(sym(options.target))\n    return store.fetcher._fetch(aclDocUrl, {\n      method: 'PUT',\n      body: str,\n      headers: [\n        ['Content-Type', 'text/turtle']\n      ]\n    })\n  }\n\n  async function createEmptyRdfDoc(doc: NamedNode, comment: string) {\n    await store.fetcher.webOperation('PUT', doc.uri, {\n      data: `# ${new Date()} ${comment}\n  `,\n      contentType: 'text/turtle',\n    })\n  }\n  \n  return {\n    recursiveDelete,\n    setSinglePeerAccess,\n    createEmptyRdfDoc,\n    followOrCreateLink,\n    loadOrCreateIfNotExists\n  }\n}\n\n","import * as debug from '../util/debug'\nimport { authSession } from '../authSession/authSession'\nimport { createSolidLogic } from './solidLogic'\nimport { SolidLogic } from '../types'\n\nconst _fetch = async (url, requestInit) => {\n    const omitCreds = requestInit && requestInit.credentials && requestInit.credentials == 'omit'\n    if (authSession.info.webId && !omitCreds) { // see https://github.com/solidos/solidos/issues/114\n        // In fact fetch should respect credentials omit itself\n        return authSession.fetch(url, requestInit)\n    } else {\n        return window.fetch(url, requestInit)\n    }\n}\n\n// Global singleton pattern to ensure unique store across library versions\nconst SINGLETON_SYMBOL = Symbol.for('solid-logic-singleton')\n\n// Type the global object properly with the singleton\ninterface GlobalWithSingleton {\n    [SINGLETON_SYMBOL]?: SolidLogic\n}\n\nconst globalTarget = (typeof window !== 'undefined' ? window : global) as GlobalWithSingleton\n\nfunction getOrCreateSingleton(): SolidLogic {\n    if (!globalTarget[SINGLETON_SYMBOL]) {\n        debug.log('SolidLogic: Creating new global singleton instance.')\n        globalTarget[SINGLETON_SYMBOL] = createSolidLogic({ fetch: _fetch }, authSession)\n        debug.log('Unique quadstore initialized.')\n    } else {\n        debug.log('SolidLogic: Using existing global singleton instance.')\n    }\n    return globalTarget[SINGLETON_SYMBOL]!\n}\n//this const makes solidLogicSingleton global accessible in mashlib\nconst solidLogicSingleton = getOrCreateSingleton()\n\nexport { solidLogicSingleton }","const DEFAULT_ISSUERS = [\n  {\n    name: 'Solid Community',\n    uri: 'https://solidcommunity.net'\n  },\n  {\n    name: 'Solid Web',\n    uri: 'https://solidweb.org'\n  },\n  {\n    name: 'Solid Web ME',\n    uri: 'https://solidweb.me'\n  },\n  {\n    name: 'Inrupt.com',\n    uri: 'https://login.inrupt.com'\n  }\n]\n\n/**\n * @returns - A list of suggested OIDC issuers\n */\nexport function getSuggestedIssuers (): { name: string, uri: string }[] {\n    // Suggest a default list of OIDC issuers\n    const issuers = [...DEFAULT_ISSUERS]\n  \n    // Suggest the current host if not already included\n    const { host, origin } = new URL(location.href)\n    const hosts = issuers.map(({ uri }) => new URL(uri).host)\n    if (!hosts.includes(host) && !hosts.some(existing => isSubdomainOf(host, existing))) {\n      issuers.unshift({ name: host, uri: origin })\n    }\n  \n    return issuers\n  }\n  \nfunction isSubdomainOf (subdomain: string, domain: string): boolean {\n    const dot = subdomain.length - domain.length - 1\n    return dot > 0 && subdomain[dot] === '.' && subdomain.endsWith(domain)\n}","// Make these variables directly accessible as it is what you need most of the time\n// This also makes these variable globaly accesible in mashlib\nimport { solidLogicSingleton } from './logic/solidLogicSingleton'\n\nconst authn = solidLogicSingleton.authn\nconst authSession = solidLogicSingleton.authn.authSession\nconst store = solidLogicSingleton.store\n\nexport { ACL_LINK } from './acl/aclLogic'\nexport { offlineTestID, appContext } from './authn/authUtil'\nexport { getSuggestedIssuers } from './issuer/issuerLogic'\nexport { createTypeIndexLogic } from './typeIndex/typeIndexLogic'\nexport type { AppDetails, SolidNamespace, AuthenticationContext, SolidLogic, ChatLogic } from './types'\nexport { UnauthorizedError, CrossOriginForbiddenError, SameOriginForbiddenError, NotFoundError, FetchError, NotEditableError, WebOperationError } from './logic/CustomError'\n\nexport {\n  solidLogicSingleton, // solidLogicSingleton is exported entirely because it is used in solid-panes\n  store,\n  authn,\n  authSession\n}\n\n"],"names":["aliases","acl","arg","as","bookmark","cal","cco","cert","contact","dc","dct","doap","foaf","geo","gpx","gr","http","httph","icalTZ","ldp","link","log","meeting","mo","org","owl","pad","patch","prov","pto","qu","trip","rdf","rdfs","rss","sched","schema","sioc","skos","solid","space","stat","tab","tabont","ui","vann","vcard","wf","xsd","module","exports","namedNode","u","namespaces","alias","expansion","localName","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","__webpack_modules__","args","console","warn","n","getter","__esModule","d","a","definition","key","o","Object","defineProperty","enumerable","get","g","globalThis","this","Function","e","window","obj","prop","prototype","hasOwnProperty","call","isCryptoKey","CryptoKey","message","msg","actual","types","filter","Boolean","length","last","pop","join","name","constructor","withAlg","alg","encoder","TextEncoder","decoder","TextDecoder","concat","buffers","size","reduce","acc","buf","Uint8Array","i","buffer","set","encode","input","unencoded","arr","push","String","fromCharCode","apply","subarray","btoa","encodeBase64","replace","decode","encoded","binary","atob","bytes","charCodeAt","decodeBase64","TypeError","Symbol","toStringTag","async","kty","k","extractable","ext","key_ops","use","jwk","subtle","exportKey","exportJWK","JOSEError","Error","options","super","code","captureStackTrace","JWTClaimValidationFailed","payload","claim","reason","cause","JWTExpired","JOSEAlgNotAllowed","arguments","JWSInvalid","JWTInvalid","JWKInvalid","JWKSInvalid","JWKSNoMatchingKey","JWKSMultipleMatchingKeys","asyncIterator","JWKSTimeout","JWSSignatureVerificationFailed","subtleDsa","algorithm","hash","slice","saltLength","namedCurve","startsWith","modulusLength","unusable","isAlgorithm","getHashLength","parseInt","checkUsage","usages","some","expected","includes","checkSigCryptoKey","getNamedCurve","isObject","value","toString","getPrototypeOf","proto","isJWK","keyUsages","crv","subtleMapping","rest","keyData","importKey","exportKeyValue","privCache","pubCache","isKeyObject","importAndCache","cache","freeze","cached","cryptoKey","export","format","dp","dq","p","q","qi","WeakMap","getCryptoKey","usage","data","signature","sign","headers","sources","header","parameters","keys","parameter","has","add","Set","tag","jwkMatchesOp","symmetricTypeCheck","allowJwk","type","checkKeyType","test","asymmetricTypeCheck","bind","checkKeyTypeWithJwk","Err","recognizedDefault","recognizedOption","protectedHeader","joseHeader","crit","Array","isArray","recognized","Map","entries","FlattenedSign","_payload","setProtectedHeader","_protectedHeader","setUnprotectedHeader","unprotectedHeader","_unprotectedHeader","b64","JSON","stringify","jws","protected","CompactSign","_flattened","date","Math","floor","getTime","day","hour","REGEX","str","matched","exec","parseFloat","numericDate","toLowerCase","round","minute","validateInput","label","Number","isFinite","ProduceJWT","setIssuer","issuer","iss","setSubject","subject","sub","setAudience","audience","aud","setJti","jwtId","jti","setNotBefore","nbf","Date","epoch","secs","setExpirationTime","exp","setIssuedAt","iat","SignJWT","sig","url","timeout","controller","id","timedOut","AbortController","setTimeout","abort","response","fetch","href","signal","redirect","catch","err","clearTimeout","status","json","importJWK","oth","isJWKLike","clone","structuredClone","parse","LocalJWKSet","jwks","_cached","every","isJWKSLike","_jwks","getKey","token","kid","getKtyFromAlg","candidates","candidate","error","importWithAlgCache","createLocalJWKSet","localJWKSet","defineProperties","configurable","writable","USER_AGENT","navigator","userAgent","jwksCache","RemoteJWKSet","URL","cacheMaxAge","_url","_options","agent","_timeoutDuration","timeoutDuration","_cooldownDuration","cooldownDuration","_cacheMaxAge","_cache","uat","now","_jwksTimestamp","_local","coolingDown","fresh","reload","_pendingFetch","WebSocketPair","EdgeRuntime","Headers","fromEntries","then","verify","option","algorithms","s","compactVerify","split","verified","parsedProt","resolvedKey","result","flattenedVerify","normalizeTyp","encodedPayload","typ","requiredClaims","maxTokenAge","presenceCheck","reverse","audPayload","audOption","tolerance","clockTolerance","currentDate","age","subtleDigest","digest","check","description","calculateJwkThumbprint","digestAlgorithm","components","x","y","getModulusLengthOption","publicExponent","generateKey","SessionEvents","SessionDatabase","dbName","storeName","dbVersion","db","init","Promise","resolve","reject","request","indexedDB","open","onerror","onsuccess","onupgradeneeded","event","target","objectStoreNames","contains","createObjectStore","setItem","tx","transaction","oncomplete","objectStore","put","getItem","deleteItem","delete","clear","close","createDPoPToken","keyPair","htu","htm","ath","publicJwk","publicKey","crypto","randomUUID","privateKey","requestTokens","tokenEndpoint","params","dpop","method","body","URLSearchParams","ok","validateAccessToken","accessToken","jwksUri","clientId","remoteJWKSet","reloading","createRemoteJWKSet","jwt","jwtVerify","thumbprint","cnf","jkt","client_id","EventTarget","database","onStateChange","onExpirationWarning","onExpiration","_isActive","_webId","_exp","_ath","_tokens","_idpDetails","_refreshPromise","addEventListener","isActive","webId","isExpired","getExpiresIn","login","idp","redirectUri","redirectUrl","sanitizedRedirect","origin","pathname","search","config","discoverOIDC","trimSlash","endsWith","sessionStorage","token_endpoint","jwks_uri","registrationEndpoint","redirectUris","application_type","redirect_uris","token_endpoint_auth_method","grant_types","response_types","scope","registerClient","registration_endpoint","pkce","verifier","challenge","generatePKCE","csrfToken","authUrl","authorization_endpoint","searchParams","location","handleRedirectFromLogin","csrf","history","replaceState","document","title","pkceVerifier","tokens","grant_type","code_verifier","redirect_uri","access_token","all","refresh_token","removeItem","_setTokens","dpop_key_pair","_dispatchStateChange","restore","refreshToken","refreshTokens","_dispatchExpiration","_dispatchExpirationWarning","logout","authFetch","Request","toUpperCase","decoded","decodeJwt","webid","hashBuffer","hashArray","from","computeAth","dispatchEvent","CustomEvent","detail","expires_in","EVENTS","EventEmitter","listeners","on","callback","off","emit","forEach","cb","Session","_session","_events","_sessionId","events","info","isLoggedIn","sessionId","expirationDate","handleIncomingRedirect","opts","restorePreviousSession","oidcIssuer","authSession","__WEBPACK_EXTERNAL_MODULE_rdflib__","ACL_LINK","sym","createAclLogic","store","ns","genACLText","docURI","me","aclURI","optPublic","public","graph","auth","Namespace","doc","defaultForNew","serialize","findAclDocUrl","fetcher","load","docNode","any","setACLUserPublic","aclDoc","fetchACLRel","aclText","uri","webOperation","contentType","appContext","SolidAppContext","viewingNoAuthPage","noAuth","viewedPage","decodeURI","ary","offlineTestID","$SolidTestEnvironment","username","div","getElementById","getAttribute","SolidAuthnLogic","solidAuthSession","session","currentUser","app","checkUser","setUserCallback","preLoginRedirectHash","localStorage","postLoginRedirectHash","curUrl","pushState","webIdFromSession","saveUser","context","webIdUri","newThing","differentOrigin","CHAT_LOCATION_IN_CONTAINER","createChatLogic","profileLogic","setAcl","chatContainer","invitee","chatAclDoc","NamedNode","aclBody","addToPrivateTypeIndex","chatThing","privateTypeIndex","reg","ins","st","updater","update","_uri","errm","findChat","loadMe","podRoot","chatContainerStr","host","determineChatContainer","getPodRoot","exists","createChatThing","mintNew","newBase","newInstance","newPaneOptions","kb","newChatDoc","term","statementsMatching","uri2","sendInvite","inviteeInbox","inviteBody","inviteResponse","getChat","createIfMissing","createInboxLogic","utilityLogic","containerLogic","aclLogic","createInboxFor","peerWebId","nick","myWebId","ourInbox","encodeURIComponent","createContainer","setSinglePeerAccess","ownerWebId","accessToModes","getNewMessages","user","inbox","getMainInbox","getContainerMembers","isContainer","markAsRead","downloaded","_fetch","archiveUrl","baseUrl","year","getUTCFullYear","month","getUTCMonth","getUTCDate","parts","filename","getArchiveUrl","text","CustomError","setPrototypeOf","UnauthorizedError","CrossOriginForbiddenError","SameOriginForbiddenError","NotFoundError","NotEditableError","WebOperationError","FetchError","createProfileLogic","authn","loadPreferences","loadProfile","possiblePreferencesFile","fileURI","folderURI","suggestPreferencesFile","preferencesFile","followOrCreateLink","findStorage","mainInbox","silencedLoadPreferences","createTypeIndexLogic","loadTypeIndexesFor","profile","suggestion","suggestPublicTypeIndex","publicTypeIndex","publicScopes","index","privateScopes","suggestedPrivateTypeIndex","suggestPrivateTypeIndex","scopes","files","map","loadCommunityTypeIndexes","communities","each","loadAllTypeIndexes","flat","getScopedAppInstances","klass","scopedApps","scopedApps0","getScopedAppsFromIndex","dir","theClass","results","registrations","sameTerm","instances","instance","containers","registerInTypeIndex","registration","getRegistrations","r","holds","getAppInstances","scoped","deleteTypeIndexRegistration","item","the","statements","createSolidLogic","specialFetch","features","getContainerElements","containerNode","object","nodeToString","charAt","Link","containerUrl","createContainerLogic","loadOrCreateIfNotExists","recursiveDelete","aclDocUrl","containerMembers","nodeToStringHere","defaultModes","createEmptyRdfDoc","comment","predicate","editable","createUtilityLogic","chat","typeIndex","updatePromise","del","errorBody","clearStore","remove","requestInit","omitCreds","credentials","SINGLETON_SYMBOL","for","globalTarget","solidLogicSingleton","DEFAULT_ISSUERS","getSuggestedIssuers","issuers","hosts","existing","subdomain","domain","dot","isSubdomainOf","unshift"],"ignoreList":[],"sourceRoot":""}