import*as e from"rdflib";var t={386(e){const t={acl:"http://www.w3.org/ns/auth/acl#",arg:"http://www.w3.org/ns/pim/arg#",as:"https://www.w3.org/ns/activitystreams#",bookmark:"http://www.w3.org/2002/01/bookmark#",cal:"http://www.w3.org/2002/12/cal/ical#",cco:"http://www.ontologyrepository.com/CommonCoreOntologies/",cert:"http://www.w3.org/ns/auth/cert#",contact:"http://www.w3.org/2000/10/swap/pim/contact#",dc:"http://purl.org/dc/elements/1.1/",dct:"http://purl.org/dc/terms/",doap:"http://usefulinc.com/ns/doap#",foaf:"http://xmlns.com/foaf/0.1/",geo:"http://www.w3.org/2003/01/geo/wgs84_pos#",gpx:"http://www.w3.org/ns/pim/gpx#",gr:"http://purl.org/goodrelations/v1#",http:"http://www.w3.org/2007/ont/http#",httph:"http://www.w3.org/2007/ont/httph#",icalTZ:"http://www.w3.org/2002/12/cal/icaltzd#",ldp:"http://www.w3.org/ns/ldp#",link:"http://www.w3.org/2007/ont/link#",log:"http://www.w3.org/2000/10/swap/log#",meeting:"http://www.w3.org/ns/pim/meeting#",mo:"http://purl.org/ontology/mo/",org:"http://www.w3.org/ns/org#",owl:"http://www.w3.org/2002/07/owl#",pad:"http://www.w3.org/ns/pim/pad#",patch:"http://www.w3.org/ns/pim/patch#",prov:"http://www.w3.org/ns/prov#",pto:"http://www.productontology.org/id/",qu:"http://www.w3.org/2000/10/swap/pim/qif#",trip:"http://www.w3.org/ns/pim/trip#",rdf:"http://www.w3.org/1999/02/22-rdf-syntax-ns#",rdfs:"http://www.w3.org/2000/01/rdf-schema#",rss:"http://purl.org/rss/1.0/",sched:"http://www.w3.org/ns/pim/schedule#",schema:"http://schema.org/",sioc:"http://rdfs.org/sioc/ns#",skos:"http://www.w3.org/2004/02/skos/core#",solid:"http://www.w3.org/ns/solid/terms#",space:"http://www.w3.org/ns/pim/space#",stat:"http://www.w3.org/ns/posix/stat#",tab:"http://www.w3.org/2007/ont/link#",tabont:"http://www.w3.org/2007/ont/link#",ui:"http://www.w3.org/ns/ui#",vann:"http://purl.org/vocab/vann/",vcard:"http://www.w3.org/2006/vcard/ns#",wf:"http://www.w3.org/2005/01/wf/flow#",xsd:"http://www.w3.org/2001/XMLSchema#"};e.exports=function(e={namedNode:e=>e}){const r={};for(const n in t){const o=t[n];r[n]=function(t=""){return e.namedNode(o+t)}}return r}}},r={};function n(e){var o=r[e];if(void 0!==o)return o.exports;var a=r[e]={exports:{}};return t[e](a,a.exports,n),a.exports}function o(...e){console.log(...e)}function a(...e){console.warn(...e)}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);const s=crypto,i=e=>e instanceof CryptoKey;function c(e,t,...r){if((r=r.filter(Boolean)).length>2){const t=r.pop();e+=`one of type ${r.join(", ")}, or ${t}.`}else 2===r.length?e+=`one of type ${r[0]} or ${r[1]}.`:e+=`of type ${r[0]}.`;return null==t?e+=` Received ${t}`:"function"==typeof t&&t.name?e+=` Received function ${t.name}`:"object"==typeof t&&null!=t&&t.constructor?.name&&(e+=` Received an instance of ${t.constructor.name}`),e}const d=(e,...t)=>c("Key must be ",e,...t);function l(e,t,...r){return c(`Key for the ${e} algorithm must be `,t,...r)}const h=new TextEncoder,u=new TextDecoder;function w(...e){const t=e.reduce((e,{length:t})=>e+t,0),r=new Uint8Array(t);let n=0;for(const t of e)r.set(t,n),n+=t.length;return r}const p=e=>(e=>{let t=e;"string"==typeof t&&(t=h.encode(t));const r=[];for(let e=0;e<t.length;e+=32768)r.push(String.fromCharCode.apply(null,t.subarray(e,e+32768)));return btoa(r.join(""))})(e).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"),f=e=>{let t=e;t instanceof Uint8Array&&(t=u.decode(t)),t=t.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"");try{return(e=>{const t=atob(e),r=new Uint8Array(t.length);for(let e=0;e<t.length;e++)r[e]=t.charCodeAt(e);return r})(t)}catch{throw new TypeError("The input to be decoded is not correctly encoded.")}},y=e=>!!i(e)||"KeyObject"===e?.[Symbol.toStringTag],m=["CryptoKey"],g=async e=>{if(e instanceof Uint8Array)return{kty:"oct",k:p(e)};if(!i(e))throw new TypeError(d(e,...m,"Uint8Array"));if(!e.extractable)throw new TypeError("non-extractable CryptoKey cannot be exported as a JWK");const{ext:t,key_ops:r,alg:n,use:o,...a}=await s.subtle.exportKey("jwk",e);return a};async function b(e){return g(e)}class _ extends Error{constructor(e,t){super(e,t),this.code="ERR_JOSE_GENERIC",this.name=this.constructor.name,Error.captureStackTrace?.(this,this.constructor)}}_.code="ERR_JOSE_GENERIC";class S extends _{constructor(e,t,r="unspecified",n="unspecified"){super(e,{cause:{claim:r,reason:n,payload:t}}),this.code="ERR_JWT_CLAIM_VALIDATION_FAILED",this.claim=r,this.reason=n,this.payload=t}}S.code="ERR_JWT_CLAIM_VALIDATION_FAILED";class E extends _{constructor(e,t,r="unspecified",n="unspecified"){super(e,{cause:{claim:r,reason:n,payload:t}}),this.code="ERR_JWT_EXPIRED",this.claim=r,this.reason=n,this.payload=t}}E.code="ERR_JWT_EXPIRED";class v extends _{constructor(){super(...arguments),this.code="ERR_JOSE_ALG_NOT_ALLOWED"}}v.code="ERR_JOSE_ALG_NOT_ALLOWED";class k extends _{constructor(){super(...arguments),this.code="ERR_JOSE_NOT_SUPPORTED"}}k.code="ERR_JOSE_NOT_SUPPORTED";(class extends _{constructor(e="decryption operation failed",t){super(e,t),this.code="ERR_JWE_DECRYPTION_FAILED"}}).code="ERR_JWE_DECRYPTION_FAILED";(class extends _{constructor(){super(...arguments),this.code="ERR_JWE_INVALID"}}).code="ERR_JWE_INVALID";class A extends _{constructor(){super(...arguments),this.code="ERR_JWS_INVALID"}}A.code="ERR_JWS_INVALID";class I extends _{constructor(){super(...arguments),this.code="ERR_JWT_INVALID"}}I.code="ERR_JWT_INVALID";class P extends _{constructor(){super(...arguments),this.code="ERR_JWK_INVALID"}}P.code="ERR_JWK_INVALID";class T extends _{constructor(){super(...arguments),this.code="ERR_JWKS_INVALID"}}T.code="ERR_JWKS_INVALID";class x extends _{constructor(e="no applicable key found in the JSON Web Key Set",t){super(e,t),this.code="ERR_JWKS_NO_MATCHING_KEY"}}x.code="ERR_JWKS_NO_MATCHING_KEY";class C extends _{constructor(e="multiple matching keys found in the JSON Web Key Set",t){super(e,t),this.code="ERR_JWKS_MULTIPLE_MATCHING_KEYS"}}Symbol.asyncIterator,C.code="ERR_JWKS_MULTIPLE_MATCHING_KEYS";class R extends _{constructor(e="request timed out",t){super(e,t),this.code="ERR_JWKS_TIMEOUT"}}R.code="ERR_JWKS_TIMEOUT";class W extends _{constructor(e="signature verification failed",t){super(e,t),this.code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED"}}function $(e,t){const r=`SHA-${e.slice(-3)}`;switch(e){case"HS256":case"HS384":case"HS512":return{hash:r,name:"HMAC"};case"PS256":case"PS384":case"PS512":return{hash:r,name:"RSA-PSS",saltLength:e.slice(-3)>>3};case"RS256":case"RS384":case"RS512":return{hash:r,name:"RSASSA-PKCS1-v1_5"};case"ES256":case"ES384":case"ES512":return{hash:r,name:"ECDSA",namedCurve:t.namedCurve};case"Ed25519":return{name:"Ed25519"};case"EdDSA":return{name:t.name};default:throw new k(`alg ${e} is not supported either by JOSE or your javascript runtime`)}}W.code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED";const U=(e,t)=>{if(e.startsWith("RS")||e.startsWith("PS")){const{modulusLength:r}=t.algorithm;if("number"!=typeof r||r<2048)throw new TypeError(`${e} requires key modulusLength to be 2048 bits or larger`)}};function D(e,t="algorithm.name"){return new TypeError(`CryptoKey does not support this operation, its ${t} must be ${e}`)}function O(e,t){return e.name===t}function H(e){return parseInt(e.name.slice(4),10)}function L(e,t){if(t.length&&!t.some(t=>e.usages.includes(t))){let e="CryptoKey does not support this operation, its usages must include ";if(t.length>2){const r=t.pop();e+=`one of ${t.join(", ")}, or ${r}.`}else 2===t.length?e+=`one of ${t[0]} or ${t[1]}.`:e+=`${t[0]}.`;throw new TypeError(e)}}function N(e,t,...r){switch(t){case"HS256":case"HS384":case"HS512":{if(!O(e.algorithm,"HMAC"))throw D("HMAC");const r=parseInt(t.slice(2),10);if(H(e.algorithm.hash)!==r)throw D(`SHA-${r}`,"algorithm.hash");break}case"RS256":case"RS384":case"RS512":{if(!O(e.algorithm,"RSASSA-PKCS1-v1_5"))throw D("RSASSA-PKCS1-v1_5");const r=parseInt(t.slice(2),10);if(H(e.algorithm.hash)!==r)throw D(`SHA-${r}`,"algorithm.hash");break}case"PS256":case"PS384":case"PS512":{if(!O(e.algorithm,"RSA-PSS"))throw D("RSA-PSS");const r=parseInt(t.slice(2),10);if(H(e.algorithm.hash)!==r)throw D(`SHA-${r}`,"algorithm.hash");break}case"EdDSA":if("Ed25519"!==e.algorithm.name&&"Ed448"!==e.algorithm.name)throw D("Ed25519 or Ed448");break;case"Ed25519":if(!O(e.algorithm,"Ed25519"))throw D("Ed25519");break;case"ES256":case"ES384":case"ES512":{if(!O(e.algorithm,"ECDSA"))throw D("ECDSA");const r=function(e){switch(e){case"ES256":return"P-256";case"ES384":return"P-384";case"ES512":return"P-521";default:throw new Error("unreachable")}}(t);if(e.algorithm.namedCurve!==r)throw D(r,"algorithm.namedCurve");break}default:throw new TypeError("CryptoKey does not support this operation")}L(e,r)}function J(e){if("object"!=typeof(t=e)||null===t||"[object Object]"!==Object.prototype.toString.call(e))return!1;var t;if(null===Object.getPrototypeOf(e))return!0;let r=e;for(;null!==Object.getPrototypeOf(r);)r=Object.getPrototypeOf(r);return Object.getPrototypeOf(e)===r}function K(e){return J(e)&&"string"==typeof e.kty}const j=async e=>{if(!e.alg)throw new TypeError('"alg" argument is required when "jwk.alg" is not present');const{algorithm:t,keyUsages:r}=function(e){let t,r;switch(e.kty){case"RSA":switch(e.alg){case"PS256":case"PS384":case"PS512":t={name:"RSA-PSS",hash:`SHA-${e.alg.slice(-3)}`},r=e.d?["sign"]:["verify"];break;case"RS256":case"RS384":case"RS512":t={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${e.alg.slice(-3)}`},r=e.d?["sign"]:["verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":t={name:"RSA-OAEP",hash:`SHA-${parseInt(e.alg.slice(-3),10)||1}`},r=e.d?["decrypt","unwrapKey"]:["encrypt","wrapKey"];break;default:throw new k('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;case"EC":switch(e.alg){case"ES256":t={name:"ECDSA",namedCurve:"P-256"},r=e.d?["sign"]:["verify"];break;case"ES384":t={name:"ECDSA",namedCurve:"P-384"},r=e.d?["sign"]:["verify"];break;case"ES512":t={name:"ECDSA",namedCurve:"P-521"},r=e.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":t={name:"ECDH",namedCurve:e.crv},r=e.d?["deriveBits"]:[];break;default:throw new k('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;case"OKP":switch(e.alg){case"Ed25519":t={name:"Ed25519"},r=e.d?["sign"]:["verify"];break;case"EdDSA":t={name:e.crv},r=e.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":t={name:e.crv},r=e.d?["deriveBits"]:[];break;default:throw new k('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;default:throw new k('Invalid or unsupported JWK "kty" (Key Type) Parameter value')}return{algorithm:t,keyUsages:r}}(e),n=[t,e.ext??!1,e.key_ops??r],o={...e};return delete o.alg,delete o.use,s.subtle.importKey("jwk",o,...n)},M=e=>f(e);let F,z;const V=e=>"KeyObject"===e?.[Symbol.toStringTag],q=async(e,t,r,n,o=!1)=>{let a=e.get(t);if(a?.[n])return a[n];const s=await j({...r,alg:n});return o&&Object.freeze(t),a?a[n]=s:e.set(t,{[n]:s}),s},B=(e,t)=>{if(V(e)){let r=e.export({format:"jwk"});return delete r.d,delete r.dp,delete r.dq,delete r.p,delete r.q,delete r.qi,r.k?M(r.k):(z||(z=new WeakMap),q(z,e,r,t))}if(K(e)){if(e.k)return f(e.k);z||(z=new WeakMap);return q(z,e,e,t,!0)}return e},G=(e,t)=>{if(V(e)){let r=e.export({format:"jwk"});return r.k?M(r.k):(F||(F=new WeakMap),q(F,e,r,t))}if(K(e)){if(e.k)return f(e.k);F||(F=new WeakMap);return q(F,e,e,t,!0)}return e};async function X(e,t,r){if("sign"===r&&(t=await G(t,e)),"verify"===r&&(t=await B(t,e)),i(t))return N(t,e,r),t;if(t instanceof Uint8Array){if(!e.startsWith("HS"))throw new TypeError(d(t,...m));return s.subtle.importKey("raw",t,{hash:`SHA-${e.slice(-3)}`,name:"HMAC"},!1,[r])}throw new TypeError(d(t,...m,"Uint8Array","JSON Web Key"))}const Y=async(e,t,r)=>{const n=await X(e,t,"sign");U(e,n);const o=await s.subtle.sign($(e,n.algorithm),n,r);return new Uint8Array(o)},Z=(...e)=>{const t=e.filter(Boolean);if(0===t.length||1===t.length)return!0;let r;for(const e of t){const t=Object.keys(e);if(r&&0!==r.size)for(const e of t){if(r.has(e))return!1;r.add(e)}else r=new Set(t)}return!0},Q=e=>e?.[Symbol.toStringTag],ee=(e,t,r)=>{if(void 0!==t.use&&"sig"!==t.use)throw new TypeError("Invalid key for this operation, when present its use must be sig");if(void 0!==t.key_ops&&!0!==t.key_ops.includes?.(r))throw new TypeError(`Invalid key for this operation, when present its key_ops must include ${r}`);if(void 0!==t.alg&&t.alg!==e)throw new TypeError(`Invalid key for this operation, when present its alg must be ${e}`);return!0},te=(e,t,r,n)=>{if(!(t instanceof Uint8Array)){if(n&&K(t)){if(function(e){return K(e)&&"oct"===e.kty&&"string"==typeof e.k}(t)&&ee(e,t,r))return;throw new TypeError('JSON Web Key for symmetric algorithms must have JWK "kty" (Key Type) equal to "oct" and the JWK "k" (Key Value) present')}if(!y(t))throw new TypeError(l(e,t,...m,"Uint8Array",n?"JSON Web Key":null));if("secret"!==t.type)throw new TypeError(`${Q(t)} instances for symmetric algorithms must be of type "secret"`)}};function re(e,t,r,n){t.startsWith("HS")||"dir"===t||t.startsWith("PBES2")||/^A\d{3}(?:GCM)?KW$/.test(t)?te(t,r,n,e):((e,t,r,n)=>{if(n&&K(t))switch(r){case"sign":if(function(e){return"oct"!==e.kty&&"string"==typeof e.d}(t)&&ee(e,t,r))return;throw new TypeError("JSON Web Key for this operation be a private JWK");case"verify":if(function(e){return"oct"!==e.kty&&void 0===e.d}(t)&&ee(e,t,r))return;throw new TypeError("JSON Web Key for this operation be a public JWK")}if(!y(t))throw new TypeError(l(e,t,...m,n?"JSON Web Key":null));if("secret"===t.type)throw new TypeError(`${Q(t)} instances for asymmetric algorithms must not be of type "secret"`);if("sign"===r&&"public"===t.type)throw new TypeError(`${Q(t)} instances for asymmetric algorithm signing must be of type "private"`);if("decrypt"===r&&"public"===t.type)throw new TypeError(`${Q(t)} instances for asymmetric algorithm decryption must be of type "private"`);if(t.algorithm&&"verify"===r&&"private"===t.type)throw new TypeError(`${Q(t)} instances for asymmetric algorithm verifying must be of type "public"`);if(t.algorithm&&"encrypt"===r&&"private"===t.type)throw new TypeError(`${Q(t)} instances for asymmetric algorithm encryption must be of type "public"`)})(t,r,n,e)}re.bind(void 0,!1);const ne=re.bind(void 0,!0);const oe=function(e,t,r,n,o){if(void 0!==o.crit&&void 0===n?.crit)throw new e('"crit" (Critical) Header Parameter MUST be integrity protected');if(!n||void 0===n.crit)return new Set;if(!Array.isArray(n.crit)||0===n.crit.length||n.crit.some(e=>"string"!=typeof e||0===e.length))throw new e('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');let a;a=void 0!==r?new Map([...Object.entries(r),...t.entries()]):t;for(const t of n.crit){if(!a.has(t))throw new k(`Extension Header Parameter "${t}" is not recognized`);if(void 0===o[t])throw new e(`Extension Header Parameter "${t}" is missing`);if(a.get(t)&&void 0===n[t])throw new e(`Extension Header Parameter "${t}" MUST be integrity protected`)}return new Set(n.crit)};class ae{constructor(e){if(!(e instanceof Uint8Array))throw new TypeError("payload must be an instance of Uint8Array");this._payload=e}setProtectedHeader(e){if(this._protectedHeader)throw new TypeError("setProtectedHeader can only be called once");return this._protectedHeader=e,this}setUnprotectedHeader(e){if(this._unprotectedHeader)throw new TypeError("setUnprotectedHeader can only be called once");return this._unprotectedHeader=e,this}async sign(e,t){if(!this._protectedHeader&&!this._unprotectedHeader)throw new A("either setProtectedHeader or setUnprotectedHeader must be called before #sign()");if(!Z(this._protectedHeader,this._unprotectedHeader))throw new A("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");const r={...this._protectedHeader,...this._unprotectedHeader};let n=!0;if(oe(A,new Map([["b64",!0]]),t?.crit,this._protectedHeader,r).has("b64")&&(n=this._protectedHeader.b64,"boolean"!=typeof n))throw new A('The "b64" (base64url-encode payload) Header Parameter must be a boolean');const{alg:o}=r;if("string"!=typeof o||!o)throw new A('JWS "alg" (Algorithm) Header Parameter missing or invalid');ne(o,e,"sign");let a,s=this._payload;n&&(s=h.encode(p(s))),a=this._protectedHeader?h.encode(p(JSON.stringify(this._protectedHeader))):h.encode("");const i=w(a,h.encode("."),s),c=await Y(o,e,i),d={signature:p(c),payload:""};return n&&(d.payload=u.decode(s)),this._unprotectedHeader&&(d.header=this._unprotectedHeader),this._protectedHeader&&(d.protected=u.decode(a)),d}}class se{constructor(e){this._flattened=new ae(e)}setProtectedHeader(e){return this._flattened.setProtectedHeader(e),this}async sign(e,t){const r=await this._flattened.sign(e,t);if(void 0===r.payload)throw new TypeError("use the flattened module for creating JWS with b64: false");return`${r.protected}.${r.payload}.${r.signature}`}}const ie=e=>Math.floor(e.getTime()/1e3),ce=86400,de=/^(\+|\-)? ?(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)(?: (ago|from now))?$/i,le=e=>{const t=de.exec(e);if(!t||t[4]&&t[1])throw new TypeError("Invalid time period format");const r=parseFloat(t[2]);let n;switch(t[3].toLowerCase()){case"sec":case"secs":case"second":case"seconds":case"s":n=Math.round(r);break;case"minute":case"minutes":case"min":case"mins":case"m":n=Math.round(60*r);break;case"hour":case"hours":case"hr":case"hrs":case"h":n=Math.round(3600*r);break;case"day":case"days":case"d":n=Math.round(r*ce);break;case"week":case"weeks":case"w":n=Math.round(604800*r);break;default:n=Math.round(31557600*r)}return"-"===t[1]||"ago"===t[4]?-n:n};function he(e,t){if(!Number.isFinite(t))throw new TypeError(`Invalid ${e} input`);return t}class ue{constructor(e={}){if(!J(e))throw new TypeError("JWT Claims Set MUST be an object");this._payload=e}setIssuer(e){return this._payload={...this._payload,iss:e},this}setSubject(e){return this._payload={...this._payload,sub:e},this}setAudience(e){return this._payload={...this._payload,aud:e},this}setJti(e){return this._payload={...this._payload,jti:e},this}setNotBefore(e){return"number"==typeof e?this._payload={...this._payload,nbf:he("setNotBefore",e)}:e instanceof Date?this._payload={...this._payload,nbf:he("setNotBefore",ie(e))}:this._payload={...this._payload,nbf:ie(new Date)+le(e)},this}setExpirationTime(e){return"number"==typeof e?this._payload={...this._payload,exp:he("setExpirationTime",e)}:e instanceof Date?this._payload={...this._payload,exp:he("setExpirationTime",ie(e))}:this._payload={...this._payload,exp:ie(new Date)+le(e)},this}setIssuedAt(e){return void 0===e?this._payload={...this._payload,iat:ie(new Date)}:e instanceof Date?this._payload={...this._payload,iat:he("setIssuedAt",ie(e))}:this._payload="string"==typeof e?{...this._payload,iat:he("setIssuedAt",ie(new Date)+le(e))}:{...this._payload,iat:he("setIssuedAt",e)},this}}class we extends ue{setProtectedHeader(e){return this._protectedHeader=e,this}async sign(e,t){const r=new se(h.encode(JSON.stringify(this._payload)));if(r.setProtectedHeader(this._protectedHeader),Array.isArray(this._protectedHeader?.crit)&&this._protectedHeader.crit.includes("b64")&&!1===this._protectedHeader.b64)throw new I("JWTs MUST NOT use unencoded payload");return r.sign(e,t)}}const pe=async(e,t,r)=>{let n,o,a=!1;"function"==typeof AbortController&&(n=new AbortController,o=setTimeout(()=>{a=!0,n.abort()},t));const s=await fetch(e.href,{signal:n?n.signal:void 0,redirect:"manual",headers:r.headers}).catch(e=>{if(a)throw new R;throw e});if(void 0!==o&&clearTimeout(o),200!==s.status)throw new _("Expected 200 OK from the JSON Web Key Set HTTP response");try{return await s.json()}catch{throw new _("Failed to parse the JSON Web Key Set HTTP response as JSON")}};async function fe(e,t){if(!J(e))throw new TypeError("JWK must be an object");switch(t||(t=e.alg),e.kty){case"oct":if("string"!=typeof e.k||!e.k)throw new TypeError('missing "k" (Key Value) Parameter value');return f(e.k);case"RSA":if("oth"in e&&void 0!==e.oth)throw new k('RSA JWK "oth" (Other Primes Info) Parameter value is not supported');case"EC":case"OKP":return j({...e,alg:t});default:throw new k('Unsupported "kty" (Key Type) Parameter value')}}function ye(e){return J(e)}function me(e){return"function"==typeof structuredClone?structuredClone(e):JSON.parse(JSON.stringify(e))}class ge{constructor(e){if(this._cached=new WeakMap,!function(e){return e&&"object"==typeof e&&Array.isArray(e.keys)&&e.keys.every(ye)}(e))throw new T("JSON Web Key Set malformed");this._jwks=me(e)}async getKey(e,t){const{alg:r,kid:n}={...e,...t?.header},o=function(e){switch("string"==typeof e&&e.slice(0,2)){case"RS":case"PS":return"RSA";case"ES":return"EC";case"Ed":return"OKP";default:throw new k('Unsupported "alg" value for a JSON Web Key Set')}}(r),a=this._jwks.keys.filter(e=>{let t=o===e.kty;if(t&&"string"==typeof n&&(t=n===e.kid),t&&"string"==typeof e.alg&&(t=r===e.alg),t&&"string"==typeof e.use&&(t="sig"===e.use),t&&Array.isArray(e.key_ops)&&(t=e.key_ops.includes("verify")),t)switch(r){case"ES256":t="P-256"===e.crv;break;case"ES256K":t="secp256k1"===e.crv;break;case"ES384":t="P-384"===e.crv;break;case"ES512":t="P-521"===e.crv;break;case"Ed25519":t="Ed25519"===e.crv;break;case"EdDSA":t="Ed25519"===e.crv||"Ed448"===e.crv}return t}),{0:s,length:i}=a;if(0===i)throw new x;if(1!==i){const e=new C,{_cached:t}=this;throw e[Symbol.asyncIterator]=async function*(){for(const e of a)try{yield await be(t,e,r)}catch{}},e}return be(this._cached,s,r)}}async function be(e,t,r){const n=e.get(t)||e.set(t,{}).get(t);if(void 0===n[r]){const e=await fe({...t,ext:!0},r);if(e instanceof Uint8Array||"public"!==e.type)throw new T("JSON Web Key Set members must be public keys");n[r]=e}return n[r]}function _e(e){const t=new ge(e),r=async(e,r)=>t.getKey(e,r);return Object.defineProperties(r,{jwks:{value:()=>me(t._jwks),enumerable:!0,configurable:!1,writable:!1}}),r}let Se;if("undefined"==typeof navigator||!navigator.userAgent?.startsWith?.("Mozilla/5.0 ")){Se=`${"jose"}/${"v5.10.0"}`}const Ee=Symbol();class ve{constructor(e,t){if(!(e instanceof URL))throw new TypeError("url must be an instance of URL");var r,n;this._url=new URL(e.href),this._options={agent:t?.agent,headers:t?.headers},this._timeoutDuration="number"==typeof t?.timeoutDuration?t?.timeoutDuration:5e3,this._cooldownDuration="number"==typeof t?.cooldownDuration?t?.cooldownDuration:3e4,this._cacheMaxAge="number"==typeof t?.cacheMaxAge?t?.cacheMaxAge:6e5,void 0!==t?.[Ee]&&(this._cache=t?.[Ee],r=t?.[Ee],n=this._cacheMaxAge,"object"==typeof r&&null!==r&&"uat"in r&&"number"==typeof r.uat&&!(Date.now()-r.uat>=n)&&"jwks"in r&&J(r.jwks)&&Array.isArray(r.jwks.keys)&&Array.prototype.every.call(r.jwks.keys,J)&&(this._jwksTimestamp=this._cache.uat,this._local=_e(this._cache.jwks)))}coolingDown(){return"number"==typeof this._jwksTimestamp&&Date.now()<this._jwksTimestamp+this._cooldownDuration}fresh(){return"number"==typeof this._jwksTimestamp&&Date.now()<this._jwksTimestamp+this._cacheMaxAge}async getKey(e,t){this._local&&this.fresh()||await this.reload();try{return await this._local(e,t)}catch(r){if(r instanceof x&&!1===this.coolingDown())return await this.reload(),this._local(e,t);throw r}}async reload(){this._pendingFetch&&("undefined"!=typeof WebSocketPair||"undefined"!=typeof navigator&&"Cloudflare-Workers"===navigator.userAgent||"undefined"!=typeof EdgeRuntime&&"vercel"===EdgeRuntime)&&(this._pendingFetch=void 0);const e=new Headers(this._options.headers);Se&&!e.has("User-Agent")&&(e.set("User-Agent",Se),this._options.headers=Object.fromEntries(e.entries())),this._pendingFetch||(this._pendingFetch=pe(this._url,this._timeoutDuration,this._options).then(e=>{this._local=_e(e),this._cache&&(this._cache.uat=Date.now(),this._cache.jwks=e),this._jwksTimestamp=Date.now(),this._pendingFetch=void 0}).catch(e=>{throw this._pendingFetch=void 0,e})),await this._pendingFetch}}const ke=async(e,t,r,n)=>{const o=await X(e,t,"verify");U(e,o);const a=$(e,o.algorithm);try{return await s.subtle.verify(a,o,r,n)}catch{return!1}},Ae=(e,t)=>{if(void 0!==t&&(!Array.isArray(t)||t.some(e=>"string"!=typeof e)))throw new TypeError(`"${e}" option must be an array of strings`);if(t)return new Set(t)};async function Ie(e,t,r){if(e instanceof Uint8Array&&(e=u.decode(e)),"string"!=typeof e)throw new A("Compact JWS must be a string or Uint8Array");const{0:n,1:o,2:a,length:s}=e.split(".");if(3!==s)throw new A("Invalid Compact JWS");const i=await async function(e,t,r){if(!J(e))throw new A("Flattened JWS must be an object");if(void 0===e.protected&&void 0===e.header)throw new A('Flattened JWS must have either of the "protected" or "header" members');if(void 0!==e.protected&&"string"!=typeof e.protected)throw new A("JWS Protected Header incorrect type");if(void 0===e.payload)throw new A("JWS Payload missing");if("string"!=typeof e.signature)throw new A("JWS Signature missing or incorrect type");if(void 0!==e.header&&!J(e.header))throw new A("JWS Unprotected Header incorrect type");let n={};if(e.protected)try{const t=f(e.protected);n=JSON.parse(u.decode(t))}catch{throw new A("JWS Protected Header is invalid")}if(!Z(n,e.header))throw new A("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");const o={...n,...e.header};let a=!0;if(oe(A,new Map([["b64",!0]]),r?.crit,n,o).has("b64")&&(a=n.b64,"boolean"!=typeof a))throw new A('The "b64" (base64url-encode payload) Header Parameter must be a boolean');const{alg:s}=o;if("string"!=typeof s||!s)throw new A('JWS "alg" (Algorithm) Header Parameter missing or invalid');const i=r&&Ae("algorithms",r.algorithms);if(i&&!i.has(s))throw new v('"alg" (Algorithm) Header Parameter value not allowed');if(a){if("string"!=typeof e.payload)throw new A("JWS Payload must be a string")}else if("string"!=typeof e.payload&&!(e.payload instanceof Uint8Array))throw new A("JWS Payload must be a string or an Uint8Array instance");let c=!1;"function"==typeof t?(t=await t(n,e),c=!0,ne(s,t,"verify"),K(t)&&(t=await fe(t,s))):ne(s,t,"verify");const d=w(h.encode(e.protected??""),h.encode("."),"string"==typeof e.payload?h.encode(e.payload):e.payload);let l,p;try{l=f(e.signature)}catch{throw new A("Failed to base64url decode the signature")}if(!await ke(s,t,l,d))throw new W;if(a)try{p=f(e.payload)}catch{throw new A("Failed to base64url decode the payload")}else p="string"==typeof e.payload?h.encode(e.payload):e.payload;const y={payload:p};return void 0!==e.protected&&(y.protectedHeader=n),void 0!==e.header&&(y.unprotectedHeader=e.header),c?{...y,key:t}:y}({payload:o,protected:n,signature:a},t,r),c={payload:i.payload,protectedHeader:i.protectedHeader};return"function"==typeof t?{...c,key:i.key}:c}const Pe=e=>e.toLowerCase().replace(/^application\//,""),Te=(e,t,r={})=>{let n;try{n=JSON.parse(u.decode(t))}catch{}if(!J(n))throw new I("JWT Claims Set must be a top-level JSON object");const{typ:o}=r;if(o&&("string"!=typeof e.typ||Pe(e.typ)!==Pe(o)))throw new S('unexpected "typ" JWT header value',n,"typ","check_failed");const{requiredClaims:a=[],issuer:s,subject:i,audience:c,maxTokenAge:d}=r,l=[...a];void 0!==d&&l.push("iat"),void 0!==c&&l.push("aud"),void 0!==i&&l.push("sub"),void 0!==s&&l.push("iss");for(const e of new Set(l.reverse()))if(!(e in n))throw new S(`missing required "${e}" claim`,n,e,"missing");if(s&&!(Array.isArray(s)?s:[s]).includes(n.iss))throw new S('unexpected "iss" claim value',n,"iss","check_failed");if(i&&n.sub!==i)throw new S('unexpected "sub" claim value',n,"sub","check_failed");if(c&&(h=n.aud,w="string"==typeof c?[c]:c,!("string"==typeof h?w.includes(h):Array.isArray(h)&&w.some(Set.prototype.has.bind(new Set(h))))))throw new S('unexpected "aud" claim value',n,"aud","check_failed");var h,w;let p;switch(typeof r.clockTolerance){case"string":p=le(r.clockTolerance);break;case"number":p=r.clockTolerance;break;case"undefined":p=0;break;default:throw new TypeError("Invalid clockTolerance option type")}const{currentDate:f}=r,y=ie(f||new Date);if((void 0!==n.iat||d)&&"number"!=typeof n.iat)throw new S('"iat" claim must be a number',n,"iat","invalid");if(void 0!==n.nbf){if("number"!=typeof n.nbf)throw new S('"nbf" claim must be a number',n,"nbf","invalid");if(n.nbf>y+p)throw new S('"nbf" claim timestamp check failed',n,"nbf","check_failed")}if(void 0!==n.exp){if("number"!=typeof n.exp)throw new S('"exp" claim must be a number',n,"exp","invalid");if(n.exp<=y-p)throw new E('"exp" claim timestamp check failed',n,"exp","check_failed")}if(d){const e=y-n.iat;if(e-p>("number"==typeof d?d:le(d)))throw new E('"iat" claim timestamp check failed (too far in the past)',n,"iat","check_failed");if(e<0-p)throw new S('"iat" claim timestamp check failed (it should be in the past)',n,"iat","check_failed")}return n};const xe=async(e,t)=>{const r=`SHA-${e.slice(-3)}`;return new Uint8Array(await s.subtle.digest(r,t))},Ce=(e,t)=>{if("string"!=typeof e||!e)throw new P(`${t} missing or invalid`)};async function Re(e,t){if(!J(e))throw new TypeError("JWK must be an object");if(t??(t="sha256"),"sha256"!==t&&"sha384"!==t&&"sha512"!==t)throw new TypeError('digestAlgorithm must one of "sha256", "sha384", or "sha512"');let r;switch(e.kty){case"EC":Ce(e.crv,'"crv" (Curve) Parameter'),Ce(e.x,'"x" (X Coordinate) Parameter'),Ce(e.y,'"y" (Y Coordinate) Parameter'),r={crv:e.crv,kty:e.kty,x:e.x,y:e.y};break;case"OKP":Ce(e.crv,'"crv" (Subtype of Key Pair) Parameter'),Ce(e.x,'"x" (Public Key) Parameter'),r={crv:e.crv,kty:e.kty,x:e.x};break;case"RSA":Ce(e.e,'"e" (Exponent) Parameter'),Ce(e.n,'"n" (Modulus) Parameter'),r={e:e.e,kty:e.kty,n:e.n};break;case"oct":Ce(e.k,'"k" (Key Value) Parameter'),r={k:e.k,kty:e.kty};break;default:throw new k('"kty" (Key Type) Parameter missing or unsupported')}const n=h.encode(JSON.stringify(r));return p(await xe(t,n))}function We(e){const t=e?.modulusLength??2048;if("number"!=typeof t||t<2048)throw new k("Invalid or unsupported modulusLength option provided, 2048 bits or larger keys must be used");return t}async function $e(e,t){return async function(e,t){let r,n;switch(e){case"PS256":case"PS384":case"PS512":r={name:"RSA-PSS",hash:`SHA-${e.slice(-3)}`,publicExponent:new Uint8Array([1,0,1]),modulusLength:We(t)},n=["sign","verify"];break;case"RS256":case"RS384":case"RS512":r={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${e.slice(-3)}`,publicExponent:new Uint8Array([1,0,1]),modulusLength:We(t)},n=["sign","verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":r={name:"RSA-OAEP",hash:`SHA-${parseInt(e.slice(-3),10)||1}`,publicExponent:new Uint8Array([1,0,1]),modulusLength:We(t)},n=["decrypt","unwrapKey","encrypt","wrapKey"];break;case"ES256":r={name:"ECDSA",namedCurve:"P-256"},n=["sign","verify"];break;case"ES384":r={name:"ECDSA",namedCurve:"P-384"},n=["sign","verify"];break;case"ES512":r={name:"ECDSA",namedCurve:"P-521"},n=["sign","verify"];break;case"Ed25519":r={name:"Ed25519"},n=["sign","verify"];break;case"EdDSA":{n=["sign","verify"];const e=t?.crv??"Ed25519";switch(e){case"Ed25519":case"Ed448":r={name:e};break;default:throw new k("Invalid or unsupported crv option provided")}break}case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{n=["deriveKey","deriveBits"];const e=t?.crv??"P-256";switch(e){case"P-256":case"P-384":case"P-521":r={name:"ECDH",namedCurve:e};break;case"X25519":case"X448":r={name:e};break;default:throw new k("Invalid or unsupported crv option provided, supported values are P-256, P-384, P-521, X25519, and X448")}break}default:throw new k('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}return s.subtle.generateKey(r,t?.extractable??!1,n)}(e,t)}const Ue=f;
/**
 * solid-oidc.js - Minimal Solid-OIDC client for browsers
 *
 * A zero-build, single-file Solid-OIDC authentication library.
 *
 * @license MIT
 * @author JavaScriptSolidServer
 * @see https://github.com/JavaScriptSolidServer/solid-oidc
 *
 * Based on solid-oidc-client-browser by uvdsl (Christoph Braun)
 * @see https://github.com/uvdsl/solid-oidc-client-browser
 *
 * Implements:
 * - RFC 6749 - OAuth 2.0
 * - RFC 7636 - PKCE
 * - RFC 9207 - OAuth 2.0 Authorization Server Issuer Identification
 * - RFC 9449 - DPoP (Demonstration of Proof-of-Possession)
 * - Solid-OIDC Specification
 */
const De="sessionStateChange",Oe="sessionExpirationWarning",He="sessionExpiration";class Le{constructor(e="solid-oidc",t="session",r=1){this.dbName=e,this.storeName=t,this.dbVersion=r,this.db=null}async init(){return new Promise((e,t)=>{const r=indexedDB.open(this.dbName,this.dbVersion);r.onerror=()=>t(new Error(`Database error: ${r.error}`)),r.onsuccess=()=>{this.db=r.result,e(this)},r.onupgradeneeded=e=>{const t=e.target.result;t.objectStoreNames.contains(this.storeName)||t.createObjectStore(this.storeName)}})}async setItem(e,t){return this.db||await this.init(),new Promise((r,n)=>{const o=this.db.transaction(this.storeName,"readwrite");o.oncomplete=()=>r(),o.onerror=()=>n(new Error(`Transaction error: ${o.error}`)),o.objectStore(this.storeName).put(t,e)})}async getItem(e){return this.db||await this.init(),new Promise((t,r)=>{const n=this.db.transaction(this.storeName,"readonly");n.onerror=()=>r(new Error(`Transaction error: ${n.error}`));const o=n.objectStore(this.storeName).get(e);o.onsuccess=()=>t(o.result||null)})}async deleteItem(e){return this.db||await this.init(),new Promise((t,r)=>{const n=this.db.transaction(this.storeName,"readwrite");n.oncomplete=()=>t(),n.onerror=()=>r(new Error(`Transaction error: ${n.error}`)),n.objectStore(this.storeName).delete(e)})}async clear(){return this.db||await this.init(),new Promise((e,t)=>{const r=this.db.transaction(this.storeName,"readwrite");r.oncomplete=()=>e(),r.onerror=()=>t(new Error(`Transaction error: ${r.error}`)),r.objectStore(this.storeName).clear()})}close(){this.db&&(this.db.close(),this.db=null)}}async function Ne(e,t,r,n=null){const o=await b(e.publicKey),a={htu:t,htm:r};return n&&(a.ath=n),new we(a).setIssuedAt().setJti(crypto.randomUUID()).setProtectedHeader({alg:"ES256",typ:"dpop+jwt",jwk:o}).sign(e.privateKey)}async function Je(e,t,r){const n=await Ne(r,e,"POST"),o=await fetch(e,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",DPoP:n},body:new URLSearchParams(t)});if(!o.ok)throw new Error(`Token request failed: ${o.status}`);return o.json()}async function Ke(e,t,r,n,o){const a=function(e,t){const r=new ve(e,t),n=async(e,t)=>r.getKey(e,t);return Object.defineProperties(n,{coolingDown:{get:()=>r.coolingDown(),enumerable:!0,configurable:!1},fresh:{get:()=>r.fresh(),enumerable:!0,configurable:!1},reload:{value:()=>r.reload(),enumerable:!0,configurable:!1,writable:!1},reloading:{get:()=>!!r._pendingFetch,enumerable:!0,configurable:!1},jwks:{value:()=>r._local?.jwks(),enumerable:!0,configurable:!1,writable:!1}}),n}(new URL(t)),{payload:s}=await async function(e,t,r){const n=await Ie(e,t,r);if(n.protectedHeader.crit?.includes("b64")&&!1===n.protectedHeader.b64)throw new I("JWTs MUST NOT use unencoded payload");const o={payload:Te(n.protectedHeader,n.payload,r),protectedHeader:n.protectedHeader};return"function"==typeof t?{...o,key:n.key}:o}(e,a,{issuer:r,audience:"solid"}),i=await Re(await b(o.publicKey));if(s.cnf?.jkt!==i)throw new Error("DPoP thumbprint mismatch");if(s.client_id!==n)throw new Error("client_id mismatch");return s}class je extends EventTarget{constructor(e={}){super(),this.clientId=e.clientId||null,this.database=e.database||new Le,this.onStateChange=e.onStateChange||null,this.onExpirationWarning=e.onExpirationWarning||null,this.onExpiration=e.onExpiration||null,this._isActive=!1,this._webId=null,this._exp=null,this._ath=null,this._tokens=null,this._idpDetails=null,this._refreshPromise=null,this.onStateChange&&this.addEventListener(De,this.onStateChange),this.onExpirationWarning&&this.addEventListener(Oe,this.onExpirationWarning),this.onExpiration&&this.addEventListener(He,this.onExpiration)}get isActive(){return this._isActive}get webId(){return this._webId}isExpired(){return!this._exp||Math.floor(Date.now()/1e3)>=this._exp}getExpiresIn(){return this._exp?this._exp-Math.floor(Date.now()/1e3):-1}async login(e,t){const r=new URL(t),n=r.origin+r.pathname+r.search,o=await async function(e){const t=new URL(e).origin,r=await fetch(`${t}/.well-known/openid-configuration`);if(!r.ok)throw new Error(`OIDC discovery failed: ${r.status}`);return r.json()}(e),a=o.issuer,s=e=>e.endsWith("/")?e.slice(0,-1):e;if(s(e)!==s(a))throw new Error(`Issuer mismatch: ${a} !== ${e}`);sessionStorage.setItem("solid_oidc_idp",a),sessionStorage.setItem("solid_oidc_token_endpoint",o.token_endpoint),sessionStorage.setItem("solid_oidc_jwks_uri",o.jwks_uri);let i=this.clientId;if(!i){i=(await async function(e,t){const r=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({application_type:"web",redirect_uris:t,token_endpoint_auth_method:"none",grant_types:["authorization_code","refresh_token"],response_types:["code"],scope:"openid offline_access webid"})});if(!r.ok)throw new Error(`Client registration failed: ${r.status}`);return r.json()}(o.registration_endpoint,[n])).client_id,sessionStorage.setItem("solid_oidc_client_id",i)}const c=await async function(){const e=crypto.randomUUID()+"-"+crypto.randomUUID(),t=new Uint8Array(await crypto.subtle.digest("SHA-256",(new TextEncoder).encode(e)));return{verifier:e,challenge:btoa(String.fromCharCode(...t)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}}();sessionStorage.setItem("solid_oidc_pkce_verifier",c.verifier);const d=crypto.randomUUID();sessionStorage.setItem("solid_oidc_csrf",d);const l=new URL(o.authorization_endpoint);l.searchParams.set("response_type","code"),l.searchParams.set("redirect_uri",n),l.searchParams.set("scope","openid offline_access webid"),l.searchParams.set("client_id",i),l.searchParams.set("code_challenge_method","S256"),l.searchParams.set("code_challenge",c.challenge),l.searchParams.set("state",d),l.searchParams.set("prompt","consent"),window.location.href=l.toString()}async handleRedirectFromLogin(){const e=new URL(window.location.href),t=e.searchParams.get("code");if(!t)return;const r=sessionStorage.getItem("solid_oidc_idp"),n=e.searchParams.get("iss");if(!r||n!==r)throw new Error(`Issuer mismatch: ${n} !== ${r}`);const o=sessionStorage.getItem("solid_oidc_csrf");if(e.searchParams.get("state")!==o)throw new Error("CSRF token mismatch");e.searchParams.delete("code"),e.searchParams.delete("iss"),e.searchParams.delete("state"),window.history.replaceState({},document.title,e.toString());const a=sessionStorage.getItem("solid_oidc_pkce_verifier"),s=sessionStorage.getItem("solid_oidc_token_endpoint"),i=sessionStorage.getItem("solid_oidc_jwks_uri"),c=this.clientId||sessionStorage.getItem("solid_oidc_client_id");if(!a||!s||!c)throw new Error("Missing session data");const d=await $e("ES256"),l=await Je(s,{grant_type:"authorization_code",code:t,code_verifier:a,redirect_uri:e.origin+e.pathname,client_id:c},d);await Ke(l.access_token,i,r,c,d),this._idpDetails={idp:r,jwksUri:i,tokenEndpoint:s},await this.database.init(),await Promise.all([this.database.setItem("idp",r),this.database.setItem("jwks_uri",i),this.database.setItem("token_endpoint",s),this.database.setItem("client_id",c),this.database.setItem("dpop_keypair",d),this.database.setItem("refresh_token",l.refresh_token)]),this.database.close(),sessionStorage.removeItem("solid_oidc_idp"),sessionStorage.removeItem("solid_oidc_token_endpoint"),sessionStorage.removeItem("solid_oidc_jwks_uri"),sessionStorage.removeItem("solid_oidc_client_id"),sessionStorage.removeItem("solid_oidc_pkce_verifier"),sessionStorage.removeItem("solid_oidc_csrf"),await this._setTokens({...l,dpop_key_pair:d}),this._dispatchStateChange()}async restore(){return this._refreshPromise||(this._refreshPromise=(async()=>{try{const e=await async function(e){await e.init();const[t,r,n,o]=await Promise.all([e.getItem("refresh_token"),e.getItem("token_endpoint"),e.getItem("client_id"),e.getItem("dpop_keypair")]);if(!(t&&r&&n&&o))throw new Error("Missing refresh data");const a=await Je(r,{grant_type:"refresh_token",refresh_token:t,client_id:n},o);return a.refresh_token&&await e.setItem("refresh_token",a.refresh_token),e.close(),{...a,dpop_key_pair:o}}(this.database);await this._setTokens(e),this._dispatchStateChange()}catch(e){throw this._isActive&&(this.isExpired()?this._dispatchExpiration():this._dispatchExpirationWarning()),e}finally{this._refreshPromise=null}})()),this._refreshPromise}async logout(){this._isActive=!1,this._webId=null,this._exp=null,this._ath=null,this._tokens=null,this._idpDetails=null,await this.database.init(),await this.database.clear(),this.database.close(),this._dispatchStateChange()}async authFetch(e,t={}){if(!this._isActive)return fetch(e,t);let r,n,o;this.isExpired()&&await this.restore(),e instanceof Request?(r=new URL(e.url),n=t.method||e.method||"GET",o=new Headers(e.headers)):(r=new URL(e.toString()),n=t.method||"GET",o=t.headers?new Headers(t.headers):new Headers);const a=await Ne(this._tokens.dpop_key_pair,`${r.origin}${r.pathname}`,n.toUpperCase(),this._ath);return o.set("DPoP",a),o.set("Authorization",`DPoP ${this._tokens.access_token}`),e instanceof Request?fetch(new Request(e,{...t,headers:o})):fetch(r,{...t,headers:o})}async _setTokens(e){this._tokens=e;const t=function(e){if("string"!=typeof e)throw new I("JWTs must use Compact JWS serialization, JWT must be a string");const{1:t,length:r}=e.split(".");if(5===r)throw new I("Only JWTs using Compact JWS serialization can be decoded");if(3!==r)throw new I("Invalid JWT");if(!t)throw new I("JWTs must contain a payload");let n,o;try{n=Ue(t)}catch{throw new I("Failed to base64url decode the payload")}try{o=JSON.parse(u.decode(n))}catch{throw new I("Failed to parse the decoded payload as JSON")}if(!J(o))throw new I("Invalid JWT Claims Set");return o}(e.access_token);if(!t.webid)throw new Error("Missing webid claim");if(!t.exp)throw new Error("Missing exp claim");this._ath=await async function(e){const t=(new TextEncoder).encode(e),r=await crypto.subtle.digest("SHA-256",t),n=Array.from(new Uint8Array(r));return btoa(String.fromCharCode(...n)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}(e.access_token),this._webId=t.webid,this._exp=t.exp,this._isActive=!0}_dispatchStateChange(){this.dispatchEvent(new CustomEvent(De,{detail:{isActive:this._isActive,webId:this._webId}}))}_dispatchExpirationWarning(){this.dispatchEvent(new CustomEvent(Oe,{detail:{expires_in:this.getExpiresIn()}}))}_dispatchExpiration(){this.dispatchEvent(new CustomEvent(He))}}const Me="sessionRestore",Fe="login",ze="logout",Ve="sessionExpired",qe="error";class Be{constructor(){this.listeners=new Map}on(e,t){this.listeners.has(e)||this.listeners.set(e,new Set),this.listeners.get(e).add(t)}off(e,t){var r;null===(r=this.listeners.get(e))||void 0===r||r.delete(t)}emit(e,...t){var r;null===(r=this.listeners.get(e))||void 0===r||r.forEach(e=>e(...t))}}class Ge{constructor(e){this._session=new je({clientId:null==e?void 0:e.clientId,database:new Le,onStateChange:e=>{const t=e.detail;(null==t?void 0:t.isActive)?(this._events.emit(Fe),this._events.emit(Me,window.location.href)):this._events.emit(ze)},onExpiration:()=>{this._events.emit(Ve)}}),this._events=new Be,this._sessionId=crypto.randomUUID()}get events(){return this._events}get info(){var e;return{isLoggedIn:this._session.isActive,webId:null!==(e=this._session.webId)&&void 0!==e?e:void 0,sessionId:this._sessionId,expirationDate:this._session.isActive?Date.now()+1e3*this._session.getExpiresIn():void 0}}async handleIncomingRedirect(e){const t="string"==typeof e?{url:e}:null!=e?e:{};try{if(await this._session.handleRedirectFromLogin(),!this._session.isActive&&!1!==t.restorePreviousSession)try{await this._session.restore()}catch{}return this.info}catch(e){return void this._events.emit(qe,e)}}async login(e){const t=e.redirectUrl||window.location.href;await this._session.login(e.oidcIssuer,t)}async logout(){await this._session.logout()}async fetch(e,t){return this._session.authFetch(e,t)}}const Xe=new Ge,Ye=e;var Ze=n(386);const Qe=n.n(Ze)()(Ye),et=(0,Ye.sym)("http://www.iana.org/assignments/link-relations/acl");function tt(e){const t=Qe;function r(e,r,n,o={}){const a=o.public||[],s=(0,Ye.graph)(),i=(0,Ye.Namespace)("http://www.w3.org/ns/auth/acl#");let c=s.sym(`${n}#a1`);const d=s.sym(n),l=s.sym(e);if(s.add(c,t.rdf("type"),i("Authorization"),d),s.add(c,i("accessTo"),l,d),o.defaultForNew&&s.add(c,i("default"),l,d),s.add(c,i("agent"),r,d),s.add(c,i("mode"),i("Read"),d),s.add(c,i("mode"),i("Write"),d),s.add(c,i("mode"),i("Control"),d),a.length){c=s.sym(`${n}#a2`),s.add(c,t.rdf("type"),i("Authorization"),d),s.add(c,i("accessTo"),l,d),s.add(c,i("agentClass"),t.foaf("Agent"),d);for(let e=0;e<a.length;e++)s.add(c,i("mode"),i(a[e]),d)}return(0,Ye.serialize)(d,s,n)}return{findAclDocUrl:async function(t){await e.fetcher.load(t);const r=e.any(t,et);if(!r)throw new Error(`No ACL link discovered for ${t}`);return r.value},setACLUserPublic:function(t,n,o){const a=e.any(e.sym(t),et);return Promise.resolve().then(()=>a||function(t){const r=e.fetcher;if(!r)throw new Error("Cannot fetch ACL rel, store has no fetcher");return r.load(t).then(r=>{if(!r.ok)throw new Error("fetchACLRel: While loading:"+r.error);const n=e.any(e.sym(t),et);if(!n)throw new Error("fetchACLRel: No Link rel=ACL header for "+t);return n})}(t).catch(e=>{throw new Error(`Error fetching rel=ACL header for ${t}: ${e}`)})).then(a=>{const s=r(t,n,a.uri,o);if(!e.fetcher)throw new Error("Cannot PUT this, store has no fetcher");return e.fetcher.webOperation("PUT",a.uri,{data:s,contentType:"text/turtle"}).then(e=>{if(!e.ok)throw new Error("Error writing ACL text: "+e.error);return a})})},genACLText:r}}const rt=()=>{let{SolidAppContext:e}=window;if(e||(e={}),e.viewingNoAuthPage=!1,e.noAuth&&window.document){if(window.document.location.href.startsWith(e.noAuth)){e.viewingNoAuthPage=!0;const t=new URLSearchParams(window.document.location.search);if(t){let r=e.viewedPage=t.get("uri")||null;if(r&&(r=decodeURI(r),!r.startsWith(e.noAuth))){const t=r.split(/\//);e.idp=t[0]+"//"+t[2],e.viewingNoAuthPage=!1}}}}return e};function nt(){const{$SolidTestEnvironment:e}=window;if(void 0!==e&&e.username)return o("Assuming the user is "+e.username),(0,Ye.sym)(e.username);if("undefined"!=typeof document&&document.location&&"http://localhost"===(""+document.location).slice(0,16)){const e=document.getElementById("appTarget");if(!e)return null;const t=e.getAttribute("testID");return t?(o("Assuming user is "+t),(0,Ye.sym)(t)):null}return null}class ot{constructor(e){this.session=e}get authSession(){return this.session}currentUser(){const e=rt();return e.viewingNoAuthPage?(0,Ye.sym)(e.webId):this&&this.session&&this.session.info&&this.session.info.webId&&this.session.info.isLoggedIn?(0,Ye.sym)(this.session.info.webId):nt()}async checkUser(e){const t=new URL(window.location.href).hash;t&&window.localStorage.setItem("preLoginRedirectHash",t),this.session.events.on(Me,e=>{o(`Session restored to ${e}`),document.location.toString()!==e&&history.replaceState(null,"",e)});const r=new URL(window.location.href);r.hash="",await this.session.handleIncomingRedirect({restorePreviousSession:!0,url:r.href});const n=window.localStorage.getItem("preLoginRedirectHash");if(n){const e=new URL(window.location.href);e.hash!==n&&(history.pushState?history.pushState(null,document.title,n):location.hash=n,e.hash=n),window.localStorage.setItem("preLoginRedirectHash","")}let a=nt();if(a)return Promise.resolve(e?e(a):a);const s=this.webIdFromSession(this.session.info);return s&&(a=this.saveUser(s)),a&&o(`(Logged in as ${a} by authentication)`),Promise.resolve(e?e(a):a)}saveUser(e,t){let r;if(e){r="string"==typeof e?e:e.uri;const n=(0,Ye.namedNode)(r);return t&&(t.me=n),n}return null}webIdFromSession(e){return(null==e?void 0:e.webId)&&e.isLoggedIn?e.webId:null}}function at(e){return(0,Ye.sym)(e.uri+"#id"+Date.now())}function st(e){return!e||`${window.location.origin}/`!==new URL(e.value).origin}const it="index.ttl#this";function ct(e,t){const r=Qe;async function n(t,r,n){await e.fetcher.load(t);const o=e.any(t,new Ye.NamedNode("http://www.iana.org/assignments/link-relations/acl"));if(!o)throw new Error("Chat ACL doc not found!");const a=`\n            @prefix acl: <http://www.w3.org/ns/auth/acl#>.\n            <#owner>\n            a acl:Authorization;\n            acl:agent <${r.value}>;\n            acl:accessTo <.>;\n            acl:default <.>;\n            acl:mode\n                acl:Read, acl:Write, acl:Control.\n            <#invitee>\n            a acl:Authorization;\n            acl:agent <${n.value}>;\n            acl:accessTo <.>;\n            acl:default <.>;\n            acl:mode\n                acl:Read, acl:Append.\n            `;await e.fetcher.webOperation("PUT",o.value,{data:a,contentType:"text/turtle"})}async function o(t,n){const o=e.any(n,r.solid("privateTypeIndex"));if(!o)throw new Error("Private type index not found!");await e.fetcher.load(o);const a=at(o),s=[(0,Ye.st)(a,r.rdf("type"),r.solid("TypeRegistration"),o.doc()),(0,Ye.st)(a,r.solid("forClass"),r.meeting("LongChat"),o.doc()),(0,Ye.st)(a,r.solid("instance"),t,o.doc())];await new Promise((t,r)=>{e.updater.update([],s,function(e,n,o){n?t(null):r(new Error(o))})})}async function a(r){const n=await t.loadMe(),o=function(e,t){const r=new URL(`IndividualChats/${new URL(e.value).host}/`,t.value).toString();return new Ye.NamedNode(r)}(r,await t.getPodRoot(n));let a=!0;try{await e.fetcher.load(new Ye.NamedNode(o.value+"index.ttl#this"))}catch(e){a=!1}return{me:n,chatContainer:o,exists:a}}async function s(e,t){return(await i({me:t,newBase:e.value})).newInstance}function i(t){const n=e,o=n.updater;if(t.me&&!t.me.uri)throw new Error("chat mintNew:  Invalid userid "+t.me);const a=t.newInstance=t.newInstance||n.sym(t.newBase+it),s=a.doc();return n.add(a,r.rdf("type"),r.meeting("LongChat"),s),n.add(a,r.dc("title"),"Chat channel",s),n.add(a,r.dc("created"),(0,Ye.term)(new Date(Date.now())),s),t.me&&n.add(a,r.dc("author"),t.me,s),new Promise(function(e,r){null==o||o.put(s,n.statementsMatching(void 0,void 0,void 0,s),"text/turtle",function(n,o,s){o?e({...t,newInstance:a}):r(new Error("FAILED to save new chat channel at: "+n+" : "+s))})})}async function c(t,n){var o;await e.fetcher.load(t.doc());const a=e.any(t,r.ldp("inbox"),void 0,t.doc());if(!a)throw new Error(`Invitee inbox not found! ${t.value}`);const s=`\n        <> a <http://www.w3.org/ns/pim/meeting#LongChatInvite> ;\n        ${r.rdf("seeAlso")} <${n.value}> .\n        `,i=await(null===(o=e.fetcher)||void 0===o?void 0:o.webOperation("POST",a.value,{data:s,contentType:"text/turtle"}));if(!(null==i?void 0:i.headers.get("location")))throw new Error(`Invite sending returned a ${null==i?void 0:i.status}`)}return{setAcl:n,addToPrivateTypeIndex:o,findChat:a,createChatThing:s,getChat:async function(e,t=!0){const{me:r,chatContainer:i,exists:d}=await a(e);if(d)return new Ye.NamedNode(i.value+it);if(t){const t=await s(i,r);return await c(e,t),await n(i,r,e),await o(t,r),t}return null},sendInvite:c,mintNew:i}}function dt(e,t,r,n,o){return{createInboxFor:async function(e,o){const a=await t.loadMe(),s=`${(await t.getPodRoot(a)).value}p2p-inboxes/${encodeURIComponent(o)}/`;return await n.createContainer(s),await r.setSinglePeerAccess({ownerWebId:a.value,peerWebId:e,accessToModes:"acl:Append",target:s}),s},getNewMessages:async function(e){e||(e=await t.loadMe());const r=await t.getMainInbox(e);return(await n.getContainerMembers(r)).filter(e=>!n.isContainer(e))},markAsRead:async function(t,r){const n=await e.fetcher._fetch(t);if(200!==n.status)throw new Error(`Not OK! ${t}`);const o=function(e,t){const r=t.getUTCFullYear(),n=("0"+(t.getUTCMonth()+1)).slice(-2),o=("0"+t.getUTCDate()).slice(-2),a=e.split("/"),s=a[a.length-1];return new URL(`./archive/${r}/${n}/${o}/${s}`,e).toString()}(t,r),a={method:"PUT",body:await n.text(),headers:[["Content-Type",n.headers.get("Content-Type")||"application/octet-stream"]]};"2"===(await e.fetcher._fetch(o,a)).status.toString()[0]&&await e.fetcher._fetch(t,{method:"DELETE"})}}}class lt extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype),this.name=new.target.name}}class ht extends lt{}class ut extends lt{}class wt extends lt{}class pt extends lt{}class ft extends lt{}class yt extends lt{}class mt extends lt{constructor(e,t){super(t),this.status=e}}function gt(e,t,r){const n=Qe;async function o(t){await s(t);const o=function(e){const t=e.uri.replace("/profile/","/").replace("/public/","/").split("/").slice(0,-1).join("/")+"/Settings/Preferences.ttl";return(0,Ye.sym)(t)}(t);let i;try{i=await r.followOrCreateLink(t,n.space("preferencesFile"),o,t.doc())}catch(e){if(a(`User ${t} has no pointer in profile to preferences file.`),e instanceof ft)throw e;if(e instanceof yt)throw e;if(e instanceof ht)throw e;if(e instanceof ut)throw e;if(e instanceof wt)throw e;if(e instanceof mt)throw e;throw e}try{await e.fetcher.load(i)}catch(e){const r=`Unable to load preference of user ${t}: ${e}`;if(a(r),401===e.response.status)throw new ht;if(403===e.response.status){if(st(i))throw new ut;throw new wt}throw new Error(r)}return i}async function s(t){if(!t)throw new Error("loadProfile: no user given.");try{await e.fetcher.load(t.doc())}catch(e){throw new Error(`Unable to load profile of user ${t}: ${e}`)}return t.doc()}function i(t){return e.any(t,n.space("storage"),void 0,t.doc())}return{loadMe:async function(){const r=t.currentUser();if(null===r)throw new Error("Current user not found! Not logged in?");return await e.fetcher.load(r.doc()),r},getPodRoot:function(e){const t=i(e);if(!t)throw new Error("User pod root not found!");return t},getMainInbox:async function(t){await e.fetcher.load(t);const r=e.any(t,n.ldp("inbox"),void 0,t.doc());if(!r)throw new Error("User main inbox not found!");return r},findStorage:i,loadPreferences:o,loadProfile:s,silencedLoadPreferences:async function(e){try{return await o(e)}catch(e){return}}}}function bt(e,t,r,n){const o=Qe;async function s(t){if(!t)throw new Error("loadTypeIndexesFor: No user given");const s=await r.loadProfile(t),i=l(t);let c;try{c=await n.followOrCreateLink(t,o.solid("publicTypeIndex"),i,s)}catch(e){a(`User ${t} has no pointer in profile to publicTypeIndex file.`)}const d=c?[{label:"public",index:c,agent:t}]:[];let u,w;try{u=await r.silencedLoadPreferences(t)}catch(e){u=null}if(u){const r=h(u);let i;try{i=e.any(t,o.solid("privateTypeIndex"),void 0,s)||await n.followOrCreateLink(t,o.solid("privateTypeIndex"),r,u)}catch(e){a(`User ${t} has no pointer in preference file to privateTypeIndex file.`)}w=i?[{label:"private",index:i,agent:t}]:[]}else w=[];const p=d.concat(w);if(0===p.length)return p;const f=p.map(e=>e.index);try{await e.fetcher.load(f)}catch(e){a("Problems loading type index: ",e)}return p}async function i(t){let n;try{n=await r.silencedLoadPreferences(t)}catch(e){a(`User ${t} has no pointer in profile to preferences file.`)}if(n){const r=e.each(t,o.solid("community"),void 0,n).concat(e.each(t,o.solid("community"),void 0,t.doc()));let a=[];for(const e of r)a=a.concat(await s(e));return a}return[]}async function c(e){return(await s(e)).concat((await i(e)).flat())}async function d(e,t){const r=await c(t);let n=[];for(const t of r){const r=await u(t,e);n=n.concat(r)}return n}function l(e){var t;return(0,Ye.sym)((null===(t=e.doc().dir())||void 0===t?void 0:t.uri)+"publicTypeIndex.ttl")}function h(e){var t;return(0,Ye.sym)((null===(t=e.doc().dir())||void 0===t?void 0:t.uri)+"privateTypeIndex.ttl")}async function u(t,r){const n=t.index,a=[],s=e.statementsMatching(null,o.solid("instance"),null,n).concat(e.statementsMatching(null,o.solid("instanceContainer"),null,n)).map(e=>e.subject);for(const i of s){const s=e.any(i,o.solid("forClass"),null,n);if(!r||s.sameTerm(r)){const r=e.each(i,o.solid("instance"),null,n);for(const e of r)a.push({instance:e,type:s,scope:t});const c=e.each(i,o.solid("instanceContainer"),null,n);for(const r of c)await e.fetcher.load(r),a.push({instance:(0,Ye.sym)(r.value),type:s,scope:t})}}return a}return{registerInTypeIndex:async function(t,r,n){const a=at(r),s=[(0,Ye.st)(a,o.rdf("type"),o.solid("TypeRegistration"),r),(0,Ye.st)(a,o.solid("forClass"),n,r),(0,Ye.st)(a,o.solid("instance"),t,r)];try{await e.updater.update([],s)}catch(e){const n=`Unable to register ${t} in index ${r}: ${e}`;return console.warn(n),null}return a},getRegistrations:function(t,r){return e.each(void 0,o.solid("instance"),t).filter(t=>e.holds(t,o.solid("forClass"),r))},loadTypeIndexesFor:s,loadCommunityTypeIndexes:i,loadAllTypeIndexes:c,getScopedAppInstances:d,getAppInstances:async function(e){const r=t.currentUser();if(!r)throw new Error("getAppInstances: Must be logged in to find apps.");return(await d(e,r)).map(e=>e.instance)},suggestPublicTypeIndex:l,suggestPrivateTypeIndex:h,deleteTypeIndexRegistration:async function(t){const r=e.the(null,o.solid("instance"),t.instance,t.scope.index);if(!r)throw new Error(`deleteTypeIndexRegistration: No registration found for ${t.instance}`);const n=e.statementsMatching(r,null,null,t.scope.index);await e.updater.update(n,[])},getScopedAppsFromIndex:u}}function _t(e,t){o("SolidLogic: Unique instance created.  There should only be one of these.");const r=Ye.graph();Ye.fetcher(r,{fetch:e.fetch}),r.updater=new Ye.UpdateManager(r),r.features=[];const n=new ot(t),s=tt(r),i=function(e){function t(t){return e.statementsMatching(t,(0,Ye.sym)("http://www.w3.org/ns/ldp#contains"),void 0).map(e=>e.object)}function r(e){const t=e.value;return"/"===t.charAt(t.length-1)}return{isContainer:r,createContainer:async function(t){if(!r((0,Ye.sym)(t)))throw new Error(`Not a container URL ${t}`);const n=await e.fetcher._fetch(t,{method:"PUT",headers:{"Content-Type":"text/turtle","If-None-Match":"*",Link:'<http://www.w3.org/ns/ldp#BasicContainer>; rel="type"'},body:" "});if("2"!==n.status.toString()[0])throw new Error(`Not OK: got ${n.status} response while creating container at ${t}`)},getContainerElements:t,getContainerMembers:async function(r){return await e.fetcher.load(r),t(r)}}}(r),c=function(e,t,r){async function n(t){let r;try{r=await e.fetcher.load(t)}catch(r){if(404!==r.response.status){if(401===r.response.status)throw new ht;if(403===r.response.status){if(st(t))throw new ut;throw new wt}const e="createIfNotExists doc load error NOT 404:  "+t+": "+r;throw new mt(r.status,r.message+e)}try{await e.fetcher.webOperation("PUT",t,{data:"",contentType:"text/turtle"})}catch(e){throw new yt("createIfNotExists: PUT FAILED: "+t+": "+e)}await e.fetcher.load(t)}return r}return{recursiveDelete:async function n(a){try{if(r.isContainer(a)){const o=await t.findAclDocUrl(a);await e.fetcher._fetch(o,{method:"DELETE"});const s=await r.getContainerMembers(a);await Promise.all(s.map(e=>n(e)))}const o=a.value;return e.fetcher._fetch(o,{method:"DELETE"})}catch(e){o(`Please manually remove ${a.value} from your system.`,e)}},setSinglePeerAccess:async function(r){let n=["@prefix acl: <http://www.w3.org/ns/auth/acl#>.","",`<#alice> a acl:Authorization;\n  acl:agent <${r.ownerWebId}>;`,`  acl:accessTo <${r.target}>;`,`  acl:default <${r.target}>;`,"  acl:mode acl:Read, acl:Write, acl:Control.",""].join("\n");r.accessToModes&&(n+=["<#bobAccessTo> a acl:Authorization;",`  acl:agent <${r.peerWebId}>;`,`  acl:accessTo <${r.target}>;`,`  acl:mode ${r.accessToModes}.`,""].join("\n")),r.defaultModes&&(n+=["<#bobDefault> a acl:Authorization;",`  acl:agent <${r.peerWebId}>;`,`  acl:default <${r.target}>;`,`  acl:mode ${r.defaultModes}.`,""].join("\n"));const o=await t.findAclDocUrl((0,Ye.sym)(r.target));return e.fetcher._fetch(o,{method:"PUT",body:n,headers:[["Content-Type","text/turtle"]]})},createEmptyRdfDoc:async function(t,r){await e.fetcher.webOperation("PUT",t.uri,{data:`# ${new Date} ${r}\n  `,contentType:"text/turtle"})},followOrCreateLink:async function(t,r,o,s){await e.fetcher.load(s);const i=e.any(t,r,null,s);if(i)return i;if(!e.updater.editable(s)){const e=`followOrCreateLink: cannot edit ${s.value}`;throw a(e),new ft(e)}try{await e.updater.update([],[(0,Ye.st)(t,r,o,s)])}catch(e){throw a(`followOrCreateLink: Error making link in ${s} to ${o}: ${e}`),new yt(e)}try{await n(o)}catch(e){throw a(`followOrCreateLink: Error loading or saving new linked document: ${o}: ${e}`),e}return o},loadOrCreateIfNotExists:n}}(r,s,i),d=gt(r,n,c),l=ct(r,d),h=dt(r,d,c,i),u=bt(r,n,d,c);return o("SolidAuthnLogic initialized"),{store:r,authn:n,acl:s,inbox:h,chat:l,profile:d,typeIndex:u,load:function(e){return r.fetcher.load(e)},updatePromise:function(e,t=[]){return new Promise((n,o)=>{r.updater.update(e,t,function(e,t,r){t?n():o(new Error(r))})})},clearStore:function(){r.statements.slice().forEach(r.remove.bind(r))}}}const St=async(e,t)=>{const r=t&&t.credentials&&"omit"==t.credentials;return Xe.info.webId&&!r?Xe.fetch(e,t):window.fetch(e,t)},Et=Symbol.for("solid-logic-singleton"),vt="undefined"!=typeof window?window:n.g;const kt=(vt[Et]?o("SolidLogic: Using existing global singleton instance."):(o("SolidLogic: Creating new global singleton instance."),vt[Et]=_t({fetch:St},Xe),o("Unique quadstore initialized.")),vt[Et]),At=[{name:"Solid Community",uri:"https://solidcommunity.net"},{name:"Solid Web",uri:"https://solidweb.org"},{name:"Solid Web ME",uri:"https://solidweb.me"},{name:"Inrupt.com",uri:"https://login.inrupt.com"}];function It(){const e=[...At],{host:t,origin:r}=new URL(location.href),n=e.map(({uri:e})=>new URL(e).host);return n.includes(t)||n.some(e=>function(e,t){const r=e.length-t.length-1;return r>0&&"."===e[r]&&e.endsWith(t)}(t,e))||e.unshift({name:t,uri:r}),e}const Pt=kt.authn,Tt=kt.authn.authSession,xt=kt.store;export{et as ACL_LINK,ut as CrossOriginForbiddenError,mt as FetchError,ft as NotEditableError,pt as NotFoundError,wt as SameOriginForbiddenError,ht as UnauthorizedError,yt as WebOperationError,rt as appContext,Tt as authSession,Pt as authn,bt as createTypeIndexLogic,It as getSuggestedIssuers,nt as offlineTestID,kt as solidLogicSingleton,xt as store};
//# sourceMappingURL=solid-logic.esm.min.js.map