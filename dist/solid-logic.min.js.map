{"version":3,"file":"solid-logic.min.js","mappings":"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","sources":["webpack://SolidLogic/webpack/universalModuleDefinition","webpack://SolidLogic/external umd \"$rdf\"","webpack://SolidLogic/./node_modules/solid-namespace/index.js","webpack://SolidLogic/webpack/bootstrap","webpack://SolidLogic/webpack/runtime/compat get default export","webpack://SolidLogic/webpack/runtime/define property getters","webpack://SolidLogic/webpack/runtime/global","webpack://SolidLogic/webpack/runtime/hasOwnProperty shorthand","webpack://SolidLogic/webpack/runtime/make namespace object","webpack://SolidLogic/./src/util/debug.ts","webpack://SolidLogic/./node_modules/solid-oidc/node_modules/jose/dist/browser/runtime/webcrypto.js","webpack://SolidLogic/./node_modules/solid-oidc/node_modules/jose/dist/browser/lib/invalid_key_input.js","webpack://SolidLogic/./node_modules/solid-oidc/node_modules/jose/dist/browser/lib/buffer_utils.js","webpack://SolidLogic/./node_modules/solid-oidc/node_modules/jose/dist/browser/runtime/base64url.js","webpack://SolidLogic/./node_modules/solid-oidc/node_modules/jose/dist/browser/runtime/is_key_like.js","webpack://SolidLogic/./node_modules/solid-oidc/node_modules/jose/dist/browser/runtime/key_to_jwk.js","webpack://SolidLogic/./node_modules/solid-oidc/node_modules/jose/dist/browser/key/export.js","webpack://SolidLogic/./node_modules/solid-oidc/node_modules/jose/dist/browser/util/errors.js","webpack://SolidLogic/./node_modules/solid-oidc/node_modules/jose/dist/browser/runtime/subtle_dsa.js","webpack://SolidLogic/./node_modules/solid-oidc/node_modules/jose/dist/browser/runtime/check_key_length.js","webpack://SolidLogic/./node_modules/solid-oidc/node_modules/jose/dist/browser/lib/crypto_key.js","webpack://SolidLogic/./node_modules/solid-oidc/node_modules/jose/dist/browser/lib/is_object.js","webpack://SolidLogic/./node_modules/solid-oidc/node_modules/jose/dist/browser/lib/is_jwk.js","webpack://SolidLogic/./node_modules/solid-oidc/node_modules/jose/dist/browser/runtime/jwk_to_key.js","webpack://SolidLogic/./node_modules/solid-oidc/node_modules/jose/dist/browser/runtime/normalize_key.js","webpack://SolidLogic/./node_modules/solid-oidc/node_modules/jose/dist/browser/runtime/get_sign_verify_key.js","webpack://SolidLogic/./node_modules/solid-oidc/node_modules/jose/dist/browser/runtime/sign.js","webpack://SolidLogic/./node_modules/solid-oidc/node_modules/jose/dist/browser/lib/is_disjoint.js","webpack://SolidLogic/./node_modules/solid-oidc/node_modules/jose/dist/browser/lib/check_key_type.js","webpack://SolidLogic/./node_modules/solid-oidc/node_modules/jose/dist/browser/lib/validate_crit.js","webpack://SolidLogic/./node_modules/solid-oidc/node_modules/jose/dist/browser/jws/flattened/sign.js","webpack://SolidLogic/./node_modules/solid-oidc/node_modules/jose/dist/browser/jws/compact/sign.js","webpack://SolidLogic/./node_modules/solid-oidc/node_modules/jose/dist/browser/lib/epoch.js","webpack://SolidLogic/./node_modules/solid-oidc/node_modules/jose/dist/browser/lib/secs.js","webpack://SolidLogic/./node_modules/solid-oidc/node_modules/jose/dist/browser/jwt/produce.js","webpack://SolidLogic/./node_modules/solid-oidc/node_modules/jose/dist/browser/jwt/sign.js","webpack://SolidLogic/./node_modules/solid-oidc/node_modules/jose/dist/browser/runtime/fetch_jwks.js","webpack://SolidLogic/./node_modules/solid-oidc/node_modules/jose/dist/browser/key/import.js","webpack://SolidLogic/./node_modules/solid-oidc/node_modules/jose/dist/browser/jwks/local.js","webpack://SolidLogic/./node_modules/solid-oidc/node_modules/jose/dist/browser/jwks/remote.js","webpack://SolidLogic/./node_modules/solid-oidc/node_modules/jose/dist/browser/runtime/verify.js","webpack://SolidLogic/./node_modules/solid-oidc/node_modules/jose/dist/browser/lib/validate_algorithms.js","webpack://SolidLogic/./node_modules/solid-oidc/node_modules/jose/dist/browser/jws/compact/verify.js","webpack://SolidLogic/./node_modules/solid-oidc/node_modules/jose/dist/browser/jws/flattened/verify.js","webpack://SolidLogic/./node_modules/solid-oidc/node_modules/jose/dist/browser/lib/jwt_claims_set.js","webpack://SolidLogic/./node_modules/solid-oidc/node_modules/jose/dist/browser/runtime/digest.js","webpack://SolidLogic/./node_modules/solid-oidc/node_modules/jose/dist/browser/jwk/thumbprint.js","webpack://SolidLogic/./node_modules/solid-oidc/node_modules/jose/dist/browser/runtime/generate.js","webpack://SolidLogic/./node_modules/solid-oidc/node_modules/jose/dist/browser/key/generate_key_pair.js","webpack://SolidLogic/./node_modules/solid-oidc/node_modules/jose/dist/browser/util/base64url.js","webpack://SolidLogic/./node_modules/solid-oidc/solid-oidc.js","webpack://SolidLogic/./node_modules/solid-oidc/node_modules/jose/dist/browser/jwt/verify.js","webpack://SolidLogic/./node_modules/solid-oidc/node_modules/jose/dist/browser/util/decode_jwt.js","webpack://SolidLogic/./src/authSession/solidOidcAdapter.ts","webpack://SolidLogic/./src/authSession/authSession.ts","webpack://SolidLogic/./src/util/ns.ts","webpack://SolidLogic/./src/acl/aclLogic.ts","webpack://SolidLogic/./src/authn/authUtil.ts","webpack://SolidLogic/./src/authn/SolidAuthnLogic.ts","webpack://SolidLogic/./src/util/utils.ts","webpack://SolidLogic/./src/chat/chatLogic.ts","webpack://SolidLogic/./src/inbox/inboxLogic.ts","webpack://SolidLogic/./src/logic/CustomError.ts","webpack://SolidLogic/./src/profile/profileLogic.ts","webpack://SolidLogic/./src/typeIndex/typeIndexLogic.ts","webpack://SolidLogic/./src/logic/solidLogic.ts","webpack://SolidLogic/./src/util/containerLogic.ts","webpack://SolidLogic/./src/util/utilityLogic.ts","webpack://SolidLogic/./src/logic/solidLogicSingleton.ts","webpack://SolidLogic/./src/issuer/issuerLogic.ts","webpack://SolidLogic/./src/index.ts"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"$rdf\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"SolidLogic\", [\"$rdf\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"SolidLogic\"] = factory(require(\"$rdf\"));\n\telse\n\t\troot[\"SolidLogic\"] = factory(root[\"$rdf\"]);\n})(this, (__WEBPACK_EXTERNAL_MODULE__264__) => {\nreturn ","module.exports = __WEBPACK_EXTERNAL_MODULE__264__;","/**\n * Provides a way to access commonly used namespaces\n *\n * Usage:\n *\n *   ```\n *   const $rdf = require('rdflib'); //or any other RDF/JS-compatible library\n *   const ns = require('solid-namespace')($rdf);\n *   const store = $rdf.graph();\n *\n *   let me = ...;\n *   let name = store.any(me, ns.vcard(fn)) || store.any(me, ns.foaf(name));\n *   ```\n * @module vocab\n */\nconst aliases = {\n  acl: 'http://www.w3.org/ns/auth/acl#',\n  arg: 'http://www.w3.org/ns/pim/arg#',\n  as: 'https://www.w3.org/ns/activitystreams#',\n  bookmark: 'http://www.w3.org/2002/01/bookmark#',\n  cal: 'http://www.w3.org/2002/12/cal/ical#',\n  cco: 'http://www.ontologyrepository.com/CommonCoreOntologies/',\n  cert: 'http://www.w3.org/ns/auth/cert#',\n  contact: 'http://www.w3.org/2000/10/swap/pim/contact#',\n  dc: 'http://purl.org/dc/elements/1.1/',\n  dct: 'http://purl.org/dc/terms/',\n  doap: 'http://usefulinc.com/ns/doap#',\n  foaf: 'http://xmlns.com/foaf/0.1/',\n  geo: 'http://www.w3.org/2003/01/geo/wgs84_pos#',\n  gpx: 'http://www.w3.org/ns/pim/gpx#',\n  gr: 'http://purl.org/goodrelations/v1#',\n  http: 'http://www.w3.org/2007/ont/http#',\n  httph: 'http://www.w3.org/2007/ont/httph#',\n  icalTZ: 'http://www.w3.org/2002/12/cal/icaltzd#', // Beware: not cal:\n  ldp: 'http://www.w3.org/ns/ldp#',\n  link: 'http://www.w3.org/2007/ont/link#',\n  log: 'http://www.w3.org/2000/10/swap/log#',\n  meeting: 'http://www.w3.org/ns/pim/meeting#',\n  mo: 'http://purl.org/ontology/mo/',\n  org: 'http://www.w3.org/ns/org#',\n  owl: 'http://www.w3.org/2002/07/owl#',\n  pad: 'http://www.w3.org/ns/pim/pad#',\n  patch: 'http://www.w3.org/ns/pim/patch#',\n  prov: 'http://www.w3.org/ns/prov#',\n  pto: 'http://www.productontology.org/id/',\n  qu: 'http://www.w3.org/2000/10/swap/pim/qif#',\n  trip: 'http://www.w3.org/ns/pim/trip#',\n  rdf: 'http://www.w3.org/1999/02/22-rdf-syntax-ns#',\n  rdfs: 'http://www.w3.org/2000/01/rdf-schema#',\n  rss: 'http://purl.org/rss/1.0/',\n  sched: 'http://www.w3.org/ns/pim/schedule#',\n  schema: 'http://schema.org/', // @@ beware confusion with documents no 303\n  sioc: 'http://rdfs.org/sioc/ns#',\n  skos: 'http://www.w3.org/2004/02/skos/core#',\n  solid: 'http://www.w3.org/ns/solid/terms#',\n  space: 'http://www.w3.org/ns/pim/space#',\n  stat: 'http://www.w3.org/ns/posix/stat#',\n  tab: 'http://www.w3.org/2007/ont/link#',\n  tabont: 'http://www.w3.org/2007/ont/link#',\n  ui: 'http://www.w3.org/ns/ui#',\n  vann: 'http://purl.org/vocab/vann/',\n  vcard: 'http://www.w3.org/2006/vcard/ns#',\n  wf: 'http://www.w3.org/2005/01/wf/flow#',\n  xsd: 'http://www.w3.org/2001/XMLSchema#',\n}\n\n/**\n * @param [rdflib] {RDF} Optional RDF Library (such as rdflib.js or rdf-ext) to inject\n */\nfunction vocab (rdf = { namedNode: u => u }) {\n  const namespaces = {}\n  for (const alias in aliases) {\n    const expansion = aliases[alias]\n    namespaces[alias] = function (localName = '') {\n      return rdf.namedNode(expansion + localName)\n    }\n  };\n\n  return namespaces\n};\n\nmodule.exports = vocab\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","\nexport function log(...args: any[]): void {\n  console.log(...args)\n}\n\nexport function warn(...args: any[]): void {\n  console.warn(...args)\n}\n\nexport function error(...args: any[]): void {\n  console.error(...args)\n}\n\nexport function trace(...args: any[]): void {\n  console.trace(...args)\n}\n","export default crypto;\nexport const isCryptoKey = (key) => key instanceof CryptoKey;\n","function message(msg, actual, ...types) {\n    types = types.filter(Boolean);\n    if (types.length > 2) {\n        const last = types.pop();\n        msg += `one of type ${types.join(', ')}, or ${last}.`;\n    }\n    else if (types.length === 2) {\n        msg += `one of type ${types[0]} or ${types[1]}.`;\n    }\n    else {\n        msg += `of type ${types[0]}.`;\n    }\n    if (actual == null) {\n        msg += ` Received ${actual}`;\n    }\n    else if (typeof actual === 'function' && actual.name) {\n        msg += ` Received function ${actual.name}`;\n    }\n    else if (typeof actual === 'object' && actual != null) {\n        if (actual.constructor?.name) {\n            msg += ` Received an instance of ${actual.constructor.name}`;\n        }\n    }\n    return msg;\n}\nexport default (actual, ...types) => {\n    return message('Key must be ', actual, ...types);\n};\nexport function withAlg(alg, actual, ...types) {\n    return message(`Key for the ${alg} algorithm must be `, actual, ...types);\n}\n","import digest from '../runtime/digest.js';\nexport const encoder = new TextEncoder();\nexport const decoder = new TextDecoder();\nconst MAX_INT32 = 2 ** 32;\nexport function concat(...buffers) {\n    const size = buffers.reduce((acc, { length }) => acc + length, 0);\n    const buf = new Uint8Array(size);\n    let i = 0;\n    for (const buffer of buffers) {\n        buf.set(buffer, i);\n        i += buffer.length;\n    }\n    return buf;\n}\nexport function p2s(alg, p2sInput) {\n    return concat(encoder.encode(alg), new Uint8Array([0]), p2sInput);\n}\nfunction writeUInt32BE(buf, value, offset) {\n    if (value < 0 || value >= MAX_INT32) {\n        throw new RangeError(`value must be >= 0 and <= ${MAX_INT32 - 1}. Received ${value}`);\n    }\n    buf.set([value >>> 24, value >>> 16, value >>> 8, value & 0xff], offset);\n}\nexport function uint64be(value) {\n    const high = Math.floor(value / MAX_INT32);\n    const low = value % MAX_INT32;\n    const buf = new Uint8Array(8);\n    writeUInt32BE(buf, high, 0);\n    writeUInt32BE(buf, low, 4);\n    return buf;\n}\nexport function uint32be(value) {\n    const buf = new Uint8Array(4);\n    writeUInt32BE(buf, value);\n    return buf;\n}\nexport function lengthAndInput(input) {\n    return concat(uint32be(input.length), input);\n}\nexport async function concatKdf(secret, bits, value) {\n    const iterations = Math.ceil((bits >> 3) / 32);\n    const res = new Uint8Array(iterations * 32);\n    for (let iter = 0; iter < iterations; iter++) {\n        const buf = new Uint8Array(4 + secret.length + value.length);\n        buf.set(uint32be(iter + 1));\n        buf.set(secret, 4);\n        buf.set(value, 4 + secret.length);\n        res.set(await digest('sha256', buf), iter * 32);\n    }\n    return res.slice(0, bits >> 3);\n}\n","import { encoder, decoder } from '../lib/buffer_utils.js';\nexport const encodeBase64 = (input) => {\n    let unencoded = input;\n    if (typeof unencoded === 'string') {\n        unencoded = encoder.encode(unencoded);\n    }\n    const CHUNK_SIZE = 0x8000;\n    const arr = [];\n    for (let i = 0; i < unencoded.length; i += CHUNK_SIZE) {\n        arr.push(String.fromCharCode.apply(null, unencoded.subarray(i, i + CHUNK_SIZE)));\n    }\n    return btoa(arr.join(''));\n};\nexport const encode = (input) => {\n    return encodeBase64(input).replace(/=/g, '').replace(/\\+/g, '-').replace(/\\//g, '_');\n};\nexport const decodeBase64 = (encoded) => {\n    const binary = atob(encoded);\n    const bytes = new Uint8Array(binary.length);\n    for (let i = 0; i < binary.length; i++) {\n        bytes[i] = binary.charCodeAt(i);\n    }\n    return bytes;\n};\nexport const decode = (input) => {\n    let encoded = input;\n    if (encoded instanceof Uint8Array) {\n        encoded = decoder.decode(encoded);\n    }\n    encoded = encoded.replace(/-/g, '+').replace(/_/g, '/').replace(/\\s/g, '');\n    try {\n        return decodeBase64(encoded);\n    }\n    catch {\n        throw new TypeError('The input to be decoded is not correctly encoded.');\n    }\n};\n","import { isCryptoKey } from './webcrypto.js';\nexport default (key) => {\n    if (isCryptoKey(key)) {\n        return true;\n    }\n    return key?.[Symbol.toStringTag] === 'KeyObject';\n};\nexport const types = ['CryptoKey'];\n","import crypto, { isCryptoKey } from './webcrypto.js';\nimport invalidKeyInput from '../lib/invalid_key_input.js';\nimport { encode as base64url } from './base64url.js';\nimport { types } from './is_key_like.js';\nconst keyToJWK = async (key) => {\n    if (key instanceof Uint8Array) {\n        return {\n            kty: 'oct',\n            k: base64url(key),\n        };\n    }\n    if (!isCryptoKey(key)) {\n        throw new TypeError(invalidKeyInput(key, ...types, 'Uint8Array'));\n    }\n    if (!key.extractable) {\n        throw new TypeError('non-extractable CryptoKey cannot be exported as a JWK');\n    }\n    const { ext, key_ops, alg, use, ...jwk } = await crypto.subtle.exportKey('jwk', key);\n    return jwk;\n};\nexport default keyToJWK;\n","import { toSPKI as exportPublic } from '../runtime/asn1.js';\nimport { toPKCS8 as exportPrivate } from '../runtime/asn1.js';\nimport keyToJWK from '../runtime/key_to_jwk.js';\nexport async function exportSPKI(key) {\n    return exportPublic(key);\n}\nexport async function exportPKCS8(key) {\n    return exportPrivate(key);\n}\nexport async function exportJWK(key) {\n    return keyToJWK(key);\n}\n","export class JOSEError extends Error {\n    constructor(message, options) {\n        super(message, options);\n        this.code = 'ERR_JOSE_GENERIC';\n        this.name = this.constructor.name;\n        Error.captureStackTrace?.(this, this.constructor);\n    }\n}\nJOSEError.code = 'ERR_JOSE_GENERIC';\nexport class JWTClaimValidationFailed extends JOSEError {\n    constructor(message, payload, claim = 'unspecified', reason = 'unspecified') {\n        super(message, { cause: { claim, reason, payload } });\n        this.code = 'ERR_JWT_CLAIM_VALIDATION_FAILED';\n        this.claim = claim;\n        this.reason = reason;\n        this.payload = payload;\n    }\n}\nJWTClaimValidationFailed.code = 'ERR_JWT_CLAIM_VALIDATION_FAILED';\nexport class JWTExpired extends JOSEError {\n    constructor(message, payload, claim = 'unspecified', reason = 'unspecified') {\n        super(message, { cause: { claim, reason, payload } });\n        this.code = 'ERR_JWT_EXPIRED';\n        this.claim = claim;\n        this.reason = reason;\n        this.payload = payload;\n    }\n}\nJWTExpired.code = 'ERR_JWT_EXPIRED';\nexport class JOSEAlgNotAllowed extends JOSEError {\n    constructor() {\n        super(...arguments);\n        this.code = 'ERR_JOSE_ALG_NOT_ALLOWED';\n    }\n}\nJOSEAlgNotAllowed.code = 'ERR_JOSE_ALG_NOT_ALLOWED';\nexport class JOSENotSupported extends JOSEError {\n    constructor() {\n        super(...arguments);\n        this.code = 'ERR_JOSE_NOT_SUPPORTED';\n    }\n}\nJOSENotSupported.code = 'ERR_JOSE_NOT_SUPPORTED';\nexport class JWEDecryptionFailed extends JOSEError {\n    constructor(message = 'decryption operation failed', options) {\n        super(message, options);\n        this.code = 'ERR_JWE_DECRYPTION_FAILED';\n    }\n}\nJWEDecryptionFailed.code = 'ERR_JWE_DECRYPTION_FAILED';\nexport class JWEInvalid extends JOSEError {\n    constructor() {\n        super(...arguments);\n        this.code = 'ERR_JWE_INVALID';\n    }\n}\nJWEInvalid.code = 'ERR_JWE_INVALID';\nexport class JWSInvalid extends JOSEError {\n    constructor() {\n        super(...arguments);\n        this.code = 'ERR_JWS_INVALID';\n    }\n}\nJWSInvalid.code = 'ERR_JWS_INVALID';\nexport class JWTInvalid extends JOSEError {\n    constructor() {\n        super(...arguments);\n        this.code = 'ERR_JWT_INVALID';\n    }\n}\nJWTInvalid.code = 'ERR_JWT_INVALID';\nexport class JWKInvalid extends JOSEError {\n    constructor() {\n        super(...arguments);\n        this.code = 'ERR_JWK_INVALID';\n    }\n}\nJWKInvalid.code = 'ERR_JWK_INVALID';\nexport class JWKSInvalid extends JOSEError {\n    constructor() {\n        super(...arguments);\n        this.code = 'ERR_JWKS_INVALID';\n    }\n}\nJWKSInvalid.code = 'ERR_JWKS_INVALID';\nexport class JWKSNoMatchingKey extends JOSEError {\n    constructor(message = 'no applicable key found in the JSON Web Key Set', options) {\n        super(message, options);\n        this.code = 'ERR_JWKS_NO_MATCHING_KEY';\n    }\n}\nJWKSNoMatchingKey.code = 'ERR_JWKS_NO_MATCHING_KEY';\nexport class JWKSMultipleMatchingKeys extends JOSEError {\n    constructor(message = 'multiple matching keys found in the JSON Web Key Set', options) {\n        super(message, options);\n        this.code = 'ERR_JWKS_MULTIPLE_MATCHING_KEYS';\n    }\n}\nSymbol.asyncIterator;\nJWKSMultipleMatchingKeys.code = 'ERR_JWKS_MULTIPLE_MATCHING_KEYS';\nexport class JWKSTimeout extends JOSEError {\n    constructor(message = 'request timed out', options) {\n        super(message, options);\n        this.code = 'ERR_JWKS_TIMEOUT';\n    }\n}\nJWKSTimeout.code = 'ERR_JWKS_TIMEOUT';\nexport class JWSSignatureVerificationFailed extends JOSEError {\n    constructor(message = 'signature verification failed', options) {\n        super(message, options);\n        this.code = 'ERR_JWS_SIGNATURE_VERIFICATION_FAILED';\n    }\n}\nJWSSignatureVerificationFailed.code = 'ERR_JWS_SIGNATURE_VERIFICATION_FAILED';\n","import { JOSENotSupported } from '../util/errors.js';\nexport default function subtleDsa(alg, algorithm) {\n    const hash = `SHA-${alg.slice(-3)}`;\n    switch (alg) {\n        case 'HS256':\n        case 'HS384':\n        case 'HS512':\n            return { hash, name: 'HMAC' };\n        case 'PS256':\n        case 'PS384':\n        case 'PS512':\n            return { hash, name: 'RSA-PSS', saltLength: alg.slice(-3) >> 3 };\n        case 'RS256':\n        case 'RS384':\n        case 'RS512':\n            return { hash, name: 'RSASSA-PKCS1-v1_5' };\n        case 'ES256':\n        case 'ES384':\n        case 'ES512':\n            return { hash, name: 'ECDSA', namedCurve: algorithm.namedCurve };\n        case 'Ed25519':\n            return { name: 'Ed25519' };\n        case 'EdDSA':\n            return { name: algorithm.name };\n        default:\n            throw new JOSENotSupported(`alg ${alg} is not supported either by JOSE or your javascript runtime`);\n    }\n}\n","export default (alg, key) => {\n    if (alg.startsWith('RS') || alg.startsWith('PS')) {\n        const { modulusLength } = key.algorithm;\n        if (typeof modulusLength !== 'number' || modulusLength < 2048) {\n            throw new TypeError(`${alg} requires key modulusLength to be 2048 bits or larger`);\n        }\n    }\n};\n","function unusable(name, prop = 'algorithm.name') {\n    return new TypeError(`CryptoKey does not support this operation, its ${prop} must be ${name}`);\n}\nfunction isAlgorithm(algorithm, name) {\n    return algorithm.name === name;\n}\nfunction getHashLength(hash) {\n    return parseInt(hash.name.slice(4), 10);\n}\nfunction getNamedCurve(alg) {\n    switch (alg) {\n        case 'ES256':\n            return 'P-256';\n        case 'ES384':\n            return 'P-384';\n        case 'ES512':\n            return 'P-521';\n        default:\n            throw new Error('unreachable');\n    }\n}\nfunction checkUsage(key, usages) {\n    if (usages.length && !usages.some((expected) => key.usages.includes(expected))) {\n        let msg = 'CryptoKey does not support this operation, its usages must include ';\n        if (usages.length > 2) {\n            const last = usages.pop();\n            msg += `one of ${usages.join(', ')}, or ${last}.`;\n        }\n        else if (usages.length === 2) {\n            msg += `one of ${usages[0]} or ${usages[1]}.`;\n        }\n        else {\n            msg += `${usages[0]}.`;\n        }\n        throw new TypeError(msg);\n    }\n}\nexport function checkSigCryptoKey(key, alg, ...usages) {\n    switch (alg) {\n        case 'HS256':\n        case 'HS384':\n        case 'HS512': {\n            if (!isAlgorithm(key.algorithm, 'HMAC'))\n                throw unusable('HMAC');\n            const expected = parseInt(alg.slice(2), 10);\n            const actual = getHashLength(key.algorithm.hash);\n            if (actual !== expected)\n                throw unusable(`SHA-${expected}`, 'algorithm.hash');\n            break;\n        }\n        case 'RS256':\n        case 'RS384':\n        case 'RS512': {\n            if (!isAlgorithm(key.algorithm, 'RSASSA-PKCS1-v1_5'))\n                throw unusable('RSASSA-PKCS1-v1_5');\n            const expected = parseInt(alg.slice(2), 10);\n            const actual = getHashLength(key.algorithm.hash);\n            if (actual !== expected)\n                throw unusable(`SHA-${expected}`, 'algorithm.hash');\n            break;\n        }\n        case 'PS256':\n        case 'PS384':\n        case 'PS512': {\n            if (!isAlgorithm(key.algorithm, 'RSA-PSS'))\n                throw unusable('RSA-PSS');\n            const expected = parseInt(alg.slice(2), 10);\n            const actual = getHashLength(key.algorithm.hash);\n            if (actual !== expected)\n                throw unusable(`SHA-${expected}`, 'algorithm.hash');\n            break;\n        }\n        case 'EdDSA': {\n            if (key.algorithm.name !== 'Ed25519' && key.algorithm.name !== 'Ed448') {\n                throw unusable('Ed25519 or Ed448');\n            }\n            break;\n        }\n        case 'Ed25519': {\n            if (!isAlgorithm(key.algorithm, 'Ed25519'))\n                throw unusable('Ed25519');\n            break;\n        }\n        case 'ES256':\n        case 'ES384':\n        case 'ES512': {\n            if (!isAlgorithm(key.algorithm, 'ECDSA'))\n                throw unusable('ECDSA');\n            const expected = getNamedCurve(alg);\n            const actual = key.algorithm.namedCurve;\n            if (actual !== expected)\n                throw unusable(expected, 'algorithm.namedCurve');\n            break;\n        }\n        default:\n            throw new TypeError('CryptoKey does not support this operation');\n    }\n    checkUsage(key, usages);\n}\nexport function checkEncCryptoKey(key, alg, ...usages) {\n    switch (alg) {\n        case 'A128GCM':\n        case 'A192GCM':\n        case 'A256GCM': {\n            if (!isAlgorithm(key.algorithm, 'AES-GCM'))\n                throw unusable('AES-GCM');\n            const expected = parseInt(alg.slice(1, 4), 10);\n            const actual = key.algorithm.length;\n            if (actual !== expected)\n                throw unusable(expected, 'algorithm.length');\n            break;\n        }\n        case 'A128KW':\n        case 'A192KW':\n        case 'A256KW': {\n            if (!isAlgorithm(key.algorithm, 'AES-KW'))\n                throw unusable('AES-KW');\n            const expected = parseInt(alg.slice(1, 4), 10);\n            const actual = key.algorithm.length;\n            if (actual !== expected)\n                throw unusable(expected, 'algorithm.length');\n            break;\n        }\n        case 'ECDH': {\n            switch (key.algorithm.name) {\n                case 'ECDH':\n                case 'X25519':\n                case 'X448':\n                    break;\n                default:\n                    throw unusable('ECDH, X25519, or X448');\n            }\n            break;\n        }\n        case 'PBES2-HS256+A128KW':\n        case 'PBES2-HS384+A192KW':\n        case 'PBES2-HS512+A256KW':\n            if (!isAlgorithm(key.algorithm, 'PBKDF2'))\n                throw unusable('PBKDF2');\n            break;\n        case 'RSA-OAEP':\n        case 'RSA-OAEP-256':\n        case 'RSA-OAEP-384':\n        case 'RSA-OAEP-512': {\n            if (!isAlgorithm(key.algorithm, 'RSA-OAEP'))\n                throw unusable('RSA-OAEP');\n            const expected = parseInt(alg.slice(9), 10) || 1;\n            const actual = getHashLength(key.algorithm.hash);\n            if (actual !== expected)\n                throw unusable(`SHA-${expected}`, 'algorithm.hash');\n            break;\n        }\n        default:\n            throw new TypeError('CryptoKey does not support this operation');\n    }\n    checkUsage(key, usages);\n}\n","function isObjectLike(value) {\n    return typeof value === 'object' && value !== null;\n}\nexport default function isObject(input) {\n    if (!isObjectLike(input) || Object.prototype.toString.call(input) !== '[object Object]') {\n        return false;\n    }\n    if (Object.getPrototypeOf(input) === null) {\n        return true;\n    }\n    let proto = input;\n    while (Object.getPrototypeOf(proto) !== null) {\n        proto = Object.getPrototypeOf(proto);\n    }\n    return Object.getPrototypeOf(input) === proto;\n}\n","import isObject from './is_object.js';\nexport function isJWK(key) {\n    return isObject(key) && typeof key.kty === 'string';\n}\nexport function isPrivateJWK(key) {\n    return key.kty !== 'oct' && typeof key.d === 'string';\n}\nexport function isPublicJWK(key) {\n    return key.kty !== 'oct' && typeof key.d === 'undefined';\n}\nexport function isSecretJWK(key) {\n    return isJWK(key) && key.kty === 'oct' && typeof key.k === 'string';\n}\n","import crypto from './webcrypto.js';\nimport { JOSENotSupported } from '../util/errors.js';\nfunction subtleMapping(jwk) {\n    let algorithm;\n    let keyUsages;\n    switch (jwk.kty) {\n        case 'RSA': {\n            switch (jwk.alg) {\n                case 'PS256':\n                case 'PS384':\n                case 'PS512':\n                    algorithm = { name: 'RSA-PSS', hash: `SHA-${jwk.alg.slice(-3)}` };\n                    keyUsages = jwk.d ? ['sign'] : ['verify'];\n                    break;\n                case 'RS256':\n                case 'RS384':\n                case 'RS512':\n                    algorithm = { name: 'RSASSA-PKCS1-v1_5', hash: `SHA-${jwk.alg.slice(-3)}` };\n                    keyUsages = jwk.d ? ['sign'] : ['verify'];\n                    break;\n                case 'RSA-OAEP':\n                case 'RSA-OAEP-256':\n                case 'RSA-OAEP-384':\n                case 'RSA-OAEP-512':\n                    algorithm = {\n                        name: 'RSA-OAEP',\n                        hash: `SHA-${parseInt(jwk.alg.slice(-3), 10) || 1}`,\n                    };\n                    keyUsages = jwk.d ? ['decrypt', 'unwrapKey'] : ['encrypt', 'wrapKey'];\n                    break;\n                default:\n                    throw new JOSENotSupported('Invalid or unsupported JWK \"alg\" (Algorithm) Parameter value');\n            }\n            break;\n        }\n        case 'EC': {\n            switch (jwk.alg) {\n                case 'ES256':\n                    algorithm = { name: 'ECDSA', namedCurve: 'P-256' };\n                    keyUsages = jwk.d ? ['sign'] : ['verify'];\n                    break;\n                case 'ES384':\n                    algorithm = { name: 'ECDSA', namedCurve: 'P-384' };\n                    keyUsages = jwk.d ? ['sign'] : ['verify'];\n                    break;\n                case 'ES512':\n                    algorithm = { name: 'ECDSA', namedCurve: 'P-521' };\n                    keyUsages = jwk.d ? ['sign'] : ['verify'];\n                    break;\n                case 'ECDH-ES':\n                case 'ECDH-ES+A128KW':\n                case 'ECDH-ES+A192KW':\n                case 'ECDH-ES+A256KW':\n                    algorithm = { name: 'ECDH', namedCurve: jwk.crv };\n                    keyUsages = jwk.d ? ['deriveBits'] : [];\n                    break;\n                default:\n                    throw new JOSENotSupported('Invalid or unsupported JWK \"alg\" (Algorithm) Parameter value');\n            }\n            break;\n        }\n        case 'OKP': {\n            switch (jwk.alg) {\n                case 'Ed25519':\n                    algorithm = { name: 'Ed25519' };\n                    keyUsages = jwk.d ? ['sign'] : ['verify'];\n                    break;\n                case 'EdDSA':\n                    algorithm = { name: jwk.crv };\n                    keyUsages = jwk.d ? ['sign'] : ['verify'];\n                    break;\n                case 'ECDH-ES':\n                case 'ECDH-ES+A128KW':\n                case 'ECDH-ES+A192KW':\n                case 'ECDH-ES+A256KW':\n                    algorithm = { name: jwk.crv };\n                    keyUsages = jwk.d ? ['deriveBits'] : [];\n                    break;\n                default:\n                    throw new JOSENotSupported('Invalid or unsupported JWK \"alg\" (Algorithm) Parameter value');\n            }\n            break;\n        }\n        default:\n            throw new JOSENotSupported('Invalid or unsupported JWK \"kty\" (Key Type) Parameter value');\n    }\n    return { algorithm, keyUsages };\n}\nconst parse = async (jwk) => {\n    if (!jwk.alg) {\n        throw new TypeError('\"alg\" argument is required when \"jwk.alg\" is not present');\n    }\n    const { algorithm, keyUsages } = subtleMapping(jwk);\n    const rest = [\n        algorithm,\n        jwk.ext ?? false,\n        jwk.key_ops ?? keyUsages,\n    ];\n    const keyData = { ...jwk };\n    delete keyData.alg;\n    delete keyData.use;\n    return crypto.subtle.importKey('jwk', keyData, ...rest);\n};\nexport default parse;\n","import { isJWK } from '../lib/is_jwk.js';\nimport { decode } from './base64url.js';\nimport importJWK from './jwk_to_key.js';\nconst exportKeyValue = (k) => decode(k);\nlet privCache;\nlet pubCache;\nconst isKeyObject = (key) => {\n    return key?.[Symbol.toStringTag] === 'KeyObject';\n};\nconst importAndCache = async (cache, key, jwk, alg, freeze = false) => {\n    let cached = cache.get(key);\n    if (cached?.[alg]) {\n        return cached[alg];\n    }\n    const cryptoKey = await importJWK({ ...jwk, alg });\n    if (freeze)\n        Object.freeze(key);\n    if (!cached) {\n        cache.set(key, { [alg]: cryptoKey });\n    }\n    else {\n        cached[alg] = cryptoKey;\n    }\n    return cryptoKey;\n};\nconst normalizePublicKey = (key, alg) => {\n    if (isKeyObject(key)) {\n        let jwk = key.export({ format: 'jwk' });\n        delete jwk.d;\n        delete jwk.dp;\n        delete jwk.dq;\n        delete jwk.p;\n        delete jwk.q;\n        delete jwk.qi;\n        if (jwk.k) {\n            return exportKeyValue(jwk.k);\n        }\n        pubCache || (pubCache = new WeakMap());\n        return importAndCache(pubCache, key, jwk, alg);\n    }\n    if (isJWK(key)) {\n        if (key.k)\n            return decode(key.k);\n        pubCache || (pubCache = new WeakMap());\n        const cryptoKey = importAndCache(pubCache, key, key, alg, true);\n        return cryptoKey;\n    }\n    return key;\n};\nconst normalizePrivateKey = (key, alg) => {\n    if (isKeyObject(key)) {\n        let jwk = key.export({ format: 'jwk' });\n        if (jwk.k) {\n            return exportKeyValue(jwk.k);\n        }\n        privCache || (privCache = new WeakMap());\n        return importAndCache(privCache, key, jwk, alg);\n    }\n    if (isJWK(key)) {\n        if (key.k)\n            return decode(key.k);\n        privCache || (privCache = new WeakMap());\n        const cryptoKey = importAndCache(privCache, key, key, alg, true);\n        return cryptoKey;\n    }\n    return key;\n};\nexport default { normalizePublicKey, normalizePrivateKey };\n","import crypto, { isCryptoKey } from './webcrypto.js';\nimport { checkSigCryptoKey } from '../lib/crypto_key.js';\nimport invalidKeyInput from '../lib/invalid_key_input.js';\nimport { types } from './is_key_like.js';\nimport normalize from './normalize_key.js';\nexport default async function getCryptoKey(alg, key, usage) {\n    if (usage === 'sign') {\n        key = await normalize.normalizePrivateKey(key, alg);\n    }\n    if (usage === 'verify') {\n        key = await normalize.normalizePublicKey(key, alg);\n    }\n    if (isCryptoKey(key)) {\n        checkSigCryptoKey(key, alg, usage);\n        return key;\n    }\n    if (key instanceof Uint8Array) {\n        if (!alg.startsWith('HS')) {\n            throw new TypeError(invalidKeyInput(key, ...types));\n        }\n        return crypto.subtle.importKey('raw', key, { hash: `SHA-${alg.slice(-3)}`, name: 'HMAC' }, false, [usage]);\n    }\n    throw new TypeError(invalidKeyInput(key, ...types, 'Uint8Array', 'JSON Web Key'));\n}\n","import subtleAlgorithm from './subtle_dsa.js';\nimport crypto from './webcrypto.js';\nimport checkKeyLength from './check_key_length.js';\nimport getSignKey from './get_sign_verify_key.js';\nconst sign = async (alg, key, data) => {\n    const cryptoKey = await getSignKey(alg, key, 'sign');\n    checkKeyLength(alg, cryptoKey);\n    const signature = await crypto.subtle.sign(subtleAlgorithm(alg, cryptoKey.algorithm), cryptoKey, data);\n    return new Uint8Array(signature);\n};\nexport default sign;\n","const isDisjoint = (...headers) => {\n    const sources = headers.filter(Boolean);\n    if (sources.length === 0 || sources.length === 1) {\n        return true;\n    }\n    let acc;\n    for (const header of sources) {\n        const parameters = Object.keys(header);\n        if (!acc || acc.size === 0) {\n            acc = new Set(parameters);\n            continue;\n        }\n        for (const parameter of parameters) {\n            if (acc.has(parameter)) {\n                return false;\n            }\n            acc.add(parameter);\n        }\n    }\n    return true;\n};\nexport default isDisjoint;\n","import { withAlg as invalidKeyInput } from './invalid_key_input.js';\nimport isKeyLike, { types } from '../runtime/is_key_like.js';\nimport * as jwk from './is_jwk.js';\nconst tag = (key) => key?.[Symbol.toStringTag];\nconst jwkMatchesOp = (alg, key, usage) => {\n    if (key.use !== undefined && key.use !== 'sig') {\n        throw new TypeError('Invalid key for this operation, when present its use must be sig');\n    }\n    if (key.key_ops !== undefined && key.key_ops.includes?.(usage) !== true) {\n        throw new TypeError(`Invalid key for this operation, when present its key_ops must include ${usage}`);\n    }\n    if (key.alg !== undefined && key.alg !== alg) {\n        throw new TypeError(`Invalid key for this operation, when present its alg must be ${alg}`);\n    }\n    return true;\n};\nconst symmetricTypeCheck = (alg, key, usage, allowJwk) => {\n    if (key instanceof Uint8Array)\n        return;\n    if (allowJwk && jwk.isJWK(key)) {\n        if (jwk.isSecretJWK(key) && jwkMatchesOp(alg, key, usage))\n            return;\n        throw new TypeError(`JSON Web Key for symmetric algorithms must have JWK \"kty\" (Key Type) equal to \"oct\" and the JWK \"k\" (Key Value) present`);\n    }\n    if (!isKeyLike(key)) {\n        throw new TypeError(invalidKeyInput(alg, key, ...types, 'Uint8Array', allowJwk ? 'JSON Web Key' : null));\n    }\n    if (key.type !== 'secret') {\n        throw new TypeError(`${tag(key)} instances for symmetric algorithms must be of type \"secret\"`);\n    }\n};\nconst asymmetricTypeCheck = (alg, key, usage, allowJwk) => {\n    if (allowJwk && jwk.isJWK(key)) {\n        switch (usage) {\n            case 'sign':\n                if (jwk.isPrivateJWK(key) && jwkMatchesOp(alg, key, usage))\n                    return;\n                throw new TypeError(`JSON Web Key for this operation be a private JWK`);\n            case 'verify':\n                if (jwk.isPublicJWK(key) && jwkMatchesOp(alg, key, usage))\n                    return;\n                throw new TypeError(`JSON Web Key for this operation be a public JWK`);\n        }\n    }\n    if (!isKeyLike(key)) {\n        throw new TypeError(invalidKeyInput(alg, key, ...types, allowJwk ? 'JSON Web Key' : null));\n    }\n    if (key.type === 'secret') {\n        throw new TypeError(`${tag(key)} instances for asymmetric algorithms must not be of type \"secret\"`);\n    }\n    if (usage === 'sign' && key.type === 'public') {\n        throw new TypeError(`${tag(key)} instances for asymmetric algorithm signing must be of type \"private\"`);\n    }\n    if (usage === 'decrypt' && key.type === 'public') {\n        throw new TypeError(`${tag(key)} instances for asymmetric algorithm decryption must be of type \"private\"`);\n    }\n    if (key.algorithm && usage === 'verify' && key.type === 'private') {\n        throw new TypeError(`${tag(key)} instances for asymmetric algorithm verifying must be of type \"public\"`);\n    }\n    if (key.algorithm && usage === 'encrypt' && key.type === 'private') {\n        throw new TypeError(`${tag(key)} instances for asymmetric algorithm encryption must be of type \"public\"`);\n    }\n};\nfunction checkKeyType(allowJwk, alg, key, usage) {\n    const symmetric = alg.startsWith('HS') ||\n        alg === 'dir' ||\n        alg.startsWith('PBES2') ||\n        /^A\\d{3}(?:GCM)?KW$/.test(alg);\n    if (symmetric) {\n        symmetricTypeCheck(alg, key, usage, allowJwk);\n    }\n    else {\n        asymmetricTypeCheck(alg, key, usage, allowJwk);\n    }\n}\nexport default checkKeyType.bind(undefined, false);\nexport const checkKeyTypeWithJwk = checkKeyType.bind(undefined, true);\n","import { JOSENotSupported } from '../util/errors.js';\nfunction validateCrit(Err, recognizedDefault, recognizedOption, protectedHeader, joseHeader) {\n    if (joseHeader.crit !== undefined && protectedHeader?.crit === undefined) {\n        throw new Err('\"crit\" (Critical) Header Parameter MUST be integrity protected');\n    }\n    if (!protectedHeader || protectedHeader.crit === undefined) {\n        return new Set();\n    }\n    if (!Array.isArray(protectedHeader.crit) ||\n        protectedHeader.crit.length === 0 ||\n        protectedHeader.crit.some((input) => typeof input !== 'string' || input.length === 0)) {\n        throw new Err('\"crit\" (Critical) Header Parameter MUST be an array of non-empty strings when present');\n    }\n    let recognized;\n    if (recognizedOption !== undefined) {\n        recognized = new Map([...Object.entries(recognizedOption), ...recognizedDefault.entries()]);\n    }\n    else {\n        recognized = recognizedDefault;\n    }\n    for (const parameter of protectedHeader.crit) {\n        if (!recognized.has(parameter)) {\n            throw new JOSENotSupported(`Extension Header Parameter \"${parameter}\" is not recognized`);\n        }\n        if (joseHeader[parameter] === undefined) {\n            throw new Err(`Extension Header Parameter \"${parameter}\" is missing`);\n        }\n        if (recognized.get(parameter) && protectedHeader[parameter] === undefined) {\n            throw new Err(`Extension Header Parameter \"${parameter}\" MUST be integrity protected`);\n        }\n    }\n    return new Set(protectedHeader.crit);\n}\nexport default validateCrit;\n","import { encode as base64url } from '../../runtime/base64url.js';\nimport sign from '../../runtime/sign.js';\nimport isDisjoint from '../../lib/is_disjoint.js';\nimport { JWSInvalid } from '../../util/errors.js';\nimport { encoder, decoder, concat } from '../../lib/buffer_utils.js';\nimport { checkKeyTypeWithJwk } from '../../lib/check_key_type.js';\nimport validateCrit from '../../lib/validate_crit.js';\nexport class FlattenedSign {\n    constructor(payload) {\n        if (!(payload instanceof Uint8Array)) {\n            throw new TypeError('payload must be an instance of Uint8Array');\n        }\n        this._payload = payload;\n    }\n    setProtectedHeader(protectedHeader) {\n        if (this._protectedHeader) {\n            throw new TypeError('setProtectedHeader can only be called once');\n        }\n        this._protectedHeader = protectedHeader;\n        return this;\n    }\n    setUnprotectedHeader(unprotectedHeader) {\n        if (this._unprotectedHeader) {\n            throw new TypeError('setUnprotectedHeader can only be called once');\n        }\n        this._unprotectedHeader = unprotectedHeader;\n        return this;\n    }\n    async sign(key, options) {\n        if (!this._protectedHeader && !this._unprotectedHeader) {\n            throw new JWSInvalid('either setProtectedHeader or setUnprotectedHeader must be called before #sign()');\n        }\n        if (!isDisjoint(this._protectedHeader, this._unprotectedHeader)) {\n            throw new JWSInvalid('JWS Protected and JWS Unprotected Header Parameter names must be disjoint');\n        }\n        const joseHeader = {\n            ...this._protectedHeader,\n            ...this._unprotectedHeader,\n        };\n        const extensions = validateCrit(JWSInvalid, new Map([['b64', true]]), options?.crit, this._protectedHeader, joseHeader);\n        let b64 = true;\n        if (extensions.has('b64')) {\n            b64 = this._protectedHeader.b64;\n            if (typeof b64 !== 'boolean') {\n                throw new JWSInvalid('The \"b64\" (base64url-encode payload) Header Parameter must be a boolean');\n            }\n        }\n        const { alg } = joseHeader;\n        if (typeof alg !== 'string' || !alg) {\n            throw new JWSInvalid('JWS \"alg\" (Algorithm) Header Parameter missing or invalid');\n        }\n        checkKeyTypeWithJwk(alg, key, 'sign');\n        let payload = this._payload;\n        if (b64) {\n            payload = encoder.encode(base64url(payload));\n        }\n        let protectedHeader;\n        if (this._protectedHeader) {\n            protectedHeader = encoder.encode(base64url(JSON.stringify(this._protectedHeader)));\n        }\n        else {\n            protectedHeader = encoder.encode('');\n        }\n        const data = concat(protectedHeader, encoder.encode('.'), payload);\n        const signature = await sign(alg, key, data);\n        const jws = {\n            signature: base64url(signature),\n            payload: '',\n        };\n        if (b64) {\n            jws.payload = decoder.decode(payload);\n        }\n        if (this._unprotectedHeader) {\n            jws.header = this._unprotectedHeader;\n        }\n        if (this._protectedHeader) {\n            jws.protected = decoder.decode(protectedHeader);\n        }\n        return jws;\n    }\n}\n","import { FlattenedSign } from '../flattened/sign.js';\nexport class CompactSign {\n    constructor(payload) {\n        this._flattened = new FlattenedSign(payload);\n    }\n    setProtectedHeader(protectedHeader) {\n        this._flattened.setProtectedHeader(protectedHeader);\n        return this;\n    }\n    async sign(key, options) {\n        const jws = await this._flattened.sign(key, options);\n        if (jws.payload === undefined) {\n            throw new TypeError('use the flattened module for creating JWS with b64: false');\n        }\n        return `${jws.protected}.${jws.payload}.${jws.signature}`;\n    }\n}\n","export default (date) => Math.floor(date.getTime() / 1000);\n","const minute = 60;\nconst hour = minute * 60;\nconst day = hour * 24;\nconst week = day * 7;\nconst year = day * 365.25;\nconst REGEX = /^(\\+|\\-)? ?(\\d+|\\d+\\.\\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)(?: (ago|from now))?$/i;\nexport default (str) => {\n    const matched = REGEX.exec(str);\n    if (!matched || (matched[4] && matched[1])) {\n        throw new TypeError('Invalid time period format');\n    }\n    const value = parseFloat(matched[2]);\n    const unit = matched[3].toLowerCase();\n    let numericDate;\n    switch (unit) {\n        case 'sec':\n        case 'secs':\n        case 'second':\n        case 'seconds':\n        case 's':\n            numericDate = Math.round(value);\n            break;\n        case 'minute':\n        case 'minutes':\n        case 'min':\n        case 'mins':\n        case 'm':\n            numericDate = Math.round(value * minute);\n            break;\n        case 'hour':\n        case 'hours':\n        case 'hr':\n        case 'hrs':\n        case 'h':\n            numericDate = Math.round(value * hour);\n            break;\n        case 'day':\n        case 'days':\n        case 'd':\n            numericDate = Math.round(value * day);\n            break;\n        case 'week':\n        case 'weeks':\n        case 'w':\n            numericDate = Math.round(value * week);\n            break;\n        default:\n            numericDate = Math.round(value * year);\n            break;\n    }\n    if (matched[1] === '-' || matched[4] === 'ago') {\n        return -numericDate;\n    }\n    return numericDate;\n};\n","import epoch from '../lib/epoch.js';\nimport isObject from '../lib/is_object.js';\nimport secs from '../lib/secs.js';\nfunction validateInput(label, input) {\n    if (!Number.isFinite(input)) {\n        throw new TypeError(`Invalid ${label} input`);\n    }\n    return input;\n}\nexport class ProduceJWT {\n    constructor(payload = {}) {\n        if (!isObject(payload)) {\n            throw new TypeError('JWT Claims Set MUST be an object');\n        }\n        this._payload = payload;\n    }\n    setIssuer(issuer) {\n        this._payload = { ...this._payload, iss: issuer };\n        return this;\n    }\n    setSubject(subject) {\n        this._payload = { ...this._payload, sub: subject };\n        return this;\n    }\n    setAudience(audience) {\n        this._payload = { ...this._payload, aud: audience };\n        return this;\n    }\n    setJti(jwtId) {\n        this._payload = { ...this._payload, jti: jwtId };\n        return this;\n    }\n    setNotBefore(input) {\n        if (typeof input === 'number') {\n            this._payload = { ...this._payload, nbf: validateInput('setNotBefore', input) };\n        }\n        else if (input instanceof Date) {\n            this._payload = { ...this._payload, nbf: validateInput('setNotBefore', epoch(input)) };\n        }\n        else {\n            this._payload = { ...this._payload, nbf: epoch(new Date()) + secs(input) };\n        }\n        return this;\n    }\n    setExpirationTime(input) {\n        if (typeof input === 'number') {\n            this._payload = { ...this._payload, exp: validateInput('setExpirationTime', input) };\n        }\n        else if (input instanceof Date) {\n            this._payload = { ...this._payload, exp: validateInput('setExpirationTime', epoch(input)) };\n        }\n        else {\n            this._payload = { ...this._payload, exp: epoch(new Date()) + secs(input) };\n        }\n        return this;\n    }\n    setIssuedAt(input) {\n        if (typeof input === 'undefined') {\n            this._payload = { ...this._payload, iat: epoch(new Date()) };\n        }\n        else if (input instanceof Date) {\n            this._payload = { ...this._payload, iat: validateInput('setIssuedAt', epoch(input)) };\n        }\n        else if (typeof input === 'string') {\n            this._payload = {\n                ...this._payload,\n                iat: validateInput('setIssuedAt', epoch(new Date()) + secs(input)),\n            };\n        }\n        else {\n            this._payload = { ...this._payload, iat: validateInput('setIssuedAt', input) };\n        }\n        return this;\n    }\n}\n","import { CompactSign } from '../jws/compact/sign.js';\nimport { JWTInvalid } from '../util/errors.js';\nimport { encoder } from '../lib/buffer_utils.js';\nimport { ProduceJWT } from './produce.js';\nexport class SignJWT extends ProduceJWT {\n    setProtectedHeader(protectedHeader) {\n        this._protectedHeader = protectedHeader;\n        return this;\n    }\n    async sign(key, options) {\n        const sig = new CompactSign(encoder.encode(JSON.stringify(this._payload)));\n        sig.setProtectedHeader(this._protectedHeader);\n        if (Array.isArray(this._protectedHeader?.crit) &&\n            this._protectedHeader.crit.includes('b64') &&\n            this._protectedHeader.b64 === false) {\n            throw new JWTInvalid('JWTs MUST NOT use unencoded payload');\n        }\n        return sig.sign(key, options);\n    }\n}\n","import { JOSEError, JWKSTimeout } from '../util/errors.js';\nconst fetchJwks = async (url, timeout, options) => {\n    let controller;\n    let id;\n    let timedOut = false;\n    if (typeof AbortController === 'function') {\n        controller = new AbortController();\n        id = setTimeout(() => {\n            timedOut = true;\n            controller.abort();\n        }, timeout);\n    }\n    const response = await fetch(url.href, {\n        signal: controller ? controller.signal : undefined,\n        redirect: 'manual',\n        headers: options.headers,\n    }).catch((err) => {\n        if (timedOut)\n            throw new JWKSTimeout();\n        throw err;\n    });\n    if (id !== undefined)\n        clearTimeout(id);\n    if (response.status !== 200) {\n        throw new JOSEError('Expected 200 OK from the JSON Web Key Set HTTP response');\n    }\n    try {\n        return await response.json();\n    }\n    catch {\n        throw new JOSEError('Failed to parse the JSON Web Key Set HTTP response as JSON');\n    }\n};\nexport default fetchJwks;\n","import { decode as decodeBase64URL } from '../runtime/base64url.js';\nimport { fromSPKI, fromPKCS8, fromX509 } from '../runtime/asn1.js';\nimport asKeyObject from '../runtime/jwk_to_key.js';\nimport { JOSENotSupported } from '../util/errors.js';\nimport isObject from '../lib/is_object.js';\nexport async function importSPKI(spki, alg, options) {\n    if (typeof spki !== 'string' || spki.indexOf('-----BEGIN PUBLIC KEY-----') !== 0) {\n        throw new TypeError('\"spki\" must be SPKI formatted string');\n    }\n    return fromSPKI(spki, alg, options);\n}\nexport async function importX509(x509, alg, options) {\n    if (typeof x509 !== 'string' || x509.indexOf('-----BEGIN CERTIFICATE-----') !== 0) {\n        throw new TypeError('\"x509\" must be X.509 formatted string');\n    }\n    return fromX509(x509, alg, options);\n}\nexport async function importPKCS8(pkcs8, alg, options) {\n    if (typeof pkcs8 !== 'string' || pkcs8.indexOf('-----BEGIN PRIVATE KEY-----') !== 0) {\n        throw new TypeError('\"pkcs8\" must be PKCS#8 formatted string');\n    }\n    return fromPKCS8(pkcs8, alg, options);\n}\nexport async function importJWK(jwk, alg) {\n    if (!isObject(jwk)) {\n        throw new TypeError('JWK must be an object');\n    }\n    alg || (alg = jwk.alg);\n    switch (jwk.kty) {\n        case 'oct':\n            if (typeof jwk.k !== 'string' || !jwk.k) {\n                throw new TypeError('missing \"k\" (Key Value) Parameter value');\n            }\n            return decodeBase64URL(jwk.k);\n        case 'RSA':\n            if ('oth' in jwk && jwk.oth !== undefined) {\n                throw new JOSENotSupported('RSA JWK \"oth\" (Other Primes Info) Parameter value is not supported');\n            }\n        case 'EC':\n        case 'OKP':\n            return asKeyObject({ ...jwk, alg });\n        default:\n            throw new JOSENotSupported('Unsupported \"kty\" (Key Type) Parameter value');\n    }\n}\n","import { importJWK } from '../key/import.js';\nimport { JWKSInvalid, JOSENotSupported, JWKSNoMatchingKey, JWKSMultipleMatchingKeys, } from '../util/errors.js';\nimport isObject from '../lib/is_object.js';\nfunction getKtyFromAlg(alg) {\n    switch (typeof alg === 'string' && alg.slice(0, 2)) {\n        case 'RS':\n        case 'PS':\n            return 'RSA';\n        case 'ES':\n            return 'EC';\n        case 'Ed':\n            return 'OKP';\n        default:\n            throw new JOSENotSupported('Unsupported \"alg\" value for a JSON Web Key Set');\n    }\n}\nfunction isJWKSLike(jwks) {\n    return (jwks &&\n        typeof jwks === 'object' &&\n        Array.isArray(jwks.keys) &&\n        jwks.keys.every(isJWKLike));\n}\nfunction isJWKLike(key) {\n    return isObject(key);\n}\nfunction clone(obj) {\n    if (typeof structuredClone === 'function') {\n        return structuredClone(obj);\n    }\n    return JSON.parse(JSON.stringify(obj));\n}\nclass LocalJWKSet {\n    constructor(jwks) {\n        this._cached = new WeakMap();\n        if (!isJWKSLike(jwks)) {\n            throw new JWKSInvalid('JSON Web Key Set malformed');\n        }\n        this._jwks = clone(jwks);\n    }\n    async getKey(protectedHeader, token) {\n        const { alg, kid } = { ...protectedHeader, ...token?.header };\n        const kty = getKtyFromAlg(alg);\n        const candidates = this._jwks.keys.filter((jwk) => {\n            let candidate = kty === jwk.kty;\n            if (candidate && typeof kid === 'string') {\n                candidate = kid === jwk.kid;\n            }\n            if (candidate && typeof jwk.alg === 'string') {\n                candidate = alg === jwk.alg;\n            }\n            if (candidate && typeof jwk.use === 'string') {\n                candidate = jwk.use === 'sig';\n            }\n            if (candidate && Array.isArray(jwk.key_ops)) {\n                candidate = jwk.key_ops.includes('verify');\n            }\n            if (candidate) {\n                switch (alg) {\n                    case 'ES256':\n                        candidate = jwk.crv === 'P-256';\n                        break;\n                    case 'ES256K':\n                        candidate = jwk.crv === 'secp256k1';\n                        break;\n                    case 'ES384':\n                        candidate = jwk.crv === 'P-384';\n                        break;\n                    case 'ES512':\n                        candidate = jwk.crv === 'P-521';\n                        break;\n                    case 'Ed25519':\n                        candidate = jwk.crv === 'Ed25519';\n                        break;\n                    case 'EdDSA':\n                        candidate = jwk.crv === 'Ed25519' || jwk.crv === 'Ed448';\n                        break;\n                }\n            }\n            return candidate;\n        });\n        const { 0: jwk, length } = candidates;\n        if (length === 0) {\n            throw new JWKSNoMatchingKey();\n        }\n        if (length !== 1) {\n            const error = new JWKSMultipleMatchingKeys();\n            const { _cached } = this;\n            error[Symbol.asyncIterator] = async function* () {\n                for (const jwk of candidates) {\n                    try {\n                        yield await importWithAlgCache(_cached, jwk, alg);\n                    }\n                    catch { }\n                }\n            };\n            throw error;\n        }\n        return importWithAlgCache(this._cached, jwk, alg);\n    }\n}\nasync function importWithAlgCache(cache, jwk, alg) {\n    const cached = cache.get(jwk) || cache.set(jwk, {}).get(jwk);\n    if (cached[alg] === undefined) {\n        const key = await importJWK({ ...jwk, ext: true }, alg);\n        if (key instanceof Uint8Array || key.type !== 'public') {\n            throw new JWKSInvalid('JSON Web Key Set members must be public keys');\n        }\n        cached[alg] = key;\n    }\n    return cached[alg];\n}\nexport function createLocalJWKSet(jwks) {\n    const set = new LocalJWKSet(jwks);\n    const localJWKSet = async (protectedHeader, token) => set.getKey(protectedHeader, token);\n    Object.defineProperties(localJWKSet, {\n        jwks: {\n            value: () => clone(set._jwks),\n            enumerable: true,\n            configurable: false,\n            writable: false,\n        },\n    });\n    return localJWKSet;\n}\n","import fetchJwks from '../runtime/fetch_jwks.js';\nimport { JWKSNoMatchingKey } from '../util/errors.js';\nimport { createLocalJWKSet } from './local.js';\nimport isObject from '../lib/is_object.js';\nfunction isCloudflareWorkers() {\n    return (typeof WebSocketPair !== 'undefined' ||\n        (typeof navigator !== 'undefined' && navigator.userAgent === 'Cloudflare-Workers') ||\n        (typeof EdgeRuntime !== 'undefined' && EdgeRuntime === 'vercel'));\n}\nlet USER_AGENT;\nif (typeof navigator === 'undefined' || !navigator.userAgent?.startsWith?.('Mozilla/5.0 ')) {\n    const NAME = 'jose';\n    const VERSION = 'v5.10.0';\n    USER_AGENT = `${NAME}/${VERSION}`;\n}\nexport const jwksCache = Symbol();\nfunction isFreshJwksCache(input, cacheMaxAge) {\n    if (typeof input !== 'object' || input === null) {\n        return false;\n    }\n    if (!('uat' in input) || typeof input.uat !== 'number' || Date.now() - input.uat >= cacheMaxAge) {\n        return false;\n    }\n    if (!('jwks' in input) ||\n        !isObject(input.jwks) ||\n        !Array.isArray(input.jwks.keys) ||\n        !Array.prototype.every.call(input.jwks.keys, isObject)) {\n        return false;\n    }\n    return true;\n}\nclass RemoteJWKSet {\n    constructor(url, options) {\n        if (!(url instanceof URL)) {\n            throw new TypeError('url must be an instance of URL');\n        }\n        this._url = new URL(url.href);\n        this._options = { agent: options?.agent, headers: options?.headers };\n        this._timeoutDuration =\n            typeof options?.timeoutDuration === 'number' ? options?.timeoutDuration : 5000;\n        this._cooldownDuration =\n            typeof options?.cooldownDuration === 'number' ? options?.cooldownDuration : 30000;\n        this._cacheMaxAge = typeof options?.cacheMaxAge === 'number' ? options?.cacheMaxAge : 600000;\n        if (options?.[jwksCache] !== undefined) {\n            this._cache = options?.[jwksCache];\n            if (isFreshJwksCache(options?.[jwksCache], this._cacheMaxAge)) {\n                this._jwksTimestamp = this._cache.uat;\n                this._local = createLocalJWKSet(this._cache.jwks);\n            }\n        }\n    }\n    coolingDown() {\n        return typeof this._jwksTimestamp === 'number'\n            ? Date.now() < this._jwksTimestamp + this._cooldownDuration\n            : false;\n    }\n    fresh() {\n        return typeof this._jwksTimestamp === 'number'\n            ? Date.now() < this._jwksTimestamp + this._cacheMaxAge\n            : false;\n    }\n    async getKey(protectedHeader, token) {\n        if (!this._local || !this.fresh()) {\n            await this.reload();\n        }\n        try {\n            return await this._local(protectedHeader, token);\n        }\n        catch (err) {\n            if (err instanceof JWKSNoMatchingKey) {\n                if (this.coolingDown() === false) {\n                    await this.reload();\n                    return this._local(protectedHeader, token);\n                }\n            }\n            throw err;\n        }\n    }\n    async reload() {\n        if (this._pendingFetch && isCloudflareWorkers()) {\n            this._pendingFetch = undefined;\n        }\n        const headers = new Headers(this._options.headers);\n        if (USER_AGENT && !headers.has('User-Agent')) {\n            headers.set('User-Agent', USER_AGENT);\n            this._options.headers = Object.fromEntries(headers.entries());\n        }\n        this._pendingFetch || (this._pendingFetch = fetchJwks(this._url, this._timeoutDuration, this._options)\n            .then((json) => {\n            this._local = createLocalJWKSet(json);\n            if (this._cache) {\n                this._cache.uat = Date.now();\n                this._cache.jwks = json;\n            }\n            this._jwksTimestamp = Date.now();\n            this._pendingFetch = undefined;\n        })\n            .catch((err) => {\n            this._pendingFetch = undefined;\n            throw err;\n        }));\n        await this._pendingFetch;\n    }\n}\nexport function createRemoteJWKSet(url, options) {\n    const set = new RemoteJWKSet(url, options);\n    const remoteJWKSet = async (protectedHeader, token) => set.getKey(protectedHeader, token);\n    Object.defineProperties(remoteJWKSet, {\n        coolingDown: {\n            get: () => set.coolingDown(),\n            enumerable: true,\n            configurable: false,\n        },\n        fresh: {\n            get: () => set.fresh(),\n            enumerable: true,\n            configurable: false,\n        },\n        reload: {\n            value: () => set.reload(),\n            enumerable: true,\n            configurable: false,\n            writable: false,\n        },\n        reloading: {\n            get: () => !!set._pendingFetch,\n            enumerable: true,\n            configurable: false,\n        },\n        jwks: {\n            value: () => set._local?.jwks(),\n            enumerable: true,\n            configurable: false,\n            writable: false,\n        },\n    });\n    return remoteJWKSet;\n}\nexport const experimental_jwksCache = jwksCache;\n","import subtleAlgorithm from './subtle_dsa.js';\nimport crypto from './webcrypto.js';\nimport checkKeyLength from './check_key_length.js';\nimport getVerifyKey from './get_sign_verify_key.js';\nconst verify = async (alg, key, signature, data) => {\n    const cryptoKey = await getVerifyKey(alg, key, 'verify');\n    checkKeyLength(alg, cryptoKey);\n    const algorithm = subtleAlgorithm(alg, cryptoKey.algorithm);\n    try {\n        return await crypto.subtle.verify(algorithm, cryptoKey, signature, data);\n    }\n    catch {\n        return false;\n    }\n};\nexport default verify;\n","const validateAlgorithms = (option, algorithms) => {\n    if (algorithms !== undefined &&\n        (!Array.isArray(algorithms) || algorithms.some((s) => typeof s !== 'string'))) {\n        throw new TypeError(`\"${option}\" option must be an array of strings`);\n    }\n    if (!algorithms) {\n        return undefined;\n    }\n    return new Set(algorithms);\n};\nexport default validateAlgorithms;\n","import { flattenedVerify } from '../flattened/verify.js';\nimport { JWSInvalid } from '../../util/errors.js';\nimport { decoder } from '../../lib/buffer_utils.js';\nexport async function compactVerify(jws, key, options) {\n    if (jws instanceof Uint8Array) {\n        jws = decoder.decode(jws);\n    }\n    if (typeof jws !== 'string') {\n        throw new JWSInvalid('Compact JWS must be a string or Uint8Array');\n    }\n    const { 0: protectedHeader, 1: payload, 2: signature, length } = jws.split('.');\n    if (length !== 3) {\n        throw new JWSInvalid('Invalid Compact JWS');\n    }\n    const verified = await flattenedVerify({ payload, protected: protectedHeader, signature }, key, options);\n    const result = { payload: verified.payload, protectedHeader: verified.protectedHeader };\n    if (typeof key === 'function') {\n        return { ...result, key: verified.key };\n    }\n    return result;\n}\n","import { decode as base64url } from '../../runtime/base64url.js';\nimport verify from '../../runtime/verify.js';\nimport { JOSEAlgNotAllowed, JWSInvalid, JWSSignatureVerificationFailed } from '../../util/errors.js';\nimport { concat, encoder, decoder } from '../../lib/buffer_utils.js';\nimport isDisjoint from '../../lib/is_disjoint.js';\nimport isObject from '../../lib/is_object.js';\nimport { checkKeyTypeWithJwk } from '../../lib/check_key_type.js';\nimport validateCrit from '../../lib/validate_crit.js';\nimport validateAlgorithms from '../../lib/validate_algorithms.js';\nimport { isJWK } from '../../lib/is_jwk.js';\nimport { importJWK } from '../../key/import.js';\nexport async function flattenedVerify(jws, key, options) {\n    if (!isObject(jws)) {\n        throw new JWSInvalid('Flattened JWS must be an object');\n    }\n    if (jws.protected === undefined && jws.header === undefined) {\n        throw new JWSInvalid('Flattened JWS must have either of the \"protected\" or \"header\" members');\n    }\n    if (jws.protected !== undefined && typeof jws.protected !== 'string') {\n        throw new JWSInvalid('JWS Protected Header incorrect type');\n    }\n    if (jws.payload === undefined) {\n        throw new JWSInvalid('JWS Payload missing');\n    }\n    if (typeof jws.signature !== 'string') {\n        throw new JWSInvalid('JWS Signature missing or incorrect type');\n    }\n    if (jws.header !== undefined && !isObject(jws.header)) {\n        throw new JWSInvalid('JWS Unprotected Header incorrect type');\n    }\n    let parsedProt = {};\n    if (jws.protected) {\n        try {\n            const protectedHeader = base64url(jws.protected);\n            parsedProt = JSON.parse(decoder.decode(protectedHeader));\n        }\n        catch {\n            throw new JWSInvalid('JWS Protected Header is invalid');\n        }\n    }\n    if (!isDisjoint(parsedProt, jws.header)) {\n        throw new JWSInvalid('JWS Protected and JWS Unprotected Header Parameter names must be disjoint');\n    }\n    const joseHeader = {\n        ...parsedProt,\n        ...jws.header,\n    };\n    const extensions = validateCrit(JWSInvalid, new Map([['b64', true]]), options?.crit, parsedProt, joseHeader);\n    let b64 = true;\n    if (extensions.has('b64')) {\n        b64 = parsedProt.b64;\n        if (typeof b64 !== 'boolean') {\n            throw new JWSInvalid('The \"b64\" (base64url-encode payload) Header Parameter must be a boolean');\n        }\n    }\n    const { alg } = joseHeader;\n    if (typeof alg !== 'string' || !alg) {\n        throw new JWSInvalid('JWS \"alg\" (Algorithm) Header Parameter missing or invalid');\n    }\n    const algorithms = options && validateAlgorithms('algorithms', options.algorithms);\n    if (algorithms && !algorithms.has(alg)) {\n        throw new JOSEAlgNotAllowed('\"alg\" (Algorithm) Header Parameter value not allowed');\n    }\n    if (b64) {\n        if (typeof jws.payload !== 'string') {\n            throw new JWSInvalid('JWS Payload must be a string');\n        }\n    }\n    else if (typeof jws.payload !== 'string' && !(jws.payload instanceof Uint8Array)) {\n        throw new JWSInvalid('JWS Payload must be a string or an Uint8Array instance');\n    }\n    let resolvedKey = false;\n    if (typeof key === 'function') {\n        key = await key(parsedProt, jws);\n        resolvedKey = true;\n        checkKeyTypeWithJwk(alg, key, 'verify');\n        if (isJWK(key)) {\n            key = await importJWK(key, alg);\n        }\n    }\n    else {\n        checkKeyTypeWithJwk(alg, key, 'verify');\n    }\n    const data = concat(encoder.encode(jws.protected ?? ''), encoder.encode('.'), typeof jws.payload === 'string' ? encoder.encode(jws.payload) : jws.payload);\n    let signature;\n    try {\n        signature = base64url(jws.signature);\n    }\n    catch {\n        throw new JWSInvalid('Failed to base64url decode the signature');\n    }\n    const verified = await verify(alg, key, signature, data);\n    if (!verified) {\n        throw new JWSSignatureVerificationFailed();\n    }\n    let payload;\n    if (b64) {\n        try {\n            payload = base64url(jws.payload);\n        }\n        catch {\n            throw new JWSInvalid('Failed to base64url decode the payload');\n        }\n    }\n    else if (typeof jws.payload === 'string') {\n        payload = encoder.encode(jws.payload);\n    }\n    else {\n        payload = jws.payload;\n    }\n    const result = { payload };\n    if (jws.protected !== undefined) {\n        result.protectedHeader = parsedProt;\n    }\n    if (jws.header !== undefined) {\n        result.unprotectedHeader = jws.header;\n    }\n    if (resolvedKey) {\n        return { ...result, key };\n    }\n    return result;\n}\n","import { JWTClaimValidationFailed, JWTExpired, JWTInvalid } from '../util/errors.js';\nimport { decoder } from './buffer_utils.js';\nimport epoch from './epoch.js';\nimport secs from './secs.js';\nimport isObject from './is_object.js';\nconst normalizeTyp = (value) => value.toLowerCase().replace(/^application\\//, '');\nconst checkAudiencePresence = (audPayload, audOption) => {\n    if (typeof audPayload === 'string') {\n        return audOption.includes(audPayload);\n    }\n    if (Array.isArray(audPayload)) {\n        return audOption.some(Set.prototype.has.bind(new Set(audPayload)));\n    }\n    return false;\n};\nexport default (protectedHeader, encodedPayload, options = {}) => {\n    let payload;\n    try {\n        payload = JSON.parse(decoder.decode(encodedPayload));\n    }\n    catch {\n    }\n    if (!isObject(payload)) {\n        throw new JWTInvalid('JWT Claims Set must be a top-level JSON object');\n    }\n    const { typ } = options;\n    if (typ &&\n        (typeof protectedHeader.typ !== 'string' ||\n            normalizeTyp(protectedHeader.typ) !== normalizeTyp(typ))) {\n        throw new JWTClaimValidationFailed('unexpected \"typ\" JWT header value', payload, 'typ', 'check_failed');\n    }\n    const { requiredClaims = [], issuer, subject, audience, maxTokenAge } = options;\n    const presenceCheck = [...requiredClaims];\n    if (maxTokenAge !== undefined)\n        presenceCheck.push('iat');\n    if (audience !== undefined)\n        presenceCheck.push('aud');\n    if (subject !== undefined)\n        presenceCheck.push('sub');\n    if (issuer !== undefined)\n        presenceCheck.push('iss');\n    for (const claim of new Set(presenceCheck.reverse())) {\n        if (!(claim in payload)) {\n            throw new JWTClaimValidationFailed(`missing required \"${claim}\" claim`, payload, claim, 'missing');\n        }\n    }\n    if (issuer &&\n        !(Array.isArray(issuer) ? issuer : [issuer]).includes(payload.iss)) {\n        throw new JWTClaimValidationFailed('unexpected \"iss\" claim value', payload, 'iss', 'check_failed');\n    }\n    if (subject && payload.sub !== subject) {\n        throw new JWTClaimValidationFailed('unexpected \"sub\" claim value', payload, 'sub', 'check_failed');\n    }\n    if (audience &&\n        !checkAudiencePresence(payload.aud, typeof audience === 'string' ? [audience] : audience)) {\n        throw new JWTClaimValidationFailed('unexpected \"aud\" claim value', payload, 'aud', 'check_failed');\n    }\n    let tolerance;\n    switch (typeof options.clockTolerance) {\n        case 'string':\n            tolerance = secs(options.clockTolerance);\n            break;\n        case 'number':\n            tolerance = options.clockTolerance;\n            break;\n        case 'undefined':\n            tolerance = 0;\n            break;\n        default:\n            throw new TypeError('Invalid clockTolerance option type');\n    }\n    const { currentDate } = options;\n    const now = epoch(currentDate || new Date());\n    if ((payload.iat !== undefined || maxTokenAge) && typeof payload.iat !== 'number') {\n        throw new JWTClaimValidationFailed('\"iat\" claim must be a number', payload, 'iat', 'invalid');\n    }\n    if (payload.nbf !== undefined) {\n        if (typeof payload.nbf !== 'number') {\n            throw new JWTClaimValidationFailed('\"nbf\" claim must be a number', payload, 'nbf', 'invalid');\n        }\n        if (payload.nbf > now + tolerance) {\n            throw new JWTClaimValidationFailed('\"nbf\" claim timestamp check failed', payload, 'nbf', 'check_failed');\n        }\n    }\n    if (payload.exp !== undefined) {\n        if (typeof payload.exp !== 'number') {\n            throw new JWTClaimValidationFailed('\"exp\" claim must be a number', payload, 'exp', 'invalid');\n        }\n        if (payload.exp <= now - tolerance) {\n            throw new JWTExpired('\"exp\" claim timestamp check failed', payload, 'exp', 'check_failed');\n        }\n    }\n    if (maxTokenAge) {\n        const age = now - payload.iat;\n        const max = typeof maxTokenAge === 'number' ? maxTokenAge : secs(maxTokenAge);\n        if (age - tolerance > max) {\n            throw new JWTExpired('\"iat\" claim timestamp check failed (too far in the past)', payload, 'iat', 'check_failed');\n        }\n        if (age < 0 - tolerance) {\n            throw new JWTClaimValidationFailed('\"iat\" claim timestamp check failed (it should be in the past)', payload, 'iat', 'check_failed');\n        }\n    }\n    return payload;\n};\n","import crypto from './webcrypto.js';\nconst digest = async (algorithm, data) => {\n    const subtleDigest = `SHA-${algorithm.slice(-3)}`;\n    return new Uint8Array(await crypto.subtle.digest(subtleDigest, data));\n};\nexport default digest;\n","import digest from '../runtime/digest.js';\nimport { encode as base64url } from '../runtime/base64url.js';\nimport { JOSENotSupported, JWKInvalid } from '../util/errors.js';\nimport { encoder } from '../lib/buffer_utils.js';\nimport isObject from '../lib/is_object.js';\nconst check = (value, description) => {\n    if (typeof value !== 'string' || !value) {\n        throw new JWKInvalid(`${description} missing or invalid`);\n    }\n};\nexport async function calculateJwkThumbprint(jwk, digestAlgorithm) {\n    if (!isObject(jwk)) {\n        throw new TypeError('JWK must be an object');\n    }\n    digestAlgorithm ?? (digestAlgorithm = 'sha256');\n    if (digestAlgorithm !== 'sha256' &&\n        digestAlgorithm !== 'sha384' &&\n        digestAlgorithm !== 'sha512') {\n        throw new TypeError('digestAlgorithm must one of \"sha256\", \"sha384\", or \"sha512\"');\n    }\n    let components;\n    switch (jwk.kty) {\n        case 'EC':\n            check(jwk.crv, '\"crv\" (Curve) Parameter');\n            check(jwk.x, '\"x\" (X Coordinate) Parameter');\n            check(jwk.y, '\"y\" (Y Coordinate) Parameter');\n            components = { crv: jwk.crv, kty: jwk.kty, x: jwk.x, y: jwk.y };\n            break;\n        case 'OKP':\n            check(jwk.crv, '\"crv\" (Subtype of Key Pair) Parameter');\n            check(jwk.x, '\"x\" (Public Key) Parameter');\n            components = { crv: jwk.crv, kty: jwk.kty, x: jwk.x };\n            break;\n        case 'RSA':\n            check(jwk.e, '\"e\" (Exponent) Parameter');\n            check(jwk.n, '\"n\" (Modulus) Parameter');\n            components = { e: jwk.e, kty: jwk.kty, n: jwk.n };\n            break;\n        case 'oct':\n            check(jwk.k, '\"k\" (Key Value) Parameter');\n            components = { k: jwk.k, kty: jwk.kty };\n            break;\n        default:\n            throw new JOSENotSupported('\"kty\" (Key Type) Parameter missing or unsupported');\n    }\n    const data = encoder.encode(JSON.stringify(components));\n    return base64url(await digest(digestAlgorithm, data));\n}\nexport async function calculateJwkThumbprintUri(jwk, digestAlgorithm) {\n    digestAlgorithm ?? (digestAlgorithm = 'sha256');\n    const thumbprint = await calculateJwkThumbprint(jwk, digestAlgorithm);\n    return `urn:ietf:params:oauth:jwk-thumbprint:sha-${digestAlgorithm.slice(-3)}:${thumbprint}`;\n}\n","import crypto from './webcrypto.js';\nimport { JOSENotSupported } from '../util/errors.js';\nimport random from './random.js';\nexport async function generateSecret(alg, options) {\n    let length;\n    let algorithm;\n    let keyUsages;\n    switch (alg) {\n        case 'HS256':\n        case 'HS384':\n        case 'HS512':\n            length = parseInt(alg.slice(-3), 10);\n            algorithm = { name: 'HMAC', hash: `SHA-${length}`, length };\n            keyUsages = ['sign', 'verify'];\n            break;\n        case 'A128CBC-HS256':\n        case 'A192CBC-HS384':\n        case 'A256CBC-HS512':\n            length = parseInt(alg.slice(-3), 10);\n            return random(new Uint8Array(length >> 3));\n        case 'A128KW':\n        case 'A192KW':\n        case 'A256KW':\n            length = parseInt(alg.slice(1, 4), 10);\n            algorithm = { name: 'AES-KW', length };\n            keyUsages = ['wrapKey', 'unwrapKey'];\n            break;\n        case 'A128GCMKW':\n        case 'A192GCMKW':\n        case 'A256GCMKW':\n        case 'A128GCM':\n        case 'A192GCM':\n        case 'A256GCM':\n            length = parseInt(alg.slice(1, 4), 10);\n            algorithm = { name: 'AES-GCM', length };\n            keyUsages = ['encrypt', 'decrypt'];\n            break;\n        default:\n            throw new JOSENotSupported('Invalid or unsupported JWK \"alg\" (Algorithm) Parameter value');\n    }\n    return crypto.subtle.generateKey(algorithm, options?.extractable ?? false, keyUsages);\n}\nfunction getModulusLengthOption(options) {\n    const modulusLength = options?.modulusLength ?? 2048;\n    if (typeof modulusLength !== 'number' || modulusLength < 2048) {\n        throw new JOSENotSupported('Invalid or unsupported modulusLength option provided, 2048 bits or larger keys must be used');\n    }\n    return modulusLength;\n}\nexport async function generateKeyPair(alg, options) {\n    let algorithm;\n    let keyUsages;\n    switch (alg) {\n        case 'PS256':\n        case 'PS384':\n        case 'PS512':\n            algorithm = {\n                name: 'RSA-PSS',\n                hash: `SHA-${alg.slice(-3)}`,\n                publicExponent: new Uint8Array([0x01, 0x00, 0x01]),\n                modulusLength: getModulusLengthOption(options),\n            };\n            keyUsages = ['sign', 'verify'];\n            break;\n        case 'RS256':\n        case 'RS384':\n        case 'RS512':\n            algorithm = {\n                name: 'RSASSA-PKCS1-v1_5',\n                hash: `SHA-${alg.slice(-3)}`,\n                publicExponent: new Uint8Array([0x01, 0x00, 0x01]),\n                modulusLength: getModulusLengthOption(options),\n            };\n            keyUsages = ['sign', 'verify'];\n            break;\n        case 'RSA-OAEP':\n        case 'RSA-OAEP-256':\n        case 'RSA-OAEP-384':\n        case 'RSA-OAEP-512':\n            algorithm = {\n                name: 'RSA-OAEP',\n                hash: `SHA-${parseInt(alg.slice(-3), 10) || 1}`,\n                publicExponent: new Uint8Array([0x01, 0x00, 0x01]),\n                modulusLength: getModulusLengthOption(options),\n            };\n            keyUsages = ['decrypt', 'unwrapKey', 'encrypt', 'wrapKey'];\n            break;\n        case 'ES256':\n            algorithm = { name: 'ECDSA', namedCurve: 'P-256' };\n            keyUsages = ['sign', 'verify'];\n            break;\n        case 'ES384':\n            algorithm = { name: 'ECDSA', namedCurve: 'P-384' };\n            keyUsages = ['sign', 'verify'];\n            break;\n        case 'ES512':\n            algorithm = { name: 'ECDSA', namedCurve: 'P-521' };\n            keyUsages = ['sign', 'verify'];\n            break;\n        case 'Ed25519':\n            algorithm = { name: 'Ed25519' };\n            keyUsages = ['sign', 'verify'];\n            break;\n        case 'EdDSA': {\n            keyUsages = ['sign', 'verify'];\n            const crv = options?.crv ?? 'Ed25519';\n            switch (crv) {\n                case 'Ed25519':\n                case 'Ed448':\n                    algorithm = { name: crv };\n                    break;\n                default:\n                    throw new JOSENotSupported('Invalid or unsupported crv option provided');\n            }\n            break;\n        }\n        case 'ECDH-ES':\n        case 'ECDH-ES+A128KW':\n        case 'ECDH-ES+A192KW':\n        case 'ECDH-ES+A256KW': {\n            keyUsages = ['deriveKey', 'deriveBits'];\n            const crv = options?.crv ?? 'P-256';\n            switch (crv) {\n                case 'P-256':\n                case 'P-384':\n                case 'P-521': {\n                    algorithm = { name: 'ECDH', namedCurve: crv };\n                    break;\n                }\n                case 'X25519':\n                case 'X448':\n                    algorithm = { name: crv };\n                    break;\n                default:\n                    throw new JOSENotSupported('Invalid or unsupported crv option provided, supported values are P-256, P-384, P-521, X25519, and X448');\n            }\n            break;\n        }\n        default:\n            throw new JOSENotSupported('Invalid or unsupported JWK \"alg\" (Algorithm) Parameter value');\n    }\n    return crypto.subtle.generateKey(algorithm, options?.extractable ?? false, keyUsages);\n}\n","import { generateKeyPair as generate } from '../runtime/generate.js';\nexport async function generateKeyPair(alg, options) {\n    return generate(alg, options);\n}\n","import * as base64url from '../runtime/base64url.js';\nexport const encode = base64url.encode;\nexport const decode = base64url.decode;\n","/**\n * solid-oidc.js - Minimal Solid-OIDC client for browsers\n *\n * A zero-build, single-file Solid-OIDC authentication library.\n *\n * @license MIT\n * @author JavaScriptSolidServer\n * @see https://github.com/JavaScriptSolidServer/solid-oidc\n *\n * Based on solid-oidc-client-browser by uvdsl (Christoph Braun)\n * @see https://github.com/uvdsl/solid-oidc-client-browser\n *\n * Implements:\n * - RFC 6749 - OAuth 2.0\n * - RFC 7636 - PKCE\n * - RFC 9207 - OAuth 2.0 Authorization Server Issuer Identification\n * - RFC 9449 - DPoP (Demonstration of Proof-of-Possession)\n * - Solid-OIDC Specification\n */\n\nimport {\n  SignJWT,\n  generateKeyPair,\n  decodeJwt,\n  exportJWK,\n  createRemoteJWKSet,\n  jwtVerify,\n  calculateJwkThumbprint\n} from 'jose'\n\n// ============================================================================\n// Session Events\n// ============================================================================\n\nexport const SessionEvents = {\n  STATE_CHANGE: 'sessionStateChange',\n  EXPIRATION_WARNING: 'sessionExpirationWarning',\n  EXPIRATION: 'sessionExpiration'\n}\n\n// ============================================================================\n// Session Database Interface (IndexedDB Implementation)\n// ============================================================================\n\nexport class SessionDatabase {\n  constructor(dbName = 'solid-oidc', storeName = 'session', dbVersion = 1) {\n    this.dbName = dbName\n    this.storeName = storeName\n    this.dbVersion = dbVersion\n    this.db = null\n  }\n\n  async init() {\n    return new Promise((resolve, reject) => {\n      const request = indexedDB.open(this.dbName, this.dbVersion)\n      request.onerror = () => reject(new Error(`Database error: ${request.error}`))\n      request.onsuccess = () => {\n        this.db = request.result\n        resolve(this)\n      }\n      request.onupgradeneeded = (event) => {\n        const db = event.target.result\n        if (!db.objectStoreNames.contains(this.storeName)) {\n          db.createObjectStore(this.storeName)\n        }\n      }\n    })\n  }\n\n  async setItem(id, value) {\n    if (!this.db) await this.init()\n    return new Promise((resolve, reject) => {\n      const tx = this.db.transaction(this.storeName, 'readwrite')\n      tx.oncomplete = () => resolve()\n      tx.onerror = () => reject(new Error(`Transaction error: ${tx.error}`))\n      tx.objectStore(this.storeName).put(value, id)\n    })\n  }\n\n  async getItem(id) {\n    if (!this.db) await this.init()\n    return new Promise((resolve, reject) => {\n      const tx = this.db.transaction(this.storeName, 'readonly')\n      tx.onerror = () => reject(new Error(`Transaction error: ${tx.error}`))\n      const request = tx.objectStore(this.storeName).get(id)\n      request.onsuccess = () => resolve(request.result || null)\n    })\n  }\n\n  async deleteItem(id) {\n    if (!this.db) await this.init()\n    return new Promise((resolve, reject) => {\n      const tx = this.db.transaction(this.storeName, 'readwrite')\n      tx.oncomplete = () => resolve()\n      tx.onerror = () => reject(new Error(`Transaction error: ${tx.error}`))\n      tx.objectStore(this.storeName).delete(id)\n    })\n  }\n\n  async clear() {\n    if (!this.db) await this.init()\n    return new Promise((resolve, reject) => {\n      const tx = this.db.transaction(this.storeName, 'readwrite')\n      tx.oncomplete = () => resolve()\n      tx.onerror = () => reject(new Error(`Transaction error: ${tx.error}`))\n      tx.objectStore(this.storeName).clear()\n    })\n  }\n\n  close() {\n    if (this.db) {\n      this.db.close()\n      this.db = null\n    }\n  }\n}\n\n// ============================================================================\n// PKCE Helper (RFC 7636)\n// ============================================================================\n\nasync function generatePKCE() {\n  const verifier = crypto.randomUUID() + '-' + crypto.randomUUID()\n  const digest = new Uint8Array(\n    await crypto.subtle.digest('SHA-256', new TextEncoder().encode(verifier))\n  )\n  const challenge = btoa(String.fromCharCode(...digest))\n    .replace(/\\+/g, '-')\n    .replace(/\\//g, '_')\n    .replace(/=+$/, '')\n  return { verifier, challenge }\n}\n\n// ============================================================================\n// DPoP Helper (RFC 9449)\n// ============================================================================\n\nasync function createDPoPToken(keyPair, htu, htm, ath = null) {\n  const publicJwk = await exportJWK(keyPair.publicKey)\n  const payload = { htu, htm }\n  if (ath) payload.ath = ath\n\n  return new SignJWT(payload)\n    .setIssuedAt()\n    .setJti(crypto.randomUUID())\n    .setProtectedHeader({ alg: 'ES256', typ: 'dpop+jwt', jwk: publicJwk })\n    .sign(keyPair.privateKey)\n}\n\nasync function computeAth(accessToken) {\n  const data = new TextEncoder().encode(accessToken)\n  const hashBuffer = await crypto.subtle.digest('SHA-256', data)\n  const hashArray = Array.from(new Uint8Array(hashBuffer))\n  return btoa(String.fromCharCode(...hashArray))\n    .replace(/\\+/g, '-')\n    .replace(/\\//g, '_')\n    .replace(/=+$/, '')\n}\n\n// ============================================================================\n// OIDC Discovery\n// ============================================================================\n\nasync function discoverOIDC(idp) {\n  const origin = new URL(idp).origin\n  const response = await fetch(`${origin}/.well-known/openid-configuration`)\n  if (!response.ok) throw new Error(`OIDC discovery failed: ${response.status}`)\n  return response.json()\n}\n\n// ============================================================================\n// Dynamic Client Registration\n// ============================================================================\n\nasync function registerClient(registrationEndpoint, redirectUris) {\n  const response = await fetch(registrationEndpoint, {\n    method: 'POST',\n    headers: { 'Content-Type': 'application/json' },\n    body: JSON.stringify({\n      application_type: 'web',\n      redirect_uris: redirectUris,\n      token_endpoint_auth_method: 'none',\n      grant_types: ['authorization_code', 'refresh_token'],\n      response_types: ['code'],\n      scope: 'openid offline_access webid'\n    })\n  })\n  if (!response.ok) throw new Error(`Client registration failed: ${response.status}`)\n  return response.json()\n}\n\n// ============================================================================\n// Token Request\n// ============================================================================\n\nasync function requestTokens(tokenEndpoint, params, keyPair) {\n  const dpop = await createDPoPToken(keyPair, tokenEndpoint, 'POST')\n  const response = await fetch(tokenEndpoint, {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/x-www-form-urlencoded',\n      'DPoP': dpop\n    },\n    body: new URLSearchParams(params)\n  })\n  if (!response.ok) throw new Error(`Token request failed: ${response.status}`)\n  return response.json()\n}\n\n// ============================================================================\n// Token Validation\n// ============================================================================\n\nasync function validateAccessToken(accessToken, jwksUri, issuer, clientId, keyPair) {\n  const jwks = createRemoteJWKSet(new URL(jwksUri))\n  const { payload } = await jwtVerify(accessToken, jwks, {\n    issuer,\n    audience: 'solid'\n  })\n\n  // Verify DPoP binding\n  const thumbprint = await calculateJwkThumbprint(await exportJWK(keyPair.publicKey))\n  if (payload.cnf?.jkt !== thumbprint) {\n    throw new Error('DPoP thumbprint mismatch')\n  }\n\n  // Verify client_id\n  if (payload.client_id !== clientId) {\n    throw new Error('client_id mismatch')\n  }\n\n  return payload\n}\n\n// ============================================================================\n// Refresh Token Grant\n// ============================================================================\n\nasync function refreshTokens(database) {\n  await database.init()\n\n  const [refreshToken, tokenEndpoint, clientId, keyPair] = await Promise.all([\n    database.getItem('refresh_token'),\n    database.getItem('token_endpoint'),\n    database.getItem('client_id'),\n    database.getItem('dpop_keypair')\n  ])\n\n  if (!refreshToken || !tokenEndpoint || !clientId || !keyPair) {\n    throw new Error('Missing refresh data')\n  }\n\n  const tokens = await requestTokens(tokenEndpoint, {\n    grant_type: 'refresh_token',\n    refresh_token: refreshToken,\n    client_id: clientId\n  }, keyPair)\n\n  // Persist new refresh token if provided\n  if (tokens.refresh_token) {\n    await database.setItem('refresh_token', tokens.refresh_token)\n  }\n\n  database.close()\n  return { ...tokens, dpop_key_pair: keyPair }\n}\n\n// ============================================================================\n// Main Session Class\n// ============================================================================\n\nexport class Session extends EventTarget {\n  constructor(options = {}) {\n    super()\n    this.clientId = options.clientId || null\n    this.database = options.database || new SessionDatabase()\n    this.onStateChange = options.onStateChange || null\n    this.onExpirationWarning = options.onExpirationWarning || null\n    this.onExpiration = options.onExpiration || null\n\n    // Internal state\n    this._isActive = false\n    this._webId = null\n    this._exp = null\n    this._ath = null\n    this._tokens = null\n    this._idpDetails = null\n    this._refreshPromise = null\n\n    // Set up event listeners\n    if (this.onStateChange) {\n      this.addEventListener(SessionEvents.STATE_CHANGE, this.onStateChange)\n    }\n    if (this.onExpirationWarning) {\n      this.addEventListener(SessionEvents.EXPIRATION_WARNING, this.onExpirationWarning)\n    }\n    if (this.onExpiration) {\n      this.addEventListener(SessionEvents.EXPIRATION, this.onExpiration)\n    }\n  }\n\n  // ==========================================================================\n  // Public API\n  // ==========================================================================\n\n  get isActive() { return this._isActive }\n  get webId() { return this._webId }\n\n  isExpired() {\n    if (!this._exp) return true\n    return Math.floor(Date.now() / 1000) >= this._exp\n  }\n\n  getExpiresIn() {\n    if (!this._exp) return -1\n    return this._exp - Math.floor(Date.now() / 1000)\n  }\n\n  /**\n   * Redirect user to identity provider for login\n   */\n  async login(idp, redirectUri) {\n    // Sanitize redirect URI (RFC 6749 Section 3.1.2)\n    const redirectUrl = new URL(redirectUri)\n    const sanitizedRedirect = redirectUrl.origin + redirectUrl.pathname + redirectUrl.search\n\n    // OIDC Discovery\n    const config = await discoverOIDC(idp)\n\n    // RFC 9207: Verify issuer\n    const issuer = config.issuer\n    const trimSlash = (s) => s.endsWith('/') ? s.slice(0, -1) : s\n    if (trimSlash(idp) !== trimSlash(issuer)) {\n      throw new Error(`Issuer mismatch: ${issuer} !== ${idp}`)\n    }\n\n    // Store IDP details\n    sessionStorage.setItem('solid_oidc_idp', issuer)\n    sessionStorage.setItem('solid_oidc_token_endpoint', config.token_endpoint)\n    sessionStorage.setItem('solid_oidc_jwks_uri', config.jwks_uri)\n\n    // Get or register client_id\n    let clientId = this.clientId\n    if (!clientId) {\n      const registration = await registerClient(config.registration_endpoint, [sanitizedRedirect])\n      clientId = registration.client_id\n      sessionStorage.setItem('solid_oidc_client_id', clientId)\n    }\n\n    // PKCE (RFC 7636)\n    const pkce = await generatePKCE()\n    sessionStorage.setItem('solid_oidc_pkce_verifier', pkce.verifier)\n\n    // CSRF token\n    const csrfToken = crypto.randomUUID()\n    sessionStorage.setItem('solid_oidc_csrf', csrfToken)\n\n    // Build authorization URL\n    const authUrl = new URL(config.authorization_endpoint)\n    authUrl.searchParams.set('response_type', 'code')\n    authUrl.searchParams.set('redirect_uri', sanitizedRedirect)\n    authUrl.searchParams.set('scope', 'openid offline_access webid')\n    authUrl.searchParams.set('client_id', clientId)\n    authUrl.searchParams.set('code_challenge_method', 'S256')\n    authUrl.searchParams.set('code_challenge', pkce.challenge)\n    authUrl.searchParams.set('state', csrfToken)\n    authUrl.searchParams.set('prompt', 'consent')\n\n    // Redirect to IDP\n    window.location.href = authUrl.toString()\n  }\n\n  /**\n   * Handle redirect from identity provider after login\n   */\n  async handleRedirectFromLogin() {\n    const url = new URL(window.location.href)\n    const code = url.searchParams.get('code')\n\n    // No code = not a redirect, nothing to do\n    if (!code) return\n\n    // RFC 9207: Verify issuer\n    const idp = sessionStorage.getItem('solid_oidc_idp')\n    const iss = url.searchParams.get('iss')\n    if (!idp || iss !== idp) {\n      throw new Error(`Issuer mismatch: ${iss} !== ${idp}`)\n    }\n\n    // RFC 6749: Verify CSRF token\n    const csrf = sessionStorage.getItem('solid_oidc_csrf')\n    if (url.searchParams.get('state') !== csrf) {\n      throw new Error('CSRF token mismatch')\n    }\n\n    // Clean URL\n    url.searchParams.delete('code')\n    url.searchParams.delete('iss')\n    url.searchParams.delete('state')\n    window.history.replaceState({}, document.title, url.toString())\n\n    // Get stored values\n    const pkceVerifier = sessionStorage.getItem('solid_oidc_pkce_verifier')\n    const tokenEndpoint = sessionStorage.getItem('solid_oidc_token_endpoint')\n    const jwksUri = sessionStorage.getItem('solid_oidc_jwks_uri')\n    const clientId = this.clientId || sessionStorage.getItem('solid_oidc_client_id')\n\n    if (!pkceVerifier || !tokenEndpoint || !clientId) {\n      throw new Error('Missing session data')\n    }\n\n    // Generate DPoP key pair\n    const keyPair = await generateKeyPair('ES256')\n\n    // Exchange code for tokens\n    const tokens = await requestTokens(tokenEndpoint, {\n      grant_type: 'authorization_code',\n      code,\n      code_verifier: pkceVerifier,\n      redirect_uri: url.origin + url.pathname,\n      client_id: clientId\n    }, keyPair)\n\n    // Validate access token\n    await validateAccessToken(tokens.access_token, jwksUri, idp, clientId, keyPair)\n\n    // Store IDP details\n    this._idpDetails = { idp, jwksUri, tokenEndpoint }\n\n    // Persist for refresh\n    await this.database.init()\n    await Promise.all([\n      this.database.setItem('idp', idp),\n      this.database.setItem('jwks_uri', jwksUri),\n      this.database.setItem('token_endpoint', tokenEndpoint),\n      this.database.setItem('client_id', clientId),\n      this.database.setItem('dpop_keypair', keyPair),\n      this.database.setItem('refresh_token', tokens.refresh_token)\n    ])\n    this.database.close()\n\n    // Clean session storage\n    sessionStorage.removeItem('solid_oidc_idp')\n    sessionStorage.removeItem('solid_oidc_token_endpoint')\n    sessionStorage.removeItem('solid_oidc_jwks_uri')\n    sessionStorage.removeItem('solid_oidc_client_id')\n    sessionStorage.removeItem('solid_oidc_pkce_verifier')\n    sessionStorage.removeItem('solid_oidc_csrf')\n\n    // Update session state\n    await this._setTokens({ ...tokens, dpop_key_pair: keyPair })\n    this._dispatchStateChange()\n  }\n\n  /**\n   * Restore session using stored refresh token\n   */\n  async restore() {\n    if (this._refreshPromise) return this._refreshPromise\n\n    this._refreshPromise = (async () => {\n      try {\n        const tokens = await refreshTokens(this.database)\n        await this._setTokens(tokens)\n        this._dispatchStateChange()\n      } catch (error) {\n        if (this._isActive) {\n          if (!this.isExpired()) {\n            this._dispatchExpirationWarning()\n          } else {\n            this._dispatchExpiration()\n          }\n        }\n        throw error\n      } finally {\n        this._refreshPromise = null\n      }\n    })()\n\n    return this._refreshPromise\n  }\n\n  /**\n   * Log out and clear all session data\n   */\n  async logout() {\n    this._isActive = false\n    this._webId = null\n    this._exp = null\n    this._ath = null\n    this._tokens = null\n    this._idpDetails = null\n\n    await this.database.init()\n    await this.database.clear()\n    this.database.close()\n\n    this._dispatchStateChange()\n  }\n\n  /**\n   * Make authenticated fetch request with DPoP\n   */\n  async authFetch(input, init = {}) {\n    // No session = regular fetch\n    if (!this._isActive) {\n      return fetch(input, init)\n    }\n\n    // Refresh if expired\n    if (this.isExpired()) {\n      await this.restore()\n    }\n\n    // Parse request\n    let url, method, headers\n    if (input instanceof Request) {\n      url = new URL(input.url)\n      method = init.method || input.method || 'GET'\n      headers = new Headers(input.headers)\n    } else {\n      url = new URL(input.toString())\n      method = init.method || 'GET'\n      headers = init.headers ? new Headers(init.headers) : new Headers()\n    }\n\n    // Create DPoP proof\n    const dpop = await createDPoPToken(\n      this._tokens.dpop_key_pair,\n      `${url.origin}${url.pathname}`,\n      method.toUpperCase(),\n      this._ath\n    )\n\n    // Set auth headers\n    headers.set('DPoP', dpop)\n    headers.set('Authorization', `DPoP ${this._tokens.access_token}`)\n\n    // Make request\n    if (input instanceof Request) {\n      return fetch(new Request(input, { ...init, headers }))\n    }\n    return fetch(url, { ...init, headers })\n  }\n\n  // ==========================================================================\n  // Internal Methods\n  // ==========================================================================\n\n  async _setTokens(tokens) {\n    this._tokens = tokens\n\n    const decoded = decodeJwt(tokens.access_token)\n    if (!decoded.webid) throw new Error('Missing webid claim')\n    if (!decoded.exp) throw new Error('Missing exp claim')\n\n    this._ath = await computeAth(tokens.access_token)\n    this._webId = decoded.webid\n    this._exp = decoded.exp\n    this._isActive = true\n  }\n\n  _dispatchStateChange() {\n    this.dispatchEvent(new CustomEvent(SessionEvents.STATE_CHANGE, {\n      detail: { isActive: this._isActive, webId: this._webId }\n    }))\n  }\n\n  _dispatchExpirationWarning() {\n    this.dispatchEvent(new CustomEvent(SessionEvents.EXPIRATION_WARNING, {\n      detail: { expires_in: this.getExpiresIn() }\n    }))\n  }\n\n  _dispatchExpiration() {\n    this.dispatchEvent(new CustomEvent(SessionEvents.EXPIRATION))\n  }\n}\n\n// ============================================================================\n// Default Export\n// ============================================================================\n\nexport default Session\n","import { compactVerify } from '../jws/compact/verify.js';\nimport jwtPayload from '../lib/jwt_claims_set.js';\nimport { JWTInvalid } from '../util/errors.js';\nexport async function jwtVerify(jwt, key, options) {\n    const verified = await compactVerify(jwt, key, options);\n    if (verified.protectedHeader.crit?.includes('b64') && verified.protectedHeader.b64 === false) {\n        throw new JWTInvalid('JWTs MUST NOT use unencoded payload');\n    }\n    const payload = jwtPayload(verified.protectedHeader, verified.payload, options);\n    const result = { payload, protectedHeader: verified.protectedHeader };\n    if (typeof key === 'function') {\n        return { ...result, key: verified.key };\n    }\n    return result;\n}\n","import { decode as base64url } from './base64url.js';\nimport { decoder } from '../lib/buffer_utils.js';\nimport isObject from '../lib/is_object.js';\nimport { JWTInvalid } from './errors.js';\nexport function decodeJwt(jwt) {\n    if (typeof jwt !== 'string')\n        throw new JWTInvalid('JWTs must use Compact JWS serialization, JWT must be a string');\n    const { 1: payload, length } = jwt.split('.');\n    if (length === 5)\n        throw new JWTInvalid('Only JWTs using Compact JWS serialization can be decoded');\n    if (length !== 3)\n        throw new JWTInvalid('Invalid JWT');\n    if (!payload)\n        throw new JWTInvalid('JWTs must contain a payload');\n    let decoded;\n    try {\n        decoded = base64url(payload);\n    }\n    catch {\n        throw new JWTInvalid('Failed to base64url decode the payload');\n    }\n    let result;\n    try {\n        result = JSON.parse(decoder.decode(decoded));\n    }\n    catch {\n        throw new JWTInvalid('Failed to parse the decoded payload as JSON');\n    }\n    if (!isObject(result))\n        throw new JWTInvalid('Invalid JWT Claims Set');\n    return result;\n}\n","/**\n * Adapter to make solid-oidc compatible with @inrupt/solid-client-authn-browser API\n *\n * This provides a drop-in replacement for the Inrupt Session class using the minimal\n * solid-oidc library from JavaScriptSolidServer.\n *\n * @see https://github.com/JavaScriptSolidServer/solid-oidc\n */\n\nimport {\n  Session as SolidOidcSession,\n  SessionDatabase\n} from 'solid-oidc'\n\n/**\n * Event names compatible with @inrupt/solid-client-authn-browser\n */\nexport const EVENTS = {\n  SESSION_RESTORED: 'sessionRestore',\n  LOGIN: 'login',\n  LOGOUT: 'logout',\n  SESSION_EXPIRED: 'sessionExpired',\n  ERROR: 'error'\n} as const\n\n/**\n * Callback type for event listeners\n */\ntype EventCallback = (...args: any[]) => void\n\n/**\n * Simple event emitter for compatibility with Inrupt's session.events API\n */\nclass EventEmitter {\n  private listeners: Map<string, Set<EventCallback>> = new Map()\n\n  on(event: string, callback: EventCallback): void {\n    if (!this.listeners.has(event)) {\n      this.listeners.set(event, new Set())\n    }\n    this.listeners.get(event)!.add(callback)\n  }\n\n  off(event: string, callback: EventCallback): void {\n    this.listeners.get(event)?.delete(callback)\n  }\n\n  emit(event: string, ...args: unknown[]): void {\n    this.listeners.get(event)?.forEach(cb => cb(...args))\n  }\n}\n\n/**\n * Session info interface compatible with Inrupt\n */\nexport interface SessionInfo {\n  isLoggedIn: boolean\n  webId?: string\n  sessionId?: string\n  expirationDate?: number\n}\n\n/**\n * Options for handleIncomingRedirect\n */\nexport interface HandleRedirectOptions {\n  restorePreviousSession?: boolean\n  url?: string\n}\n\n/**\n * Options for login\n */\nexport interface LoginOptions {\n  oidcIssuer: string\n  redirectUrl: string\n  clientId?: string\n  clientName?: string\n  tokenType?: string\n}\n\n/**\n * Session class that wraps solid-oidc to provide @inrupt/solid-client-authn-browser compatible API\n */\nexport class Session {\n  private _session: SolidOidcSession\n  private _events: EventEmitter\n  private _sessionId: string\n\n  constructor(options?: { clientId?: string }) {\n    this._session = new SolidOidcSession({\n      clientId: options?.clientId,\n      database: new SessionDatabase(),\n      onStateChange: (event) => {\n        const detail = (event as CustomEvent).detail\n        if (detail?.isActive) {\n          this._events.emit(EVENTS.LOGIN)\n          this._events.emit(EVENTS.SESSION_RESTORED, window.location.href)\n        } else {\n          this._events.emit(EVENTS.LOGOUT)\n        }\n      },\n      onExpiration: () => {\n        this._events.emit(EVENTS.SESSION_EXPIRED)\n      }\n    })\n    this._events = new EventEmitter()\n    this._sessionId = crypto.randomUUID()\n  }\n\n  /**\n   * Event emitter for session events\n   */\n  get events(): EventEmitter {\n    return this._events\n  }\n\n  /**\n   * Session information\n   */\n  get info(): SessionInfo {\n    return {\n      isLoggedIn: this._session.isActive,\n      webId: this._session.webId ?? undefined,\n      sessionId: this._sessionId,\n      expirationDate: this._session.isActive\n        ? Date.now() + (this._session.getExpiresIn() * 1000)\n        : undefined\n    }\n  }\n\n  /**\n   * Handle incoming redirect from identity provider\n   */\n  async handleIncomingRedirect(options?: HandleRedirectOptions | string): Promise<SessionInfo | undefined> {\n    // Handle string URL (legacy API)\n    const opts: HandleRedirectOptions = typeof options === 'string'\n      ? { url: options }\n      : options ?? {}\n\n    try {\n      // First handle any redirect from login\n      await this._session.handleRedirectFromLogin()\n\n      // If not logged in and restorePreviousSession is true, try to restore\n      if (!this._session.isActive && opts.restorePreviousSession !== false) {\n        try {\n          await this._session.restore()\n        } catch {\n          // No session to restore, that's okay\n        }\n      }\n\n      return this.info\n    } catch (error) {\n      this._events.emit(EVENTS.ERROR, error)\n      return undefined\n    }\n  }\n\n  /**\n   * Initiate login flow\n   */\n  async login(options: LoginOptions): Promise<void> {\n    const redirectUrl = options.redirectUrl || window.location.href\n    await this._session.login(options.oidcIssuer, redirectUrl)\n  }\n\n  /**\n   * Log out and clear session\n   */\n  async logout(): Promise<void> {\n    await this._session.logout()\n  }\n\n  /**\n   * Make authenticated fetch request\n   */\n  async fetch(url: RequestInfo | URL, init?: RequestInit): Promise<Response> {\n    return this._session.authFetch(url as string, init)\n  }\n}\n\nexport default Session\n","import { Session } from './solidOidcAdapter'\n\nexport const authSession = new Session()\n","// Namespaces we commonly use and have common prefixes for around Solid\nimport solidNamespace from 'solid-namespace' // Delegate to this which takes RDFlib as param.\nimport * as $rdf from 'rdflib'\n\nexport const ns = solidNamespace($rdf)","import { graph, NamedNode, Namespace, serialize, sym } from 'rdflib'\nimport { AclLogic } from '../types'\nimport { ns as namespace } from '../util/ns'\n\n\nexport const ACL_LINK = sym(\n    'http://www.iana.org/assignments/link-relations/acl'\n)\n\nexport function createAclLogic(store): AclLogic {\n\n    const ns = namespace\n    \n    async function findAclDocUrl(url: NamedNode) {\n        await store.fetcher.load(url)\n        const docNode = store.any(url, ACL_LINK)\n        if (!docNode) {\n            throw new Error(`No ACL link discovered for ${url}`)\n        }\n        return docNode.value\n    }\n    /**\n     * Simple Access Control\n     *\n     * This function sets up a simple default ACL for a resource, with\n     * RWC for the owner, and a specified access (default none) for the public.\n     * In all cases owner has read write control.\n     * Parameter lists modes allowed to public\n     *\n     * @param options\n     * @param options.public eg ['Read', 'Write']\n     *\n     * @returns Resolves with aclDoc uri on successful write\n     */\n    function setACLUserPublic ( \n    docURI: string,\n    me: NamedNode,\n    options: {\n        defaultForNew?: boolean,\n        public?: []\n    }\n    ): Promise<NamedNode> {\n    const aclDoc = store.any(\n        store.sym(docURI),\n        ACL_LINK\n    )\n\n    return Promise.resolve()\n        .then(() => {\n        if (aclDoc) {\n            return aclDoc as NamedNode\n        }\n\n        return fetchACLRel(docURI).catch(err => {\n            throw new Error(`Error fetching rel=ACL header for ${docURI}: ${err}`)\n        })\n        })\n        .then(aclDoc => {\n        const aclText = genACLText(docURI, me, aclDoc.uri, options)\n        if (!store.fetcher) {\n            throw new Error('Cannot PUT this, store has no fetcher')\n        }\n        return store.fetcher\n            .webOperation('PUT', aclDoc.uri, {\n            data: aclText,\n            contentType: 'text/turtle'\n            })\n            .then(result => {\n            if (!result.ok) {\n                throw new Error('Error writing ACL text: ' + result.error)\n            }\n\n            return aclDoc\n            })\n        })\n    }\n\n    /**\n     * @param docURI\n     * @returns\n     */\n    function fetchACLRel (docURI: string): Promise<NamedNode> {\n        const fetcher = store.fetcher\n        if (!fetcher) {\n            throw new Error('Cannot fetch ACL rel, store has no fetcher')\n        }\n\n        return fetcher.load(docURI).then(result => {\n            if (!result.ok) {\n                throw new Error('fetchACLRel: While loading:' + (result as any).error)\n            }\n\n            const aclDoc = store.any(\n            store.sym(docURI),\n            ACL_LINK\n            )\n\n            if (!aclDoc) {\n            throw new Error('fetchACLRel: No Link rel=ACL header for ' + docURI)\n            }\n\n            return aclDoc as NamedNode\n        })\n    }\n\n    /**\n     * @param docURI\n     * @param me\n     * @param aclURI\n     * @param options\n     *\n     * @returns Serialized ACL\n     */\n    function genACLText (\n    docURI: string,\n    me: NamedNode,\n    aclURI: string,\n    options: {\n            defaultForNew?: boolean,\n            public?: []\n        } = {}\n    ): string | undefined {\n        const optPublic = options.public || []\n        const g = graph()\n        const auth = Namespace('http://www.w3.org/ns/auth/acl#')\n        let a = g.sym(`${aclURI}#a1`)\n        const acl = g.sym(aclURI)\n        const doc = g.sym(docURI)\n        g.add(a, ns.rdf('type'), auth('Authorization'), acl)\n        g.add(a, auth('accessTo'), doc, acl)\n        if (options.defaultForNew) {\n            g.add(a, auth('default'), doc, acl)\n        }\n        g.add(a, auth('agent'), me, acl)\n        g.add(a, auth('mode'), auth('Read'), acl)\n        g.add(a, auth('mode'), auth('Write'), acl)\n        g.add(a, auth('mode'), auth('Control'), acl)\n\n        if (optPublic.length) {\n            a = g.sym(`${aclURI}#a2`)\n            g.add(a, ns.rdf('type'), auth('Authorization'), acl)\n            g.add(a, auth('accessTo'), doc, acl)\n            g.add(a, auth('agentClass'), ns.foaf('Agent'), acl)\n            for (let p = 0; p < optPublic.length; p++) {\n            g.add(a, auth('mode'), auth(optPublic[p]), acl) // Like 'Read' etc\n            }\n        }\n        return serialize(acl, g, aclURI)\n    }\n    return {\n        findAclDocUrl,\n        setACLUserPublic,\n        genACLText\n    }\n}","import { NamedNode, sym } from 'rdflib'\nimport * as debug from '../util/debug'\n\n/**\n * find a user or app's context as set in window.SolidAppContext\n * this is a const, not a function, because we have problems to jest mock it otherwise\n * see: https://github.com/facebook/jest/issues/936#issuecomment-545080082 for more\n * @return {any} - an appContext object\n */\nexport const appContext = ():any => {\n    let { SolidAppContext }: any = window\n    SolidAppContext ||= {}\n    SolidAppContext.viewingNoAuthPage = false\n    if (SolidAppContext.noAuth && window.document) {\n        const currentPage = window.document.location.href\n        if (currentPage.startsWith(SolidAppContext.noAuth)) {\n        SolidAppContext.viewingNoAuthPage = true\n        const params = new URLSearchParams(window.document.location.search)\n        if (params) {\n            let viewedPage = SolidAppContext.viewedPage = params.get('uri') || null\n            if (viewedPage) {\n            viewedPage = decodeURI(viewedPage)\n            if (!viewedPage.startsWith(SolidAppContext.noAuth)) {\n                const ary = viewedPage.split(/\\//)\n                SolidAppContext.idp = ary[0] + '//' + ary[2]\n                SolidAppContext.viewingNoAuthPage = false\n            }\n            }\n        }\n        }\n    }\n    return SolidAppContext\n}\n\n/**\n * Returns `sym($SolidTestEnvironment.username)` if\n * `$SolidTestEnvironment.username` is defined as a global\n * or \n * returns testID defined in the HTML page\n * @returns {NamedNode|null}\n */\nexport function offlineTestID (): NamedNode | null {\n    const { $SolidTestEnvironment }: any = window\n    if (\n      typeof $SolidTestEnvironment !== 'undefined' &&\n      $SolidTestEnvironment.username\n    ) {\n      // Test setup\n      debug.log('Assuming the user is ' + $SolidTestEnvironment.username)\n      return sym($SolidTestEnvironment.username)\n    }\n    // hack that makes SolidOS work in offline mode by adding the webId directly in html\n    // example usage: https://github.com/solidos/mashlib/blob/29b8b53c46bf02e0e219f0bacd51b0e9951001dd/test/contact/local.html#L37\n    if (\n      typeof document !== 'undefined' &&\n      document.location &&\n      ('' + document.location).slice(0, 16) === 'http://localhost'\n    ) {\n      const div = document.getElementById('appTarget')\n      if (!div) return null\n      const id = div.getAttribute('testID')\n      if (!id) return null\n      debug.log('Assuming user is ' + id)\n      return sym(id)\n    }\n    return null\n}\n","import { namedNode, NamedNode, sym } from 'rdflib'\nimport { appContext, offlineTestID } from './authUtil'\nimport * as debug from '../util/debug'\nimport { EVENTS, Session } from '../authSession/solidOidcAdapter'\nimport { AuthenticationContext, AuthnLogic } from '../types'\n\nexport class SolidAuthnLogic implements AuthnLogic {\n  private session: Session\n\n  constructor(solidAuthSession: Session) {\n    this.session = solidAuthSession\n  }\n\n  // we created authSession getter because we want to access it as authn.authSession externally\n  get authSession():Session { return this.session }\n\n  currentUser(): NamedNode | null {\n    const app = appContext()\n    if (app.viewingNoAuthPage) {\n      return sym(app.webId)\n    }\n    if (this && this.session && this.session.info && this.session.info.webId && this.session.info.isLoggedIn) {\n      return sym(this.session.info.webId)\n    }\n    return offlineTestID() // null unless testing\n  }\n\n  /**\n   * Retrieves currently logged in webId from either\n   * defaultTestUser or SolidAuth\n   * Also activates a session after login\n   * @param [setUserCallback] Optional callback\n   * @returns Resolves with webId uri, if no callback provided\n   */\n  async checkUser<T> (\n    setUserCallback?: (me: NamedNode | null) => T\n  ): Promise<NamedNode | T | null> {\n    // Save hash for \"restorePreviousSession\"\n    const preLoginRedirectHash = new URL(window.location.href).hash\n    if (preLoginRedirectHash) {\n      window.localStorage.setItem('preLoginRedirectHash', preLoginRedirectHash)\n    }\n    this.session.events.on(EVENTS.SESSION_RESTORED, (url) => {\n      debug.log(`Session restored to ${url}`)\n      if (document.location.toString() !== url) history.replaceState(null, '', url as string)\n    })\n\n    /**\n     * Handle a successful authentication redirect\n     */\n    const redirectUrl = new URL(window.location.href)\n    redirectUrl.hash = ''\n    await this.session\n      .handleIncomingRedirect({\n        restorePreviousSession: true,\n        url: redirectUrl.href\n      })\n\n    // Check to see if a hash was stored in local storage\n    const postLoginRedirectHash = window.localStorage.getItem('preLoginRedirectHash')\n    if (postLoginRedirectHash) {\n      const curUrl = new URL(window.location.href)\n      if (curUrl.hash !== postLoginRedirectHash) {\n        if (history.pushState) {\n          // debug.log('Setting window.location.has using pushState')\n          history.pushState(null, document.title, postLoginRedirectHash)\n        } else {\n          // debug.warn('Setting window.location.has using location.hash')\n          location.hash = postLoginRedirectHash\n        }\n        curUrl.hash = postLoginRedirectHash\n      }\n      // See https://stackoverflow.com/questions/3870057/how-can-i-update-window-location-hash-without-jumping-the-document\n      // window.location.href = curUrl.toString()// @@ See https://developer.mozilla.org/en-US/docs/Web/API/Window/location\n      window.localStorage.setItem('preLoginRedirectHash', '')\n    }\n\n    // Check to see if already logged in / have the WebID\n    let me = offlineTestID()\n    if (me) {\n      return Promise.resolve(setUserCallback ? setUserCallback(me) : me)\n    }\n\n    const webId = this.webIdFromSession(this.session.info)\n    if (webId) {\n      me = this.saveUser(webId)\n    }\n\n    if (me) {\n      debug.log(`(Logged in as ${me} by authentication)`)\n    }\n\n    return Promise.resolve(setUserCallback ? setUserCallback(me) : me)\n  }\n\n  /**\n   * Saves `webId` in `context.me`\n   * @param webId\n   * @param context\n   *\n   * @returns Returns the WebID, after setting it\n   */\n  saveUser (\n    webId: NamedNode | string | null,\n    context?: AuthenticationContext\n  ): NamedNode | null {\n    let webIdUri: string\n    if (webId) {\n      webIdUri = (typeof webId === 'string') ? webId : webId.uri\n      const me = namedNode(webIdUri)\n      if (context) {\n        context.me = me\n      }\n      return me\n    }\n    return null\n  }\n\n  /**\n   * @returns {Promise<string|null>} Resolves with WebID URI or null\n   */\n  webIdFromSession (session?: { webId?: string, isLoggedIn: boolean }): string | null {\n    const webId = session?.webId && session.isLoggedIn ? session.webId : null\n    return webId\n  }\n\n}\n","import { NamedNode, sym } from 'rdflib'\n\nexport function newThing(doc: NamedNode): NamedNode {\n    return sym(doc.uri + '#' + 'id' + ('' + Date.now()))\n}\n\nexport function uniqueNodes (arr: NamedNode[]): NamedNode[] {\n    const uris = arr.map(x => x.uri)\n    const set = new Set(uris)\n    const uris2 = Array.from(set)\n    const arr2 = uris2.map(u => new NamedNode(u))\n    return arr2 // Array.from(new Set(arr.map(x => x.uri))).map(u => sym(u))\n}\n\nexport function getArchiveUrl(baseUrl: string, date: Date) {\n    const year = date.getUTCFullYear()\n    const month = ('0' + (date.getUTCMonth()+1)).slice(-2)\n    const day = ('0' + (date.getUTCDate())).slice(-2)\n    const parts = baseUrl.split('/')\n    const filename = parts[parts.length -1 ]\n    return new URL(`./archive/${year}/${month}/${day}/${filename}`, baseUrl).toString()\n}\n\nexport function differentOrigin(doc): boolean {\n    if (!doc) {\n        return true\n    }\n    return (\n        `${window.location.origin}/` !== new URL(doc.value).origin\n    )\n}\n\nexport function suggestPreferencesFile (me:NamedNode) {\n    const stripped = me.uri.replace('/profile/', '/').replace('/public/', '/')\n    // const stripped = me.uri.replace(\\/[p|P]rofile/\\g, '/').replace(\\/[p|P]ublic/\\g, '/')\n    const folderURI = stripped.split('/').slice(0,-1).join('/') + '/Settings/'\n    const fileURI = folderURI + 'Preferences.ttl'\n    return sym(fileURI)\n}\n\nexport function determineChatContainer(\n    invitee: NamedNode,\n    podRoot: NamedNode\n): NamedNode {\n    // Create chat\n    // See https://gitter.im/solid/chat-app?at=5f3c800f855be416a23ae74a\n    const chatContainerStr = new URL(\n        `IndividualChats/${new URL(invitee.value).host}/`,\n        podRoot.value\n    ).toString()\n    return new NamedNode(chatContainerStr)\n}\n","import { NamedNode, Node, st, term } from 'rdflib'\nimport { ChatLogic, CreatedPaneOptions, NewPaneOptions, Chat } from '../types'\nimport { ns as namespace } from '../util/ns'\nimport { determineChatContainer, newThing } from '../util/utils'\n\nconst CHAT_LOCATION_IN_CONTAINER = 'index.ttl#this'\n\nexport function createChatLogic(store, profileLogic): ChatLogic {\n    const ns = namespace\n\n    async function setAcl(\n        chatContainer: NamedNode,\n        me: NamedNode,\n        invitee: NamedNode\n    ): Promise<void> {\n        // Some servers don't present a Link http response header\n        // if the container doesn't exist yet, so refetch the container\n        // now that it has been created:\n        await store.fetcher.load(chatContainer)\n\n        // FIXME: check the Why value on this quad:\n        const chatAclDoc = store.any(\n            chatContainer,\n            new NamedNode('http://www.iana.org/assignments/link-relations/acl')\n        )\n        if (!chatAclDoc) {\n            throw new Error('Chat ACL doc not found!')\n        }\n\n        const aclBody = `\n            @prefix acl: <http://www.w3.org/ns/auth/acl#>.\n            <#owner>\n            a acl:Authorization;\n            acl:agent <${me.value}>;\n            acl:accessTo <.>;\n            acl:default <.>;\n            acl:mode\n                acl:Read, acl:Write, acl:Control.\n            <#invitee>\n            a acl:Authorization;\n            acl:agent <${invitee.value}>;\n            acl:accessTo <.>;\n            acl:default <.>;\n            acl:mode\n                acl:Read, acl:Append.\n            `\n        await store.fetcher.webOperation('PUT', chatAclDoc.value, {\n            data: aclBody,\n            contentType: 'text/turtle',\n        })\n    }\n\n    async function addToPrivateTypeIndex(chatThing, me) {\n        // Add to private type index\n        const privateTypeIndex = store.any(\n            me,\n            ns.solid('privateTypeIndex')\n        ) as NamedNode | null\n        if (!privateTypeIndex) {\n            throw new Error('Private type index not found!')\n        }\n        await store.fetcher.load(privateTypeIndex)\n        const reg = newThing(privateTypeIndex)\n        const ins = [\n            st(\n                reg,\n                ns.rdf('type'),\n                ns.solid('TypeRegistration'),\n                privateTypeIndex.doc()\n            ),\n            st(\n                reg,\n                ns.solid('forClass'),\n                ns.meeting('LongChat'),\n                privateTypeIndex.doc()\n            ),\n            st(reg, ns.solid('instance'), chatThing, privateTypeIndex.doc()),\n        ]\n        await new Promise((resolve, reject) => {\n            store.updater.update([], ins, function (_uri, ok, errm) {\n                if (!ok) {\n                    reject(new Error(errm))\n                } else {\n                    resolve(null)\n                }\n            })\n        })\n    }\n\n    async function findChat(invitee: NamedNode): Promise<Chat> {\n        const me = await profileLogic.loadMe()\n        const podRoot = await profileLogic.getPodRoot(me)\n        const chatContainer = determineChatContainer(invitee, podRoot)\n        let exists = true\n        try {\n            await store.fetcher.load(\n                new NamedNode(chatContainer.value + 'index.ttl#this')\n            )\n        } catch (e) {\n            exists = false\n        }\n        return { me, chatContainer, exists }\n    }\n\n    async function createChatThing(\n        chatContainer: NamedNode,\n        me: NamedNode\n    ): Promise<NamedNode> {\n        const created = await mintNew({\n            me,\n            newBase: chatContainer.value,\n        })\n        return created.newInstance\n    }\n\n    function mintNew(newPaneOptions: NewPaneOptions): Promise<CreatedPaneOptions> {\n        const kb = store\n        const updater = kb.updater\n        if (newPaneOptions.me && !newPaneOptions.me.uri) {\n            throw new Error('chat mintNew:  Invalid userid ' + newPaneOptions.me)\n        }\n\n        const newInstance = (newPaneOptions.newInstance =\n            newPaneOptions.newInstance ||\n            kb.sym(newPaneOptions.newBase + CHAT_LOCATION_IN_CONTAINER))\n        const newChatDoc = newInstance.doc()\n\n        kb.add(\n            newInstance,\n            ns.rdf('type'),\n            ns.meeting('LongChat'),\n            newChatDoc\n        )\n        kb.add(newInstance, ns.dc('title'), 'Chat channel', newChatDoc)\n        kb.add(\n            newInstance,\n            ns.dc('created'),\n            term<Node>(new Date(Date.now())),\n            newChatDoc\n        )\n        if (newPaneOptions.me) {\n            kb.add(newInstance, ns.dc('author'), newPaneOptions.me, newChatDoc)\n        }\n\n        return new Promise(function (resolve, reject) {\n            updater?.put(\n                newChatDoc,\n                kb.statementsMatching(undefined, undefined, undefined, newChatDoc),\n                'text/turtle',\n                function (uri2, ok, message) {\n                    if (ok) {\n                        resolve({\n                            ...newPaneOptions,\n                            newInstance,\n                        })\n                    } else {\n                        reject(\n                            new Error(\n                                'FAILED to save new chat channel at: ' + uri2 + ' : ' + message\n                            )\n                        )\n                    }\n                }\n            )\n        })\n    }\n\n    /**\n     * Find (and optionally create) an individual chat between the current user and the given invitee\n     * @param invitee - The person to chat with\n     * @param createIfMissing - Whether the chat should be created, if missing\n     * @returns null if missing, or a node referring to an already existing chat, or the newly created chat\n     */\n    async function getChat(\n        invitee: NamedNode,\n        createIfMissing = true\n    ): Promise<NamedNode | null> {\n        const { me, chatContainer, exists } = await findChat(invitee)\n        if (exists) {\n            return new NamedNode(chatContainer.value + CHAT_LOCATION_IN_CONTAINER)\n        }\n\n        if (createIfMissing) {\n            const chatThing = await createChatThing(chatContainer, me)\n            await sendInvite(invitee, chatThing)\n            await setAcl(chatContainer, me, invitee)\n            await addToPrivateTypeIndex(chatThing, me)\n            return chatThing\n        }\n        return null\n    }\n\n    async function sendInvite(invitee: NamedNode, chatThing: NamedNode) {\n        await store.fetcher.load(invitee.doc())\n        const inviteeInbox = store.any(\n            invitee,\n            ns.ldp('inbox'),\n            undefined,\n            invitee.doc()\n        )\n        if (!inviteeInbox) {\n            throw new Error(`Invitee inbox not found! ${invitee.value}`)\n        }\n        const inviteBody = `\n        <> a <http://www.w3.org/ns/pim/meeting#LongChatInvite> ;\n        ${ns.rdf('seeAlso')} <${chatThing.value}> .\n        `\n\n        const inviteResponse = await store.fetcher?.webOperation(\n            'POST',\n            inviteeInbox.value,\n            {\n                data: inviteBody,\n                contentType: 'text/turtle',\n            }\n        )\n        const locationStr = inviteResponse?.headers.get('location')\n        if (!locationStr) {\n            throw new Error(`Invite sending returned a ${inviteResponse?.status}`)\n        }\n    }\n    return {\n        setAcl, addToPrivateTypeIndex, findChat, createChatThing, getChat, sendInvite, mintNew\n    }\n}\n","import { NamedNode } from 'rdflib'\nimport { InboxLogic } from '../types'\nimport { getArchiveUrl } from '../util/utils'\n\nexport function createInboxLogic(store, profileLogic, utilityLogic, containerLogic, aclLogic): InboxLogic {\n\n    async function createInboxFor(peerWebId: string, nick: string) {\n      const myWebId: NamedNode = await profileLogic.loadMe()\n      const podRoot: NamedNode = await profileLogic.getPodRoot(myWebId)\n      const ourInbox = `${podRoot.value}p2p-inboxes/${encodeURIComponent(nick)}/`\n      await containerLogic.createContainer(ourInbox)\n      // const aclDocUrl = await aclLogic.findAclDocUrl(ourInbox);\n      await utilityLogic.setSinglePeerAccess({\n        ownerWebId: myWebId.value,\n        peerWebId,\n        accessToModes: 'acl:Append',\n        target: ourInbox\n      })\n      return ourInbox\n  }\n\n  async function getNewMessages(\n      user?: NamedNode\n    ): Promise<NamedNode[]> {\n      if (!user) {\n        user = await profileLogic.loadMe()\n      }\n      const inbox = await profileLogic.getMainInbox(user)\n      const urls = await containerLogic.getContainerMembers(inbox)\n      return urls.filter(url => !containerLogic.isContainer(url))\n  }\n\n  async function markAsRead(url: string, date: Date) {\n    const downloaded = await store.fetcher._fetch(url)\n    if (downloaded.status !== 200) {\n      throw new Error(`Not OK! ${url}`)\n    }\n    const archiveUrl = getArchiveUrl(url, date)\n    const options = {\n      method: 'PUT',\n      body: await downloaded.text(),\n      headers: [\n        ['Content-Type', downloaded.headers.get('Content-Type') || 'application/octet-stream']\n      ]\n    }\n    const uploaded = await store.fetcher._fetch(archiveUrl, options)\n    if (uploaded.status.toString()[0] === '2') {\n      await store.fetcher._fetch(url, {\n        method: 'DELETE'\n      })\n    }\n  }\n  return {\n    createInboxFor,\n    getNewMessages,\n    markAsRead\n  }\n}\n","class CustomError extends Error {\n    constructor(message?: string) {\n        super(message)\n        // see: typescriptlang.org/docs/handbook/release-notes/typescript-2-2.html\n        Object.setPrototypeOf(this, new.target.prototype) // restore prototype chain\n        this.name = new.target.name // stack traces display correctly now\n    }\n}\n\nexport class UnauthorizedError extends CustomError {}\n\nexport class CrossOriginForbiddenError extends CustomError {}\n\nexport class SameOriginForbiddenError extends CustomError {}\n\nexport class NotFoundError extends CustomError {}\n\nexport class NotEditableError extends CustomError { }\n\nexport class WebOperationError extends CustomError {}\n\nexport class FetchError extends CustomError {\n    status: number\n\n    constructor(status: number, message?: string) {\n        super(message)\n        this.status = status\n    }\n}","import { NamedNode } from 'rdflib'\nimport { CrossOriginForbiddenError, FetchError, NotEditableError, SameOriginForbiddenError, UnauthorizedError, WebOperationError } from '../logic/CustomError'\nimport * as debug from '../util/debug'\nimport { ns as namespace } from '../util/ns'\nimport { differentOrigin, suggestPreferencesFile } from '../util/utils'\nimport { ProfileLogic } from '../types'\n\nexport function createProfileLogic(store, authn, utilityLogic): ProfileLogic {\n    const ns = namespace\n\n    /**\n     * loads the preference without throwing errors - if it can create it it does so.\n     * remark: it still throws error if it cannot load profile.\n     * @param user\n     * @returns undefined if preferenceFile cannot be returned or NamedNode if it can find it or create it\n     */\n    async function silencedLoadPreferences(user: NamedNode): Promise <NamedNode | undefined> {\n        try {\n            return await loadPreferences(user)\n        } catch (err) {\n            return undefined\n        }\n    }\n\n    /**\n     * loads the preference without returning different errors if it cannot create or load it.\n     * remark: it also throws error if it cannot load profile.\n     * @param user\n     * @returns undefined if preferenceFile cannot be an Error or NamedNode if it can find it or create it\n     */\n    async function loadPreferences (user: NamedNode): Promise <NamedNode> {\n        await loadProfile(user)\n\n        const possiblePreferencesFile = suggestPreferencesFile(user)\n        let preferencesFile\n        try {\n            preferencesFile = await utilityLogic.followOrCreateLink(user, ns.space('preferencesFile') as NamedNode, possiblePreferencesFile, user.doc())\n        } catch (err) {\n            const message = `User ${user} has no pointer in profile to preferences file.`\n            debug.warn(message)\n            // we are listing the possible errors\n            if (err instanceof NotEditableError) { throw err }\n            if (err instanceof WebOperationError) { throw err }\n            if (err instanceof UnauthorizedError) { throw err }\n            if (err instanceof CrossOriginForbiddenError) { throw err }\n            if (err instanceof SameOriginForbiddenError) { throw err }\n            if (err instanceof FetchError) { throw err }\n            throw err\n        }\n\n        try {\n            await store.fetcher.load(preferencesFile as NamedNode)\n        } catch (err) { // Maybe a permission problem or origin problem\n            const msg = `Unable to load preference of user ${user}: ${err}`\n            debug.warn(msg)\n            if (err.response.status === 401) {\n                throw new UnauthorizedError()\n            }\n            if (err.response.status === 403) {\n                if (differentOrigin(preferencesFile)) {\n                throw new CrossOriginForbiddenError()\n                }\n                throw new SameOriginForbiddenError()\n            }\n            /*if (err.response.status === 404) {\n                throw new NotFoundError();\n            }*/\n            throw new Error(msg)\n        }\n        return preferencesFile as NamedNode\n    }\n\n    async function loadProfile (user: NamedNode):Promise <NamedNode> {\n        if (!user) {\n            throw new Error('loadProfile: no user given.')\n        }\n        try {\n            await store.fetcher.load(user.doc())\n        } catch (err) {\n            throw new Error(`Unable to load profile of user ${user}: ${err}`)\n        }\n        return user.doc()\n    }\n\n    async function loadMe(): Promise<NamedNode> {\n        const me = authn.currentUser()\n        if (me === null) {\n            throw new Error('Current user not found! Not logged in?')\n        }\n        await store.fetcher.load(me.doc())\n        return me\n    }\n\n    function getPodRoot(user: NamedNode): NamedNode {\n        const podRoot = findStorage(user)\n        if (!podRoot) {\n            throw new Error('User pod root not found!')\n        }\n        return podRoot as NamedNode\n    }\n\n    async function getMainInbox(user: NamedNode): Promise<NamedNode> {\n        await store.fetcher.load(user)\n        const mainInbox = store.any(user, ns.ldp('inbox'), undefined, user.doc())\n        if (!mainInbox) {\n            throw new Error('User main inbox not found!')\n        }\n        return mainInbox as NamedNode\n    }\n\n    function findStorage(me: NamedNode) {\n        return store.any(me, ns.space('storage'), undefined, me.doc())\n    }\n\n    return {\n        loadMe,\n        getPodRoot,\n        getMainInbox,\n        findStorage,\n        loadPreferences,\n        loadProfile,\n        silencedLoadPreferences\n    }\n}\n","import { NamedNode, st, sym } from 'rdflib'\nimport { ScopedApp, TypeIndexLogic, TypeIndexScope } from '../types'\nimport * as debug from '../util/debug'\nimport { ns as namespace } from '../util/ns'\nimport { newThing } from '../util/utils'\n\nexport function createTypeIndexLogic(store, authn, profileLogic, utilityLogic): TypeIndexLogic {\n    const ns = namespace\n\n    function getRegistrations(instance, theClass) {\n        return store\n            .each(undefined, ns.solid('instance'), instance)\n            .filter((r) => {\n                return store.holds(r, ns.solid('forClass'), theClass)\n            })\n    }\n\n    async function loadTypeIndexesFor(user: NamedNode): Promise<Array<TypeIndexScope>> {\n        if (!user) throw new Error('loadTypeIndexesFor: No user given')\n        const profile = await profileLogic.loadProfile(user)\n\n        const suggestion = suggestPublicTypeIndex(user)\n        let publicTypeIndex\n        try {\n            publicTypeIndex = await utilityLogic.followOrCreateLink(user, ns.solid('publicTypeIndex') as NamedNode, suggestion, profile)\n        } catch (err) {\n            const message = `User ${user} has no pointer in profile to publicTypeIndex file.`\n            debug.warn(message)\n        }\n        const publicScopes = publicTypeIndex ? [{ label: 'public', index: publicTypeIndex as NamedNode, agent: user }] : []\n\n        let preferencesFile\n        try {\n            preferencesFile = await profileLogic.silencedLoadPreferences(user)\n        } catch (err) {\n            preferencesFile = null\n        }\n\n        let privateScopes\n        if (preferencesFile) { // watch out - can be in either as spec was not clear.  Legacy is profile.\n            // If there is a legacy one linked from the profile, use that.\n            // Otherwiae use or make one linked from Preferences\n            const suggestedPrivateTypeIndex = suggestPrivateTypeIndex(preferencesFile)\n            let privateTypeIndex\n            try {\n                privateTypeIndex = store.any(user, ns.solid('privateTypeIndex'), undefined, profile) ||\n                    await utilityLogic.followOrCreateLink(user, ns.solid('privateTypeIndex') as NamedNode, suggestedPrivateTypeIndex, preferencesFile)\n                } catch (err) {\n                const message = `User ${user} has no pointer in preference file to privateTypeIndex file.`\n                debug.warn(message)\n            }\n            privateScopes = privateTypeIndex ? [{ label: 'private', index: privateTypeIndex as NamedNode, agent: user }] : []\n        } else {\n            privateScopes = []\n        }\n        const scopes = publicScopes.concat(privateScopes)\n        if (scopes.length === 0) return scopes\n        const files = scopes.map(scope => scope.index)\n        try {\n            await store.fetcher.load(files)\n        } catch (err) {\n            debug.warn('Problems loading type index: ', err)\n        }\n        return scopes\n    }\n\n    async function loadCommunityTypeIndexes(user: NamedNode): Promise<TypeIndexScope[][]> {\n        let preferencesFile\n        try {\n            preferencesFile = await profileLogic.silencedLoadPreferences(user)\n        } catch (err) {\n            const message = `User ${user} has no pointer in profile to preferences file.`\n            debug.warn(message)\n        }\n        if (preferencesFile) { // For now, pick up communities as simple links from the preferences file.\n            const communities = store.each(user, ns.solid('community'), undefined, preferencesFile as NamedNode).concat(\n                store.each(user, ns.solid('community'), undefined, user.doc() as NamedNode)\n            )\n            let result = []\n            for (const org of communities) {\n                result = result.concat(await loadTypeIndexesFor(org as NamedNode) as any)\n            }\n            return result\n        }\n        return [] // No communities\n    }\n\n    async function loadAllTypeIndexes(user: NamedNode) {\n        return (await loadTypeIndexesFor(user)).concat((await loadCommunityTypeIndexes(user)).flat())\n    }\n\n    async function getScopedAppInstances(klass: NamedNode, user: NamedNode): Promise<ScopedApp[]> {\n        const scopes = await loadAllTypeIndexes(user)\n        let scopedApps = []\n        for (const scope of scopes) {\n            const scopedApps0 = await getScopedAppsFromIndex(scope, klass) as any\n            scopedApps = scopedApps.concat(scopedApps0)\n        }\n        return scopedApps\n    }\n\n    // This is the function signature which used to be in solid-ui/logic\n    // Recommended to use getScopedAppInstances instead as it provides more information.\n    //\n    async function getAppInstances(klass: NamedNode): Promise<NamedNode[]> {\n        const user = authn.currentUser()\n        if (!user) throw new Error('getAppInstances: Must be logged in to find apps.')\n        const scopedAppInstances = await getScopedAppInstances(klass, user)\n        return scopedAppInstances.map(scoped => scoped.instance)\n    }\n\n    function suggestPublicTypeIndex(me: NamedNode) {\n        return sym(me.doc().dir()?.uri + 'publicTypeIndex.ttl')\n    }\n    // Note this one is based off the pref file not the profile\n\n    function suggestPrivateTypeIndex(preferencesFile: NamedNode) {\n        return sym(preferencesFile.doc().dir()?.uri + 'privateTypeIndex.ttl')\n    }\n\n    /*\n    * Register a new app in a type index\n    * used in chat in bookmark.js (solid-ui)\n    * Returns the registration object if successful else null\n    */\n    async function registerInTypeIndex(\n        instance: NamedNode,\n        index: NamedNode,\n        theClass: NamedNode,\n        // agent: NamedNode\n    ): Promise<NamedNode | null> {\n        const registration = newThing(index)\n        const ins = [\n            // See https://github.com/solid/solid/blob/main/proposals/data-discovery.md\n            st(registration, ns.rdf('type'), ns.solid('TypeRegistration'), index),\n            st(registration, ns.solid('forClass'), theClass, index),\n            st(registration, ns.solid('instance'), instance, index)\n        ]\n        try {\n            await store.updater.update([], ins)\n        } catch (err) {\n            const msg = `Unable to register ${instance} in index ${index}: ${err}`\n            console.warn(msg)\n            return null\n        }\n        return registration\n    }\n\n    async function deleteTypeIndexRegistration(item) {\n        const reg = store.the(null, ns.solid('instance'), item.instance, item.scope.index) as NamedNode\n        if (!reg) throw new Error(`deleteTypeIndexRegistration: No registration found for ${item.instance}`)\n        const statements = store.statementsMatching(reg, null, null, item.scope.index)\n        await store.updater.update(statements, [])\n    }\n\n    async function getScopedAppsFromIndex(scope: TypeIndexScope, theClass: NamedNode | null): Promise<ScopedApp[]> {\n        const index = scope.index\n        const results: ScopedApp[] = []\n        const registrations = store.statementsMatching(null, ns.solid('instance'), null, index)\n            .concat(store.statementsMatching(null, ns.solid('instanceContainer'), null, index))\n            .map(st => st.subject)\n        for (const reg of registrations) {\n          const klass = store.any(reg, ns.solid('forClass'), null, index)\n          if (!theClass || klass.sameTerm(theClass)) {\n            const instances = store.each(reg, ns.solid('instance'), null, index)\n            for (const instance of instances) {\n              results.push({ instance, type: klass, scope })\n            }\n            const containers = store.each(reg, ns.solid('instanceContainer'), null, index)\n            for (const instance of containers) {\n                await store.fetcher.load(instance)\n                results.push({ instance: sym(instance.value), type: klass,  scope })\n            }\n          }\n        }\n        return results\n    }\n\n    return {\n        registerInTypeIndex,\n        getRegistrations,\n        loadTypeIndexesFor,\n        loadCommunityTypeIndexes,\n        loadAllTypeIndexes,\n        getScopedAppInstances,\n        getAppInstances,\n        suggestPublicTypeIndex,\n        suggestPrivateTypeIndex,\n        deleteTypeIndexRegistration,\n        getScopedAppsFromIndex\n    }\n}\n","import { Session } from '../authSession/solidOidcAdapter'\nimport * as rdf from 'rdflib'\nimport { LiveStore, NamedNode, Statement } from 'rdflib'\nimport { createAclLogic } from '../acl/aclLogic'\nimport { SolidAuthnLogic } from '../authn/SolidAuthnLogic'\nimport { createChatLogic } from '../chat/chatLogic'\nimport { createInboxLogic } from '../inbox/inboxLogic'\nimport { createProfileLogic } from '../profile/profileLogic'\nimport { createTypeIndexLogic } from '../typeIndex/typeIndexLogic'\nimport { createContainerLogic } from '../util/containerLogic'\nimport { createUtilityLogic } from '../util/utilityLogic'\nimport { AuthnLogic, SolidLogic } from '../types'\nimport * as debug from '../util/debug'\n/*\n** It is important to distinquish `fetch`, a function provided by the browser\n** and `Fetcher`, a helper object for the rdflib Store which turns it\n** into a `ConnectedStore` or a `LiveStore`.  A Fetcher object is\n** available at store.fetcher, and `fetch` function at `store.fetcher._fetch`,\n*/\nexport function createSolidLogic(specialFetch: { fetch: (url: any, requestInit: any) => any }, session: Session): SolidLogic {\n\n    debug.log('SolidLogic: Unique instance created.  There should only be one of these.')\n    const store: LiveStore = rdf.graph() as LiveStore\n    rdf.fetcher(store, {fetch: specialFetch.fetch}) // Attach a web I/O module, store.fetcher\n    store.updater = new rdf.UpdateManager(store) // Add real-time live updates store.updater\n    store.features = [] // disable automatic node merging on store load\n\n    const authn: AuthnLogic = new SolidAuthnLogic(session)\n    \n    const acl = createAclLogic(store)\n    const containerLogic = createContainerLogic(store)\n    const utilityLogic = createUtilityLogic(store, acl, containerLogic)\n    const profile = createProfileLogic(store, authn, utilityLogic)\n    const chat = createChatLogic(store, profile)\n    const inbox = createInboxLogic(store, profile, utilityLogic, containerLogic, acl)\n    const typeIndex = createTypeIndexLogic(store, authn, profile, utilityLogic)\n    debug.log('SolidAuthnLogic initialized')\n\n    function load(doc: NamedNode | NamedNode[] | string) {\n        return store.fetcher.load(doc)\n    }\n\n    // @@@@ use the one in rdflib.js when it is available and delete this\n    function updatePromise(\n        del: Array<Statement>,\n        ins: Array<Statement> = []\n    ): Promise<void> {\n        return new Promise((resolve, reject) => {\n        store.updater.update(del, ins, function (_uri, ok, errorBody) {\n            if (!ok) {\n            reject(new Error(errorBody))\n            } else {\n            resolve()\n            }\n        }) // callback\n        }) // promise\n    }\n\n    function clearStore() {\n        store.statements.slice().forEach(store.remove.bind(store))\n    }\n\n    return {\n        store,\n        authn,\n        acl,\n        inbox,\n        chat,\n        profile,\n        typeIndex,\n        load,\n        updatePromise,\n        clearStore\n    }\n}\n","import { NamedNode, Statement, sym } from 'rdflib'\n\n/**\n * Container-related class\n */\nexport function createContainerLogic(store) {\n\n    function getContainerElements(containerNode: NamedNode): NamedNode[] {\n        return store\n            .statementsMatching(\n                containerNode,\n                sym('http://www.w3.org/ns/ldp#contains'),\n                undefined\n            )\n            .map((st: Statement) => st.object as NamedNode)\n    }\n\n    function isContainer(url: NamedNode) {\n        const nodeToString = url.value\n        return nodeToString.charAt(nodeToString.length - 1) === '/'\n    }\n\n    async function createContainer(url: string) {\n        const stringToNode = sym(url)\n        if (!isContainer(stringToNode)) {\n            throw new Error(`Not a container URL ${url}`)\n        }\n        // Copied from https://github.com/solidos/solid-crud-tests/blob/v3.1.0/test/surface/create-container.test.ts#L56-L64\n        const result = await store.fetcher._fetch(url, {\n            method: 'PUT',\n            headers: {\n                'Content-Type': 'text/turtle',\n                'If-None-Match': '*',\n                Link: '<http://www.w3.org/ns/ldp#BasicContainer>; rel=\"type\"', // See https://github.com/solidos/node-solid-server/issues/1465\n            },\n            body: ' ', // work around https://github.com/michielbdejong/community-server/issues/4#issuecomment-776222863\n        })\n        if (result.status.toString()[0] !== '2') {\n            throw new Error(`Not OK: got ${result.status} response while creating container at ${url}`)\n        }\n    }\n\n    async function getContainerMembers(containerUrl: NamedNode): Promise<NamedNode[]> {\n        await store.fetcher.load(containerUrl)\n        return getContainerElements(containerUrl)\n    }\n    return {\n        isContainer,\n        createContainer,\n        getContainerElements,\n        getContainerMembers\n    }\n}","import { NamedNode, st, sym } from 'rdflib'\nimport { CrossOriginForbiddenError, FetchError, NotEditableError, SameOriginForbiddenError, UnauthorizedError, WebOperationError } from '../logic/CustomError'\nimport * as debug from '../util/debug'\nimport { differentOrigin } from './utils'\n\nexport function createUtilityLogic(store, aclLogic, containerLogic) {\n\n  async function recursiveDelete(containerNode: NamedNode) {\n      try {\n        if (containerLogic.isContainer(containerNode)) {\n          const aclDocUrl = await aclLogic.findAclDocUrl(containerNode)\n          await store.fetcher._fetch(aclDocUrl, { method: 'DELETE' })\n          const containerMembers = await containerLogic.getContainerMembers(containerNode)\n          await Promise.all(\n            containerMembers.map((url) => recursiveDelete(url))\n          )\n        }\n        const nodeToStringHere = containerNode.value\n        return store.fetcher._fetch(nodeToStringHere, { method: 'DELETE' })\n      } catch (e) {\n        debug.log(`Please manually remove ${containerNode.value} from your system.`, e)\n      }\n  }\n\n  /**\n   * Create a resource if it really does not exist\n   * Be absolutely sure something does not exist before creating a new empty file\n   * as otherwise existing could  be deleted.\n   * @param doc {NamedNode} - The resource\n   */\n  async function loadOrCreateIfNotExists(doc: NamedNode) {\n    let response\n    try {\n      response = await store.fetcher.load(doc)\n    } catch (err) {\n      if (err.response.status === 404) {\n        try {\n          await store.fetcher.webOperation('PUT', doc, { data: '', contentType: 'text/turtle' })\n        } catch (err) {\n          const msg = 'createIfNotExists: PUT FAILED: ' + doc + ': ' + err\n          throw new WebOperationError(msg)\n        }\n        await store.fetcher.load(doc)\n      } else {\n        if (err.response.status === 401) {\n          throw new UnauthorizedError()\n        }\n        if (err.response.status === 403) {\n          if (differentOrigin(doc)) {\n            throw new CrossOriginForbiddenError()\n          }\n          throw new SameOriginForbiddenError()\n        }\n        const msg = 'createIfNotExists doc load error NOT 404:  ' + doc + ': ' + err\n        throw new FetchError(err.status, err.message + msg)\n      }\n    }\n    return response\n  }\n\n  /* Follow link from this doc to another thing, or else make a new link\n  **\n  ** @returns existing object, or creates it if non existent\n  */\n  async function followOrCreateLink(subject: NamedNode, predicate: NamedNode,\n    object: NamedNode, doc: NamedNode\n  ): Promise<NamedNode | null> {\n    await store.fetcher.load(doc)\n    const result = store.any(subject, predicate, null, doc)\n\n    if (result) return result as NamedNode\n    if (!store.updater.editable(doc)) {\n      const msg = `followOrCreateLink: cannot edit ${doc.value}`\n      debug.warn(msg)\n      throw new NotEditableError(msg)\n    }\n    try {\n      await store.updater.update([], [st(subject, predicate, object, doc)])\n    } catch (err) {\n      const msg = `followOrCreateLink: Error making link in ${doc} to ${object}: ${err}`\n      debug.warn(msg)\n      throw new WebOperationError(err)\n    }\n\n    try {\n      await loadOrCreateIfNotExists(object)\n      // store.fetcher.webOperation('PUT', object, { data: '', contentType: 'text/turtle'})\n    } catch (err) {\n      debug.warn(`followOrCreateLink: Error loading or saving new linked document: ${object}: ${err}`)\n      throw err\n    }\n    return object\n  }\n\n  // Copied from https://github.com/solidos/web-access-control-tests/blob/v3.0.0/test/surface/delete.test.ts#L5\n  async function setSinglePeerAccess(options: {\n    ownerWebId: string,\n    peerWebId: string,\n    accessToModes?: string,\n    defaultModes?: string,\n    target: string\n  }) {\n    let str = [\n      '@prefix acl: <http://www.w3.org/ns/auth/acl#>.',\n      '',\n      `<#alice> a acl:Authorization;\\n  acl:agent <${options.ownerWebId}>;`,\n      `  acl:accessTo <${options.target}>;`,\n      `  acl:default <${options.target}>;`,\n      '  acl:mode acl:Read, acl:Write, acl:Control.',\n      ''\n    ].join('\\n')\n    if (options.accessToModes) {\n      str += [\n        '<#bobAccessTo> a acl:Authorization;',\n        `  acl:agent <${options.peerWebId}>;`,\n        `  acl:accessTo <${options.target}>;`,\n        `  acl:mode ${options.accessToModes}.`,\n        ''\n      ].join('\\n')\n    }\n    if (options.defaultModes) {\n      str += [\n        '<#bobDefault> a acl:Authorization;',\n        `  acl:agent <${options.peerWebId}>;`,\n        `  acl:default <${options.target}>;`,\n        `  acl:mode ${options.defaultModes}.`,\n        ''\n      ].join('\\n')\n    }\n    const aclDocUrl = await aclLogic.findAclDocUrl(sym(options.target))\n    return store.fetcher._fetch(aclDocUrl, {\n      method: 'PUT',\n      body: str,\n      headers: [\n        ['Content-Type', 'text/turtle']\n      ]\n    })\n  }\n\n  async function createEmptyRdfDoc(doc: NamedNode, comment: string) {\n    await store.fetcher.webOperation('PUT', doc.uri, {\n      data: `# ${new Date()} ${comment}\n  `,\n      contentType: 'text/turtle',\n    })\n  }\n  \n  return {\n    recursiveDelete,\n    setSinglePeerAccess,\n    createEmptyRdfDoc,\n    followOrCreateLink,\n    loadOrCreateIfNotExists\n  }\n}\n\n","import * as debug from '../util/debug'\nimport { authSession } from '../authSession/authSession'\nimport { createSolidLogic } from './solidLogic'\nimport { SolidLogic } from '../types'\n\nconst _fetch = async (url, requestInit) => {\n    const omitCreds = requestInit && requestInit.credentials && requestInit.credentials == 'omit'\n    if (authSession.info.webId && !omitCreds) { // see https://github.com/solidos/solidos/issues/114\n        // In fact fetch should respect credentials omit itself\n        return authSession.fetch(url, requestInit)\n    } else {\n        return window.fetch(url, requestInit)\n    }\n}\n\n// Global singleton pattern to ensure unique store across library versions\nconst SINGLETON_SYMBOL = Symbol.for('solid-logic-singleton')\n\n// Type the global object properly with the singleton\ninterface GlobalWithSingleton {\n    [SINGLETON_SYMBOL]?: SolidLogic\n}\n\nconst globalTarget = (typeof window !== 'undefined' ? window : global) as GlobalWithSingleton\n\nfunction getOrCreateSingleton(): SolidLogic {\n    if (!globalTarget[SINGLETON_SYMBOL]) {\n        debug.log('SolidLogic: Creating new global singleton instance.')\n        globalTarget[SINGLETON_SYMBOL] = createSolidLogic({ fetch: _fetch }, authSession)\n        debug.log('Unique quadstore initialized.')\n    } else {\n        debug.log('SolidLogic: Using existing global singleton instance.')\n    }\n    return globalTarget[SINGLETON_SYMBOL]!\n}\n//this const makes solidLogicSingleton global accessible in mashlib\nconst solidLogicSingleton = getOrCreateSingleton()\n\nexport { solidLogicSingleton }","const DEFAULT_ISSUERS = [\n  {\n    name: 'Solid Community',\n    uri: 'https://solidcommunity.net'\n  },\n  {\n    name: 'Solid Web',\n    uri: 'https://solidweb.org'\n  },\n  {\n    name: 'Solid Web ME',\n    uri: 'https://solidweb.me'\n  },\n  {\n    name: 'Inrupt.com',\n    uri: 'https://login.inrupt.com'\n  }\n]\n\n/**\n * @returns - A list of suggested OIDC issuers\n */\nexport function getSuggestedIssuers (): { name: string, uri: string }[] {\n    // Suggest a default list of OIDC issuers\n    const issuers = [...DEFAULT_ISSUERS]\n  \n    // Suggest the current host if not already included\n    const { host, origin } = new URL(location.href)\n    const hosts = issuers.map(({ uri }) => new URL(uri).host)\n    if (!hosts.includes(host) && !hosts.some(existing => isSubdomainOf(host, existing))) {\n      issuers.unshift({ name: host, uri: origin })\n    }\n  \n    return issuers\n  }\n  \nfunction isSubdomainOf (subdomain: string, domain: string): boolean {\n    const dot = subdomain.length - domain.length - 1\n    return dot > 0 && subdomain[dot] === '.' && subdomain.endsWith(domain)\n}","// Make these variables directly accessible as it is what you need most of the time\n// This also makes these variable globaly accesible in mashlib\nimport { solidLogicSingleton } from './logic/solidLogicSingleton'\n\nconst authn = solidLogicSingleton.authn\nconst authSession = solidLogicSingleton.authn.authSession\nconst store = solidLogicSingleton.store\n\nexport { ACL_LINK } from './acl/aclLogic'\nexport { offlineTestID, appContext } from './authn/authUtil'\nexport { getSuggestedIssuers } from './issuer/issuerLogic'\nexport { createTypeIndexLogic } from './typeIndex/typeIndexLogic'\nexport type { AppDetails, SolidNamespace, AuthenticationContext, SolidLogic, ChatLogic } from './types'\nexport { UnauthorizedError, CrossOriginForbiddenError, SameOriginForbiddenError, NotFoundError, FetchError, NotEditableError, WebOperationError } from './logic/CustomError'\n\nexport {\n  solidLogicSingleton, // solidLogicSingleton is exported entirely because it is used in solid-panes\n  store,\n  authn,\n  authSession\n}\n\n"],"names":["root","factory","exports","module","require","define","amd","this","__WEBPACK_EXTERNAL_MODULE__264__","aliases","acl","arg","as","bookmark","cal","cco","cert","contact","dc","dct","doap","foaf","geo","gpx","gr","http","httph","icalTZ","ldp","link","log","meeting","mo","org","owl","pad","patch","prov","pto","qu","trip","rdf","rdfs","rss","sched","schema","sioc","skos","solid","space","stat","tab","tabont","ui","vann","vcard","wf","xsd","namedNode","u","namespaces","alias","expansion","localName","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","__webpack_modules__","n","getter","__esModule","d","a","definition","key","o","Object","defineProperty","enumerable","get","g","globalThis","Function","e","window","obj","prop","prototype","hasOwnProperty","call","r","Symbol","toStringTag","value","args","console","warn","isCryptoKey","CryptoKey","message","msg","actual","types","filter","Boolean","length","last","pop","join","name","constructor","withAlg","alg","encoder","TextEncoder","decoder","TextDecoder","concat","buffers","size","reduce","acc","buf","Uint8Array","i","buffer","set","encode","input","unencoded","arr","push","String","fromCharCode","apply","subarray","btoa","encodeBase64","replace","decode","encoded","binary","atob","bytes","charCodeAt","decodeBase64","TypeError","async","kty","k","extractable","ext","key_ops","use","jwk","subtle","exportKey","exportJWK","JOSEError","Error","options","super","code","captureStackTrace","JWTClaimValidationFailed","payload","claim","reason","cause","JWTExpired","JOSEAlgNotAllowed","arguments","JWSInvalid","JWTInvalid","JWKInvalid","JWKSInvalid","JWKSNoMatchingKey","JWKSMultipleMatchingKeys","asyncIterator","JWKSTimeout","JWSSignatureVerificationFailed","subtleDsa","algorithm","hash","slice","saltLength","namedCurve","startsWith","modulusLength","unusable","isAlgorithm","getHashLength","parseInt","checkUsage","usages","some","expected","includes","checkSigCryptoKey","getNamedCurve","isObject","toString","getPrototypeOf","proto","isJWK","keyUsages","crv","subtleMapping","rest","keyData","importKey","exportKeyValue","privCache","pubCache","isKeyObject","importAndCache","cache","freeze","cached","cryptoKey","export","format","dp","dq","p","q","qi","WeakMap","getCryptoKey","usage","data","signature","sign","headers","sources","header","parameters","keys","parameter","has","add","Set","tag","jwkMatchesOp","symmetricTypeCheck","allowJwk","type","checkKeyType","test","asymmetricTypeCheck","bind","checkKeyTypeWithJwk","Err","recognizedDefault","recognizedOption","protectedHeader","joseHeader","crit","Array","isArray","recognized","Map","entries","FlattenedSign","_payload","setProtectedHeader","_protectedHeader","setUnprotectedHeader","unprotectedHeader","_unprotectedHeader","b64","JSON","stringify","jws","protected","CompactSign","_flattened","date","Math","floor","getTime","day","hour","REGEX","str","matched","exec","parseFloat","numericDate","toLowerCase","round","minute","validateInput","label","Number","isFinite","ProduceJWT","setIssuer","issuer","iss","setSubject","subject","sub","setAudience","audience","aud","setJti","jwtId","jti","setNotBefore","nbf","Date","epoch","secs","setExpirationTime","exp","setIssuedAt","iat","SignJWT","sig","url","timeout","controller","id","timedOut","AbortController","setTimeout","abort","response","fetch","href","signal","redirect","catch","err","clearTimeout","status","json","importJWK","oth","isJWKLike","clone","structuredClone","parse","LocalJWKSet","jwks","_cached","every","isJWKSLike","_jwks","getKey","token","kid","getKtyFromAlg","candidates","candidate","error","importWithAlgCache","createLocalJWKSet","localJWKSet","defineProperties","configurable","writable","USER_AGENT","navigator","userAgent","jwksCache","RemoteJWKSet","URL","cacheMaxAge","_url","_options","agent","_timeoutDuration","timeoutDuration","_cooldownDuration","cooldownDuration","_cacheMaxAge","_cache","uat","now","_jwksTimestamp","_local","coolingDown","fresh","reload","_pendingFetch","WebSocketPair","EdgeRuntime","Headers","fromEntries","then","verify","option","algorithms","s","compactVerify","split","verified","parsedProt","resolvedKey","result","flattenedVerify","normalizeTyp","encodedPayload","typ","requiredClaims","maxTokenAge","presenceCheck","reverse","audPayload","audOption","tolerance","clockTolerance","currentDate","age","subtleDigest","digest","check","description","calculateJwkThumbprint","digestAlgorithm","components","x","y","getModulusLengthOption","publicExponent","generateKey","SessionEvents","SessionDatabase","dbName","storeName","dbVersion","db","init","Promise","resolve","reject","request","indexedDB","open","onerror","onsuccess","onupgradeneeded","event","target","objectStoreNames","contains","createObjectStore","setItem","tx","transaction","oncomplete","objectStore","put","getItem","deleteItem","delete","clear","close","createDPoPToken","keyPair","htu","htm","ath","publicJwk","publicKey","crypto","randomUUID","privateKey","requestTokens","tokenEndpoint","params","dpop","method","body","URLSearchParams","ok","validateAccessToken","accessToken","jwksUri","clientId","remoteJWKSet","reloading","createRemoteJWKSet","jwt","jwtVerify","thumbprint","cnf","jkt","client_id","EventTarget","database","onStateChange","onExpirationWarning","onExpiration","_isActive","_webId","_exp","_ath","_tokens","_idpDetails","_refreshPromise","addEventListener","isActive","webId","isExpired","getExpiresIn","login","idp","redirectUri","redirectUrl","sanitizedRedirect","origin","pathname","search","config","discoverOIDC","trimSlash","endsWith","sessionStorage","token_endpoint","jwks_uri","registrationEndpoint","redirectUris","application_type","redirect_uris","token_endpoint_auth_method","grant_types","response_types","scope","registerClient","registration_endpoint","pkce","verifier","challenge","generatePKCE","csrfToken","authUrl","authorization_endpoint","searchParams","location","handleRedirectFromLogin","csrf","history","replaceState","document","title","pkceVerifier","tokens","grant_type","code_verifier","redirect_uri","access_token","all","refresh_token","removeItem","_setTokens","dpop_key_pair","_dispatchStateChange","restore","refreshToken","refreshTokens","_dispatchExpiration","_dispatchExpirationWarning","logout","authFetch","Request","toUpperCase","decoded","decodeJwt","webid","hashBuffer","hashArray","from","computeAth","dispatchEvent","CustomEvent","detail","expires_in","EVENTS","EventEmitter","listeners","on","callback","off","emit","forEach","cb","Session","_session","_events","_sessionId","events","info","isLoggedIn","sessionId","expirationDate","handleIncomingRedirect","opts","restorePreviousSession","oidcIssuer","authSession","ACL_LINK","sym","createAclLogic","store","ns","genACLText","docURI","me","aclURI","optPublic","public","graph","auth","Namespace","doc","defaultForNew","serialize","findAclDocUrl","fetcher","load","docNode","any","setACLUserPublic","aclDoc","fetchACLRel","aclText","uri","webOperation","contentType","appContext","SolidAppContext","viewingNoAuthPage","noAuth","viewedPage","decodeURI","ary","offlineTestID","$SolidTestEnvironment","username","div","getElementById","getAttribute","SolidAuthnLogic","solidAuthSession","session","currentUser","app","checkUser","setUserCallback","preLoginRedirectHash","localStorage","postLoginRedirectHash","curUrl","pushState","webIdFromSession","saveUser","context","webIdUri","newThing","differentOrigin","CHAT_LOCATION_IN_CONTAINER","createChatLogic","profileLogic","setAcl","chatContainer","invitee","chatAclDoc","NamedNode","aclBody","addToPrivateTypeIndex","chatThing","privateTypeIndex","reg","ins","st","updater","update","_uri","errm","findChat","loadMe","podRoot","chatContainerStr","host","determineChatContainer","getPodRoot","exists","createChatThing","mintNew","newBase","newInstance","newPaneOptions","kb","newChatDoc","term","statementsMatching","uri2","sendInvite","inviteeInbox","inviteBody","inviteResponse","getChat","createIfMissing","createInboxLogic","utilityLogic","containerLogic","aclLogic","createInboxFor","peerWebId","nick","myWebId","ourInbox","encodeURIComponent","createContainer","setSinglePeerAccess","ownerWebId","accessToModes","getNewMessages","user","inbox","getMainInbox","getContainerMembers","isContainer","markAsRead","downloaded","_fetch","archiveUrl","baseUrl","year","getUTCFullYear","month","getUTCMonth","getUTCDate","parts","filename","getArchiveUrl","text","CustomError","setPrototypeOf","UnauthorizedError","CrossOriginForbiddenError","SameOriginForbiddenError","NotFoundError","NotEditableError","WebOperationError","FetchError","createProfileLogic","authn","loadPreferences","loadProfile","possiblePreferencesFile","fileURI","folderURI","suggestPreferencesFile","preferencesFile","followOrCreateLink","findStorage","mainInbox","silencedLoadPreferences","createTypeIndexLogic","loadTypeIndexesFor","profile","suggestion","suggestPublicTypeIndex","publicTypeIndex","publicScopes","index","privateScopes","suggestedPrivateTypeIndex","suggestPrivateTypeIndex","scopes","files","map","loadCommunityTypeIndexes","communities","each","loadAllTypeIndexes","flat","getScopedAppInstances","klass","scopedApps","scopedApps0","getScopedAppsFromIndex","dir","theClass","results","registrations","sameTerm","instances","instance","containers","registerInTypeIndex","registration","getRegistrations","holds","getAppInstances","scoped","deleteTypeIndexRegistration","item","the","statements","createSolidLogic","specialFetch","features","getContainerElements","containerNode","object","nodeToString","charAt","Link","containerUrl","createContainerLogic","loadOrCreateIfNotExists","recursiveDelete","aclDocUrl","containerMembers","nodeToStringHere","defaultModes","createEmptyRdfDoc","comment","predicate","editable","createUtilityLogic","chat","typeIndex","updatePromise","del","errorBody","clearStore","remove","requestInit","omitCreds","credentials","SINGLETON_SYMBOL","for","globalTarget","solidLogicSingleton","DEFAULT_ISSUERS","getSuggestedIssuers","issuers","hosts","existing","subdomain","domain","dot","isSubdomainOf","unshift"],"ignoreList":[],"sourceRoot":""}